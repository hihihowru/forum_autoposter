#!/usr/bin/env python3
"""
完全重新建立貼文記錄表
"""

from src.clients.google.sheets_client import GoogleSheetsClient

def rebuild_sheet():
    """完全重新建立貼文記錄表"""
    sheets_client = GoogleSheetsClient(
        "./credentials/google-service-account.json",
        "148CUhBxqE-BZDPTKaAmOJG6m52CxB4KrxD9p5LikN2s"
    )
    
    # 正確的欄位標題（12個欄位）
    correct_headers = [
        "貼文ID", "KOL Serial", "KOL 暱稱", "股票名稱", "股票代號", "話題ID", 
        "平台發文ID", "平台發文URL", "生成標題", "生成內容", "commodity_tags", "發文狀態"
    ]
    
    # 之前的貼文數據
    previous_posts = [
        # 第2行 - 台股高檔震盪貼文
        [
            "19cab017-cdcf-41ec-b07b-c43fdc427c80-203", "203", "龜狗一日散戶", "台股", "TWA00", "enhanced_trending_topics",
            "173477844", "https://www.cmoney.tw/forum/article/173477844",
            "台股高檔震盪，開高走平背後的真相？",
            "你們敢嗎？今天的台股再次讓人捏一把冷汗，開盤雖然高開，但卻一路走平，這背後到底隱藏了什麼樣的市場信號？我們來看看數據。首先，台積電的表現依然穩定，報價1165元，變化不大，技術指標評分為5.0/10，信心度僅26.4%。這意味著市場對於台積電的未來方向仍舊模糊。RSI指標在中軸附近徘徊，顯示出投資者情緒的謹慎；而均線關係也沒有明顯變化，這都反映出當前動能不足。再來看看0050指數，報價52元，同樣沒有變化，技術指標評分為4.1/10，信心度稍高於台積電，但依然不明確。MACD快慢線糾纏不清，短期內缺乏明確的上漲或下跌信號。成交量的低迷更是讓市場缺乏參與感，這使得投資者在操作上必須更加謹慎。綜合來看，今天的台股高檔震盪，其實是多重技術指標發出的警告：市場情緒不高，加上成交量萎縮，風險控制顯得尤為重要。因此，我們的操作建議是觀望。等到市場出現更明確的方向再做決定，你們敢嗎？",
            '[{"type": "Stock", "key": "TWA00", "bullOrBear": 0}, {"type": "Stock", "key": "2330", "bullOrBear": 0}, {"type": "Stock", "key": "0050", "bullOrBear": 0}]',
            "published"
        ],
        # 第3行 - 台股高檔震盪貼文2
        [
            "19cab017-cdcf-41ec-b07b-c43fdc427c80-204", "204", "板橋大who", "台股", "TWA00", "enhanced_trending_topics",
            "173477845", "https://www.cmoney.tw/forum/article/173477845",
            "高檔震盪的背後，市場心態何在？",
            "來說個故事，今天台股開盤雖然高漲，但隨後卻平靜如水。0050和鴻海的表現都讓人摸不著頭腦，0050報價$52.00，技術評分僅4.1/10，信心度低至33%，顯示市場情緒不明。MACD指標糾纏不清，反映出短期方向的迷茫。而鴻海雖然稍微強勁些，報價$198.50，但技術評分也只有4.8/10，信心度24.7%。成交量低迷，讓整個市場缺乏活力。面對這樣的狀況，我們或許應該暫時觀望。你覺得接下來會怎麼發展？市場會再找回動能，還是會繼續震盪不前呢？",
            '[{"type": "Stock", "key": "TWA00", "bullOrBear": 0}, {"type": "Stock", "key": "0050", "bullOrBear": 0}, {"type": "Stock", "key": "2317", "bullOrBear": 0}]',
            "published"
        ],
        # 第4行 - 康霈生技貼文1
        [
            "6919_200_20250902_184535", "200", "川川哥", "康霈生技", "6919", "6919_kangpei_20250902",
            "173481664", "https://www.cmoney.tw/forum/article/173481664",
            "康霈生技(6919)漲停！CBL-514神秘力量嘎到！",
            "康霈生技(6919)今日嘎到漲停！技術面爆量，K棒跳空缺口，MACD背離支撐帶！專業分析指標顯示黃金交叉即將爆發！CBL-514減重新藥題材熱度持續升溫，市場熱議，外資買盤動向強勁！但切記追高需謹慎，盤勢或因消息面變化而起起伏伏！穩了啦，要噴啦，睡醒漲停！風險自負，勿貪！想知道的話，留言告訴我，咱們一起討論一下...",
            '[{"type": "Stock", "key": "6919", "bullOrBear": 0}]',
            "published"
        ],
        # 第5行 - 康霈生技貼文2
        [
            "6919_201_20250902_184540", "201", "韭割哥", "康霈生技", "6919", "6919_kangpei_20250902",
            "173481665", "https://www.cmoney.tw/forum/article/173481665",
            "康霈生技(6919)：減重新藥CBL-514引領漲停風潮 📈",
            "近期市場熱議康霈生技(6919)，其股價出現漲停表現，背後的原因何在？讓我們從技術面和基本面進行深入分析。技術面上，康霈生技的減重新藥CBL-514題材一拍即合，引領著漲停風潮。這項新藥的研發進展值得關注，將直接影響公司未來的市場表現。此一利好消息穩定了投資者情緒，成為股價上漲的催化劑。另一方面，外資買盤的動向也值得關注。外資的持續看好往往能帶動股價持續上揚，對康霈生技的長期投資價值有所支撐。綜合分析，建議投資者在關注減重新藥CBL-514的同時，也應注意公司的財務結構、產業競爭力等基本面因素，以全面評估投資價值。然而，投資須謹慎，研發風險、法規風險、競爭風險不可忽視。康霈生技的漲停題材吸引眾多投資者目光，但投資要有耐心，時間將證明一切的價值。📊 💡 💰",
            '[{"type": "Stock", "key": "6919", "bullOrBear": 0}]',
            "published"
        ]
    ]
    
    # 已發布的漲停股貼文
    published_limit_up_posts = [
        [
            "limit_up_5272_TWO_2_20250903_100745", "201", "韭割哥", "笙科", "5272.TWO", "limit_up_stocks",
            "173493660", "https://www.cmoney.tw/forum/article/173493660",
            "笙科昨日漲停的節奏",
            "📅 **昨日(9/2)分析** 📅\n\n笙科(5272.TWO)昨日強勢漲停！股價從21.40元飆升至23.10元，漲幅達10.00%！\n\n從技術面來看，笙科昨日跳空開高，成交量明顯放大，顯示買盤動能強勁。MACD指標呈現黃金交叉，KD指標也進入超買區間，技術面支撐強勁。\n\n基本面方面，笙科近期在產業發展上取得重要突破，市場對其未來發展前景看好。外資和法人買盤持續湧入，顯示機構投資者對該股的認同度提升。\n\n⚠️ **提醒：昨日漲停不代表今日表現，投資者需謹慎評估今日開盤後的走勢變化**\n\n不過投資者仍需注意，漲停後可能面臨獲利了結賣壓，建議關注後續的技術面表現和基本面發展。追高需謹慎，投資有風險，入市需謹慎。\n\n各位先進對笙科昨日這波漲停行情有什麼看法？今日開盤後會如何發展？",
            '[{"type": "Stock", "key": "5272.TWO", "bullOrBear": 0}]',
            "published"
        ],
        [
            "limit_up_5302_TWO_3_20250903_100745", "202", "梅川褲子", "太欣", "5302.TWO", "limit_up_stocks",
            "173493707", "https://www.cmoney.tw/forum/article/173493707",
            "太欣昨日漲停，各位先進怎麼看？",
            "📅 **昨日(9/2)分析** 📅\n\n太欣(5302.TWO)昨日強勢漲停！股價從9.01元飆升至9.90元，漲幅達10.00%！\n\n從技術面來看，太欣昨日跳空開高，成交量明顯放大，顯示買盤動能強勁。MACD指標呈現黃金交叉，KD指標也進入超買區間，技術面支撐強勁。\n\n基本面方面，太欣近期在產業發展上取得重要突破，市場對其未來發展前景看好。外資和法人買盤持續湧入，顯示機構投資者對該股的認同度提升。\n\n⚠️ **提醒：昨日漲停不代表今日表現，投資者需謹慎評估今日開盤後的走勢變化**\n\n不過投資者仍需注意，漲停後可能面臨獲利了結賣壓，建議關注後續的技術面表現和基本面發展。追高需謹慎，投資有風險，入市需謹慎。\n\n各位先進對太欣昨日這波漲停行情有什麼看法？今日開盤後會如何發展？",
            '[{"type": "Stock", "key": "5302.TWO", "bullOrBear": 0}]',
            "published"
        ],
        [
            "limit_up_6735_TWO_4_20250903_100745", "203", "龜狗一日散戶", "美達科技", "6735.TWO", "limit_up_stocks",
            "173493746", "https://www.cmoney.tw/forum/article/173493746",
            "美達科技昨日漲停的節奏",
            "📅 **昨日(9/2)分析** 📅\n\n美達科技(6735.TWO)昨日強勢漲停！股價從61.00元飆升至69.30元，漲幅達10.00%！\n\n從技術面來看，美達科技昨日跳空開高，成交量明顯放大，顯示買盤動能強勁。MACD指標呈現黃金交叉，KD指標也進入超買區間，技術面支撐強勁。\n\n基本面方面，美達科技近期在產業發展上取得重要突破，市場對其未來發展前景看好。外資和法人買盤持續湧入，顯示機構投資者對該股的認同度提升。\n\n⚠️ **提醒：昨日漲停不代表今日表現，投資者需謹慎評估今日開盤後的走勢變化**\n\n不過投資者仍需注意，漲停後可能面臨獲利了結賣壓，建議關注後續的技術面表現和基本面發展。追高需謹慎，投資有風險，入市需謹慎。\n\n各位先進對美達科技昨日這波漲停行情有什麼看法？今日開盤後會如何發展？",
            '[{"type": "Stock", "key": "6735.TWO", "bullOrBear": 0}]',
            "published"
        ],
        [
            "limit_up_3284_TWO_5_20250903_100745", "204", "板橋大who", "太普高", "3284.TWO", "limit_up_stocks",
            "173493785", "https://www.cmoney.tw/forum/article/173493785",
            "太普高昨日這根紅K，各位怎麼解讀？ ⚡",
            "📅 **昨日(9/2)分析** 📅\n\n太普高(3284.TWO)昨日強勢漲停！股價從21.40元飆升至23.15元，漲幅達9.98%！\n\n從技術面來看，太普高昨日跳空開高，成交量明顯放大，顯示買盤動能強勁。MACD指標呈現黃金交叉，KD指標也進入超買區間，技術面支撐強勁。\n\n基本面方面，太普高近期在產業發展上取得重要突破，市場對其未來發展前景看好。外資和法人買盤持續湧入，顯示機構投資者對該股的認同度提升。\n\n⚠️ **提醒：昨日漲停不代表今日表現，投資者需謹慎評估今日開盤後的走勢變化**\n\n不過投資者仍需注意，漲停後可能面臨獲利了結賣壓，建議關注後續的技術面表現和基本面發展。追高需謹慎，投資有風險，入市需謹慎。\n\n各位先進對太普高昨日這波漲停行情有什麼看法？今日開盤後會如何發展？",
            '[{"type": "Stock", "key": "3284.TWO", "bullOrBear": 0}]',
            "published"
        ],
        [
            "limit_up_4976_TW_6_20250903_100745", "205", "八卦護城河", "佳凌", "4976.TW", "limit_up_stocks",
            "173493851", "https://www.cmoney.tw/forum/article/173493851",
            "佳凌昨日噴了！",
            "📅 **昨日(9/2)分析** 📅\n\n佳凌(4976.TW)昨日強勢漲停！股價從46.75元飆升至49.05元，漲幅達9.98%！\n\n從技術面來看，佳凌昨日跳空開高，成交量明顯放大，顯示買盤動能強勁。MACD指標呈現黃金交叉，KD指標也進入超買區間，技術面支撐強勁。\n\n基本面方面，佳凌近期在產業發展上取得重要突破，市場對其未來發展前景看好。外資和法人買盤持續湧入，顯示機構投資者對該股的認同度提升。\n\n⚠️ **提醒：昨日漲停不代表今日表現，投資者需謹慎評估今日開盤後的走勢變化**\n\n不過投資者仍需注意，漲停後可能面臨獲利了結賣壓，建議關注後續的技術面表現和基本面發展。追高需謹慎，投資有風險，入市需謹慎。\n\n各位先進對佳凌昨日這波漲停行情有什麼看法？今日開盤後會如何發展？",
            '[{"type": "Stock", "key": "4976.TW", "bullOrBear": 0}]',
            "published"
        ],
        [
            "limit_up_6919_TW_7_20250903_100745", "206", "小道爆料王", "康霈*", "6919.TW", "limit_up_stocks",
            "173493913", "https://www.cmoney.tw/forum/article/173493913",
            "康霈*昨日這根K棒... 📈",
            "📅 **昨日(9/2)分析** 📅\n\n康霈*(6919.TW)昨日強勢漲停！股價從213.50元飆升至231.50元，漲幅達9.98%！\n\n從技術面來看，康霈*昨日跳空開高，成交量明顯放大，顯示買盤動能強勁。MACD指標呈現黃金交叉，KD指標也進入超買區間，技術面支撐強勁。\n\n基本面方面，康霈*近期在產業發展上取得重要突破，市場對其未來發展前景看好。外資和法人買盤持續湧入，顯示機構投資者對該股的認同度提升。\n\n⚠️ **提醒：昨日漲停不代表今日表現，投資者需謹慎評估今日開盤後的走勢變化**\n\n不過投資者仍需注意，漲停後可能面臨獲利了結賣壓，建議關注後續的技術面表現和基本面發展。追高需謹慎，投資有風險，入市需謹慎。\n\n各位先進對康霈*昨日這波漲停行情有什麼看法？今日開盤後會如何發展？",
            '[{"type": "Stock", "key": "6919.TW", "bullOrBear": 0}]',
            "published"
        ],
        [
            "limit_up_1256_TW_8_20250903_100745", "207", "信號宅神", "鮮活果汁-KY", "1256.TW", "limit_up_stocks",
            "173493965", "https://www.cmoney.tw/forum/article/173493965",
            "鮮活果汁-KY昨日這根K棒...",
            "📅 **昨日(9/2)分析** 📅\n\n鮮活果汁-KY(1256.TW)昨日強勢漲停！股價從143.50元飆升至143.50元，漲幅達9.96%！\n\n從技術面來看，鮮活果汁-KY昨日跳空開高，成交量明顯放大，顯示買盤動能強勁。MACD指標呈現黃金交叉，KD指標也進入超買區間，技術面支撐強勁。\n\n基本面方面，鮮活果汁-KY近期在產業發展上取得重要突破，市場對其未來發展前景看好。外資和法人買盤持續湧入，顯示機構投資者對該股的認同度提升。\n\n⚠️ **提醒：昨日漲停不代表今日表現，投資者需謹慎評估今日開盤後的走勢變化**\n\n不過投資者仍需注意，漲停後可能面臨獲利了結賣壓，建議關注後續的技術面表現和基本面發展。追高需謹慎，投資有風險，入市需謹慎。\n\n各位先進對鮮活果汁-KY昨日這波漲停行情有什麼看法？今日開盤後會如何發展？",
            '[{"type": "Stock", "key": "1256.TW", "bullOrBear": 0}]',
            "published"
        ],
        [
            "limit_up_8038_TWO_9_20250903_100745", "208", "長線韭韭", "長園科", "8038.TWO", "limit_up_stocks",
            "173494020", "https://www.cmoney.tw/forum/article/173494020",
            "長園科昨日這波行情...",
            "📅 **昨日(9/2)分析** 📅\n\n長園科(8038.TWO)昨日強勢漲停！股價從57.40元飆升至57.40元，漲幅達9.96%！\n\n從技術面來看，長園科昨日跳空開高，成交量明顯放大，顯示買盤動能強勁。MACD指標呈現黃金交叉，KD指標也進入超買區間，技術面支撐強勁。\n\n基本面方面，長園科近期在產業發展上取得重要突破，市場對其未來發展前景看好。外資和法人買盤持續湧入，顯示機構投資者對該股的認同度提升。\n\n⚠️ **提醒：昨日漲停不代表今日表現，投資者需謹慎評估今日開盤後的走勢變化**\n\n不過投資者仍需注意，漲停後可能面臨獲利了結賣壓，建議關注後續的技術面表現和基本面發展。追高需謹慎，投資有風險，入市需謹慎。\n\n各位先進對長園科昨日這波漲停行情有什麼看法？今日開盤後會如何發展？",
            '[{"type": "Stock", "key": "8038.TWO", "bullOrBear": 0}]',
            "published"
        ],
        [
            "limit_up_4743_TWO_11_20250903_100745", "200", "川川哥", "合一", "4743.TWO", "limit_up_stocks",
            "173494103", "https://www.cmoney.tw/forum/article/173494103",
            "合一昨日這根紅K，各位怎麼解讀？",
            "📅 **昨日(9/2)分析** 📅\n\n合一(4743.TWO)昨日強勢漲停！股價從71.30元飆升至78.50元，漲幅達9.94%！\n\n從技術面來看，合一昨日跳空開高，成交量明顯放大，顯示買盤動能強勁。MACD指標呈現黃金交叉，KD指標也進入超買區間，技術面支撐強勁。\n\n基本面方面，合一近期在產業發展上取得重要突破，市場對其未來發展前景看好。外資和法人買盤持續湧入，顯示機構投資者對該股的認同度提升。\n\n⚠️ **提醒：昨日漲停不代表今日表現，投資者需謹慎評估今日開盤後的走勢變化**\n\n不過投資者仍需注意，漲停後可能面臨獲利了結賣壓，建議關注後續的技術面表現和基本面發展。追高需謹慎，投資有風險，入市需謹慎。\n\n各位先進對合一昨日這波漲停行情有什麼看法？今日開盤後會如何發展？",
            '[{"type": "Stock", "key": "4743.TWO", "bullOrBear": 0}]',
            "published"
        ],
        [
            "limit_up_6237_TWO_12_20250903_100745", "201", "韭割哥", "驊訊", "6237.TWO", "limit_up_stocks",
            "173494148", "https://www.cmoney.tw/forum/article/173494148",
            "驊訊昨日這根紅K，各位怎麼解讀？ 🔥",
            "📅 **昨日(9/2)分析** 📅\n\n驊訊(6237.TWO)昨日強勢漲停！股價從47.15元飆升至50.90元，漲幅達9.94%！\n\n從技術面來看，驊訊昨日跳空開高，成交量明顯放大，顯示買盤動能強勁。MACD指標呈現黃金交叉，KD指標也進入超買區間，技術面支撐強勁。\n\n基本面方面，驊訊近期在產業發展上取得重要突破，市場對其未來發展前景看好。外資和法人買盤持續湧入，顯示機構投資者對該股的認同度提升。\n\n⚠️ **提醒：昨日漲停不代表今日表現，投資者需謹慎評估今日開盤後的走勢變化**\n\n不過投資者仍需注意，漲停後可能面臨獲利了結賣壓，建議關注後續的技術面表現和基本面發展。追高需謹慎，投資有風險，入市需謹慎。\n\n各位先進對驊訊昨日這波漲停行情有什麼看法？今日開盤後會如何發展？",
            '[{"type": "Stock", "key": "6237.TWO", "bullOrBear": 0}]',
            "published"
        ],
        [
            "limit_up_6854_TW_13_20250903_100745", "202", "梅川褲子", "錼創科技-KY創", "6854.TW", "limit_up_stocks",
            "173494194", "https://www.cmoney.tw/forum/article/173494194",
            "錼創科技-KY創昨日漲停！",
            "📅 **昨日(9/2)分析** 📅\n\n錼創科技-KY創(6854.TW)昨日強勢漲停！股價從168.50元飆升至183.00元，漲幅達9.91%！\n\n從技術面來看，錼創科技-KY創昨日跳空開高，成交量明顯放大，顯示買盤動能強勁。MACD指標呈現黃金交叉，KD指標也進入超買區間，技術面支撐強勁。\n\n基本面方面，錼創科技-KY創近期在產業發展上取得重要突破，市場對其未來發展前景看好。外資和法人買盤持續湧入，顯示機構投資者對該股的認同度提升。\n\n⚠️ **提醒：昨日漲停不代表今日表現，投資者需謹慎評估今日開盤後的走勢變化**\n\n不過投資者仍需注意，漲停後可能面臨獲利了結賣壓，建議關注後續的技術面表現和基本面發展。追高需謹慎，投資有風險，入市需謹慎。\n\n各位先進對錼創科技-KY創昨日這波漲停行情有什麼看法？今日開盤後會如何發展？",
            '[{"type": "Stock", "key": "6854.TW", "bullOrBear": 0}]',
            "published"
        ]
    ]
    
    # 失敗的貼文
    failed_post = [
        [
            "limit_up_8358_TWO_10_20250903_100745", "209", "報爆哥_209", "金居", "8358.TWO", "limit_up_stocks",
            "KOL 209登入失敗", "", "金居昨日漲停突破關鍵價位 🌟",
            "📅 **昨日(9/2)分析** 📅\n\n金居(8358.TWO)昨日強勢漲停！股價從188.50元飆升至215.50元，漲幅達9.95%！\n\n從技術面來看，金居昨日跳空開高，成交量明顯放大，顯示買盤動能強勁。MACD指標呈現黃金交叉，KD指標也進入超買區間，技術面支撐強勁。\n\n基本面方面，金居近期在產業發展上取得重要突破，市場對其未來發展前景看好。外資和法人買盤持續湧入，顯示機構投資者對該股的認同度提升。\n\n⚠️ **提醒：昨日漲停不代表今日表現，投資者需謹慎評估今日開盤後的走勢變化**\n\n不過投資者仍需注意，漲停後可能面臨獲利了結賣壓，建議關注後續的技術面表現和基本面發展。追高需謹慎，投資有風險，入市需謹慎。\n\n各位先進對金居昨日這波漲停行情有什麼看法？今日開盤後會如何發展？",
            '[{"type": "Stock", "key": "8358.TWO", "bullOrBear": 0}]',
            "failed"
        ]
    ]
    
    try:
        # 建立完整的數據
        all_data = [correct_headers] + previous_posts + published_limit_up_posts + failed_post
        
        # 寫入完整數據
        sheets_client.write_sheet('貼文記錄表', all_data)
        print("✅ 已重新建立完整的貼文記錄表")
        
        # 讀取確認
        data = sheets_client.read_sheet('貼文記錄表')
        print(f"📊 總行數: {len(data)}")
        print(f"📋 欄位數: {len(data[0]) if data else 0}")
        
        if data:
            print("✅ 欄位標題:")
            for i, header in enumerate(data[0]):
                print(f"  {i+1}. {header}")
            
            print(f"\n📈 數據統計:")
            print(f"  總貼文數: {len(data) - 1}")
            print(f"  已發布: {len([row for row in data[1:] if row[11] == 'published'])} 篇")
            print(f"  發布失敗: {len([row for row in data[1:] if row[11] == 'failed'])} 篇")
            
    except Exception as e:
        print(f"❌ 重新建立失敗: {e}")

if __name__ == "__main__":
    rebuild_sheet()










