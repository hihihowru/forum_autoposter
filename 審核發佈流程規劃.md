# ğŸ¯ å¯©æ ¸è²¼æ–‡å¾Œçš„KOLç™»å…¥å’Œç™¼ä½ˆæµç¨‹

## ğŸ“Š å®Œæ•´æµç¨‹åœ–

```mermaid
graph TD
    A[ç”¨æˆ¶é»æ“Šå¯©æ ¸é€šé] --> B[å‰ç«¯èª¿ç”¨ /posts/{id}/approve]
    B --> C[å¾Œç«¯æ›´æ–°ç‹€æ…‹ç‚º 'approved']
    C --> D[å‰ç«¯é¡¯ç¤ºç™¼ä½ˆæŒ‰éˆ•]
    D --> E[ç”¨æˆ¶é»æ“Šç™¼ä½ˆåˆ°CMoney]
    
    E --> F[å¾Œç«¯ç²å–è²¼æ–‡è¨˜éŒ„]
    F --> G[æª¢æŸ¥è²¼æ–‡ç‹€æ…‹æ˜¯å¦ç‚º 'approved']
    G -->|å¦| H[è¿”å›éŒ¯èª¤ï¼šåªæœ‰å·²å¯©æ ¸çš„è²¼æ–‡æ‰èƒ½ç™¼å¸ƒ]
    G -->|æ˜¯| I[ç²å–KOLæ†‘è­‰]
    
    I --> J[ä½¿ç”¨CMoney Clientç™»å…¥KOL]
    J --> K{ç™»å…¥æˆåŠŸ?}
    K -->|å¦| L[è¿”å›ç™»å…¥å¤±æ•—éŒ¯èª¤]
    K -->|æ˜¯| M[æ§‹å»ºç™¼æ–‡æ•¸æ“š]
    
    M --> N[èª¿ç”¨CMoneyç™¼æ–‡API]
    N --> O{ç™¼æ–‡æˆåŠŸ?}
    O -->|å¦| P[è¨˜éŒ„éŒ¯èª¤ä¸¦æ›´æ–°ç‹€æ…‹]
    O -->|æ˜¯| Q[æ›´æ–°ç‹€æ…‹ç‚º 'published']
    
    Q --> R[è¿”å›ç™¼æ–‡çµæœ]
    P --> R
    L --> R
    H --> R
```

## ğŸ”§ æŠ€è¡“å¯¦ç¾

### 1. **KOLæ†‘è­‰ç®¡ç†**
```python
class KOLCredentialManager:
    def __init__(self):
        self.kol_credentials = {
            "150": {"email": "forum_150@cmoney.com.tw", "password": "N9t1kY3x"},
            "151": {"email": "forum_151@cmoney.com.tw", "password": "m7C1lR4t"},
            # ... æ›´å¤šKOLæ†‘è­‰
        }
        self.kol_tokens = {}  # Tokenå¿«å–
```

### 2. **ç™¼ä½ˆæœå‹™**
```python
class PostPublishService:
    async def publish_post(self, post_record):
        # 1. ç™»å…¥KOL
        access_token = await self.login_kol(post_record.kol_serial)
        
        # 2. ç™¼ä½ˆåˆ°CMoney
        publish_result = await self.publish_to_cmoney(post_record, access_token)
        
        # 3. æ›´æ–°ç‹€æ…‹
        return publish_result
```

### 3. **APIç«¯é»**
```python
@app.post("/posts/{post_id}/publish")
async def publish_post_to_cmoney(post_id: str):
    # ç²å–è²¼æ–‡è¨˜éŒ„
    post_record = post_record_service.get_post_record(post_id)
    
    # æª¢æŸ¥ç‹€æ…‹
    if post_record.status != "approved":
        raise HTTPException(status_code=400, detail="åªæœ‰å·²å¯©æ ¸çš„è²¼æ–‡æ‰èƒ½ç™¼å¸ƒ")
    
    # ä½¿ç”¨ç™¼ä½ˆæœå‹™ç™¼ä½ˆ
    publish_result = await publish_service.publish_post(post_record)
    
    # æ›´æ–°ç‹€æ…‹
    update_data = PostRecordUpdate(
        status="published",
        published_at=datetime.now(),
        cmoney_post_id=publish_result["post_id"],
        cmoney_post_url=publish_result["post_url"]
    )
    
    return publish_result
```

## ğŸš€ ä½¿ç”¨æµç¨‹

### **å‰ç«¯æ“ä½œ**
1. **å¯©æ ¸è²¼æ–‡**ï¼šç”¨æˆ¶åœ¨å¯©æ ¸é é¢é»æ“Š"å¯©æ ¸é€šé"
2. **ç™¼ä½ˆè²¼æ–‡**ï¼šç”¨æˆ¶é»æ“Š"ç™¼ä½ˆåˆ°CMoney"æŒ‰éˆ•
3. **æŸ¥çœ‹çµæœ**ï¼šç³»çµ±é¡¯ç¤ºç™¼ä½ˆçµæœå’ŒCMoneyé€£çµ

### **å¾Œç«¯è™•ç†**
1. **ç‹€æ…‹æª¢æŸ¥**ï¼šç¢ºä¿è²¼æ–‡å·²å¯©æ ¸
2. **KOLç™»å…¥**ï¼šä½¿ç”¨å°æ‡‰KOLæ†‘è­‰ç™»å…¥CMoney
3. **ç™¼æ–‡è™•ç†**ï¼šæ§‹å»ºç™¼æ–‡æ•¸æ“šä¸¦èª¿ç”¨CMoney API
4. **ç‹€æ…‹æ›´æ–°**ï¼šæ›´æ–°è²¼æ–‡ç‹€æ…‹å’Œç™¼ä½ˆè³‡è¨Š

## ğŸ”’ å®‰å…¨è€ƒé‡

### **æ†‘è­‰ç®¡ç†**
- KOLæ†‘è­‰å­˜å„²åœ¨æœå‹™ç«¯
- Tokenå¿«å–æ©Ÿåˆ¶æ¸›å°‘ç™»å…¥æ¬¡æ•¸
- æ†‘è­‰è¼ªæ›å’ŒéæœŸè™•ç†

### **éŒ¯èª¤è™•ç†**
- ç™»å…¥å¤±æ•—è™•ç†
- ç™¼æ–‡å¤±æ•—è™•ç†
- ç‹€æ…‹å›æ»¾æ©Ÿåˆ¶

### **æ—¥èªŒè¨˜éŒ„**
- å®Œæ•´çš„æ“ä½œæ—¥èªŒ
- éŒ¯èª¤è¿½è¹¤å’Œé™¤éŒ¯è³‡è¨Š
- ç™¼ä½ˆçµæœè¨˜éŒ„

## ğŸ“ˆ ç›£æ§å’Œè¿½è¹¤

### **ç™¼ä½ˆç‹€æ…‹**
- `pending_review` - å¾…å¯©æ ¸
- `approved` - å·²å¯©æ ¸
- `published` - å·²ç™¼ä½ˆ
- `failed` - ç™¼ä½ˆå¤±æ•—

### **è¿½è¹¤è³‡è¨Š**
- CMoneyè²¼æ–‡ID
- CMoneyè²¼æ–‡URL
- ç™¼ä½ˆæ™‚é–“
- éŒ¯èª¤è¨Šæ¯

## ğŸ¯ å„ªå‹¢

1. **è‡ªå‹•åŒ–æµç¨‹**ï¼šå¾å¯©æ ¸åˆ°ç™¼ä½ˆå…¨è‡ªå‹•åŒ–
2. **éŒ¯èª¤è™•ç†**ï¼šå®Œå–„çš„éŒ¯èª¤è™•ç†å’Œç‹€æ…‹ç®¡ç†
3. **å¯è¿½è¹¤æ€§**ï¼šå®Œæ•´çš„æ“ä½œè¨˜éŒ„å’Œç‹€æ…‹è¿½è¹¤
4. **å®‰å…¨æ€§**ï¼šå®‰å…¨çš„æ†‘è­‰ç®¡ç†å’ŒAPIèª¿ç”¨
5. **æ“´å±•æ€§**ï¼šæ˜“æ–¼æ·»åŠ æ–°çš„KOLå’Œå¹³å°æ”¯æ´
