# è«–å£‡è‡ªå‹•ç™¼æ–‡ç³»çµ± - å®Œæ•´ä½¿ç”¨æ•™å­¸

## ç›®éŒ„

1. [ç³»çµ±æ¦‚è¿°](#ç³»çµ±æ¦‚è¿°)
2. [æ¶æ§‹èªªæ˜](#æ¶æ§‹èªªæ˜)
3. [ç™¼æ–‡ç”Ÿæˆæµç¨‹ - ä¹æ­¥é©Ÿå®Œæ•´æ•™å­¸](#ç™¼æ–‡ç”Ÿæˆæµç¨‹)
   - [æ­¥é©Ÿä¸€ï¼šè§¸ç™¼å™¨é¸æ“‡](#æ­¥é©Ÿä¸€è§¸ç™¼å™¨é¸æ“‡)
   - [æ­¥é©ŸäºŒï¼šæ•¸æ“šæºé…ç½®](#æ­¥é©ŸäºŒæ•¸æ“šæºé…ç½®)
   - [æ­¥é©Ÿä¸‰ï¼šè§£é‡‹å±¤è¨­å®š](#æ­¥é©Ÿä¸‰è§£é‡‹å±¤è¨­å®š)
   - [æ­¥é©Ÿå››ï¼šæ–°èæœå°‹é…ç½®](#æ­¥é©Ÿå››æ–°èæœå°‹é…ç½®)
   - [æ­¥é©Ÿäº”ï¼šKOL é¸æ“‡](#æ­¥é©Ÿäº”kol-é¸æ“‡)
   - [æ­¥é©Ÿå…­ï¼šKOL Prompt å¾®èª¿](#æ­¥é©Ÿå…­kol-prompt-å¾®èª¿)
   - [æ­¥é©Ÿä¸ƒï¼šç”Ÿæˆè¨­å®š](#æ­¥é©Ÿä¸ƒç”Ÿæˆè¨­å®š)
   - [æ­¥é©Ÿå…«ï¼šæ¨™ç±¤è¨­å®š](#æ­¥é©Ÿå…«æ¨™ç±¤è¨­å®š)
   - [æ­¥é©Ÿä¹ï¼šæ‰¹é‡æ¨¡å¼è¨­å®š](#æ­¥é©Ÿä¹æ‰¹é‡æ¨¡å¼è¨­å®š)
4. [å¾Œç«¯è™•ç†æµç¨‹](#å¾Œç«¯è™•ç†æµç¨‹)
5. [ç™¼å¸ƒèˆ‡å¯©æ ¸æµç¨‹](#ç™¼å¸ƒèˆ‡å¯©æ ¸æµç¨‹)

---

## ç³»çµ±æ¦‚è¿°

### ç³»çµ±å®šä½
è«–å£‡è‡ªå‹•ç™¼æ–‡ç³»çµ±æ˜¯ä¸€å€‹æ•´åˆ AI å…§å®¹ç”Ÿæˆã€å¸‚å ´æ•¸æ“šåˆ†æã€èˆ‡è«–å£‡ç™¼å¸ƒçš„è‡ªå‹•åŒ–å¹³å°ã€‚ç³»çµ±å¯ä»¥ï¼š

- **è‡ªå‹•ç›£æ§**å¸‚å ´è§¸ç™¼äº‹ä»¶ï¼ˆæ¼²åœã€ç†±é–€è©±é¡Œã€æ–°èäº‹ä»¶ç­‰ï¼‰
- **æ™ºèƒ½ç”Ÿæˆ**ç¬¦åˆä¸åŒ KOL é¢¨æ ¼çš„è‚¡ç¥¨åˆ†æå…§å®¹
- **æ‰¹é‡è™•ç†**å¤šæª”è‚¡ç¥¨ã€å¤šå€‹ KOL çš„ç™¼æ–‡éœ€æ±‚
- **è‡ªå‹•ç™¼å¸ƒ**è‡³ CMoney è«–å£‡å¹³å°

### æ ¸å¿ƒç‰¹è‰²

1. **ä¹æ­¥é©Ÿç²¾æº–è¨­å®š**ï¼šå¾è§¸ç™¼å™¨åˆ°ç™¼å¸ƒï¼Œæ¯å€‹ç’°ç¯€éƒ½å¯ç²¾ç´°æ§åˆ¶
2. **KOL å€‹æ€§åŒ–å¼•æ“**ï¼šæ¯å€‹ KOL éƒ½æœ‰ç¨ç‰¹çš„å¯«ä½œé¢¨æ ¼ã€èªæ°£ã€å°ˆæ¥­é ˜åŸŸ
3. **å¤šå±¤æ•¸æ“šæ•´åˆ**ï¼šè‚¡åƒ¹æŠ€è¡“é¢ã€åŸºæœ¬é¢ã€æ–°èé¢ã€ç†±é–€è©±é¡Œå…¨æ–¹ä½åˆ†æ
4. **æ™ºèƒ½å…§å®¹ç”Ÿæˆ**ï¼šåŸºæ–¼ GPT-4 çš„å‹•æ…‹æç¤ºè©å·¥ç¨‹ï¼ˆPrompt Engineeringï¼‰
5. **å“è³ªæŠŠé—œæ©Ÿåˆ¶**ï¼šå…§å®¹å“è³ªæª¢æŸ¥ã€AI æª¢æ¸¬åˆ†æ•¸ã€äººå·¥å¯©æ ¸æµç¨‹

---

## æ¶æ§‹èªªæ˜

### å‰å¾Œç«¯æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯ (Frontend)                      â”‚
â”‚  æŠ€è¡“ï¼šReact + TypeScript + Ant Design                   â”‚
â”‚  ä½ç½®ï¼š/dashboard-frontend/src/                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  çµ„ä»¶ï¼š                                                   â”‚
â”‚  â€¢ PostingGenerator.tsx (9æ­¥é©Ÿç²¾éˆ)                      â”‚
â”‚    â”œâ”€ TriggerSelector.tsx (æ­¥é©Ÿ1)                       â”‚
â”‚    â”œâ”€ DataSourceSelector.tsx (æ­¥é©Ÿ2)                    â”‚
â”‚    â”œâ”€ ExplainabilityConfig.tsx (æ­¥é©Ÿ3)                  â”‚
â”‚    â”œâ”€ NewsConfig.tsx (æ­¥é©Ÿ4)                            â”‚
â”‚    â”œâ”€ KOLSelector.tsx (æ­¥é©Ÿ5)                           â”‚
â”‚    â”œâ”€ KOLPromptTuner.tsx (æ­¥é©Ÿ6)                        â”‚
â”‚    â”œâ”€ GenerationSettings.tsx (æ­¥é©Ÿ7)                    â”‚
â”‚    â”œâ”€ TagSettings.tsx (æ­¥é©Ÿ8)                           â”‚
â”‚    â””â”€ BatchModeSettings.tsx (æ­¥é©Ÿ9)                     â”‚
â”‚  â€¢ PostReviewPage.tsx (å¯©æ ¸é é¢)                         â”‚
â”‚  â€¢ PublishSuccessPage.tsx (ç™¼å¸ƒæˆåŠŸé é¢)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ HTTP API èª¿ç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å¾Œç«¯ API (Backend)                      â”‚
â”‚  æŠ€è¡“ï¼šFastAPI + Python                                   â”‚
â”‚  ä½ç½®ï¼š/apps/unified-api/main.py                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¸»è¦ç«¯é»ï¼š                                               â”‚
â”‚  â€¢ POST /api/manual-posting (æ‰‹å‹•ç™¼æ–‡)                   â”‚
â”‚  â€¢ POST /api/simple-mode/generate-batch (æ‰¹é‡ç”Ÿæˆ)       â”‚
â”‚  â€¢ GET /posts/session/{session_id} (æŸ¥è©¢ç”Ÿæˆçµæœ)        â”‚
â”‚  â€¢ POST /posts/{post_id}/approve (å¯©æ ¸é€šé)              â”‚
â”‚  â€¢ POST /posts/{post_id}/publish (ç™¼å¸ƒåˆ°è«–å£‡)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ ¸å¿ƒæ¨¡çµ„ï¼š                                               â”‚
â”‚  â€¢ GPTContentGenerator (GPTå…§å®¹ç”Ÿæˆå™¨)                   â”‚
â”‚  â€¢ PersonalizationModule (å€‹äººåŒ–è™•ç†æ¨¡çµ„)                â”‚
â”‚  â€¢ KOLDatabaseService (KOLè³‡æ–™ç®¡ç†)                      â”‚
â”‚  â€¢ SmartDataSourceAssigner (æ™ºèƒ½æ•¸æ“šæºåˆ†é…)              â”‚
â”‚  â€¢ TriggerManager (è§¸ç™¼å™¨ç®¡ç†)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•¸æ“šå±¤ (Data Layer)                     â”‚
â”‚  â€¢ PostgreSQL (è²¼æ–‡è¨˜éŒ„ã€KOLæª”æ¡ˆã€æ’ç¨‹è³‡æ–™)                â”‚
â”‚  â€¢ Google Sheets (å‚™ä»½ã€å‚³çµ±è³‡æ–™åŒæ­¥)                      â”‚
â”‚  â€¢ OpenAI API (GPT-4o-mini å…§å®¹ç”Ÿæˆ)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è³‡æ–™æµå‘

```
ä½¿ç”¨è€…æ“ä½œ â†’ 9æ­¥é©Ÿé…ç½® â†’ å‰ç«¯å½™æ•´åƒæ•¸ â†’ APIè«‹æ±‚ â†’ å¾Œç«¯è™•ç†
    â†“
å¾Œç«¯é‚è¼¯æµç¨‹ï¼š
    1. è§£æè§¸ç™¼å™¨ï¼Œå–å¾—è‚¡ç¥¨æ¸…å–®
    2. åˆ†é…æ•¸æ“šæºï¼ˆOHLCã€æ–°èã€åŸºæœ¬é¢ç­‰ï¼‰
    3. æ”¶é›†è‚¡ç¥¨æ•¸æ“š
    4. åˆ†é… KOL
    5. ç”Ÿæˆå…§å®¹ï¼ˆGPT-4ï¼‰
    6. å€‹äººåŒ–è™•ç†ï¼ˆé¢¨æ ¼è½‰æ›ï¼‰
    7. å„²å­˜åˆ°è³‡æ–™åº«ï¼ˆstatus: draftï¼‰
    8. å›å‚³å‰ç«¯é€²è¡Œå¯©æ ¸
    â†“
å¯©æ ¸ç™¼å¸ƒæµç¨‹ï¼š
    1. ä½¿ç”¨è€…åœ¨ PostReviewPage å¯©é–±
    2. é»æ“Šã€Œç™¼å¸ƒã€
    3. KOL ç™»å…¥ CMoney
    4. ç™¼å¸ƒè²¼æ–‡åˆ°è«–å£‡
    5. æ›´æ–°è³‡æ–™åº«ï¼ˆstatus: publishedï¼‰
```

---

## ç™¼æ–‡ç”Ÿæˆæµç¨‹

### æ•´é«”æµç¨‹æ¦‚è¦½

ç™¼æ–‡ç”Ÿæˆåˆ†ç‚º**ä¹å€‹æ­¥é©Ÿ**ï¼Œæ¯å€‹æ­¥é©Ÿè² è²¬ä¸åŒçš„é…ç½®é¢å‘ï¼š

| æ­¥é©Ÿ | åç¨± | åŠŸèƒ½ | å‰ç«¯çµ„ä»¶ |
|------|------|------|----------|
| **1** | è§¸ç™¼å™¨é¸æ“‡ | æ±ºå®šè¦ç”Ÿæˆå“ªäº›è‚¡ç¥¨çš„å…§å®¹ | TriggerSelector.tsx |
| **2** | æ•¸æ“šæºé…ç½® | é¸æ“‡ä½¿ç”¨å“ªäº›æ•¸æ“š API | DataSourceSelector.tsx |
| **3** | è§£é‡‹å±¤è¨­å®š | é…ç½®æ•¸æ“šæ‘˜è¦èˆ‡è§£é‡‹æ–¹å¼ | ExplainabilityConfig.tsx |
| **4** | æ–°èæœå°‹ | è¨­å®šæ–°èæœå°‹é—œéµå­—èˆ‡ç¯„åœ | NewsConfig.tsx |
| **5** | KOL é¸æ“‡ | é¸æ“‡è¦ä½¿ç”¨çš„ KOL å¸³è™Ÿ | KOLSelector.tsx |
| **6** | KOL Prompt å¾®èª¿ | èª¿æ•´ KOL çš„å¯«ä½œé¢¨æ ¼ç´°ç¯€ | KOLPromptTuner.tsx |
| **7** | ç”Ÿæˆè¨­å®š | é…ç½®å…§å®¹é•·åº¦ã€é¢¨æ ¼ã€åˆ†ææ·±åº¦ | GenerationSettings.tsx |
| **8** | æ¨™ç±¤è¨­å®š | è¨­å®šè²¼æ–‡æ¨™ç±¤ï¼ˆè‚¡ç¥¨ã€è©±é¡Œï¼‰ | TagSettings.tsx |
| **9** | æ‰¹é‡æ¨¡å¼ | æ‰¹é‡ç”Ÿæˆçš„ç­–ç•¥èˆ‡å“è³ªæ§åˆ¶ | BatchModeSettings.tsx |

---

## æ­¥é©Ÿä¸€ï¼šè§¸ç™¼å™¨é¸æ“‡

### åŠŸèƒ½èªªæ˜
è§¸ç™¼å™¨æ±ºå®šäº†**è¦ç‚ºå“ªäº›è‚¡ç¥¨ç”Ÿæˆå…§å®¹**ã€‚é€™æ˜¯æ•´å€‹æµç¨‹çš„èµ·é»ï¼Œä¹Ÿæ˜¯æœ€é—œéµçš„é…ç½®ã€‚

### å¯ç”¨çš„è§¸ç™¼å™¨é¡å‹

ç³»çµ±å…±æä¾› **13 å€‹è§¸ç™¼å™¨**ï¼Œåˆ†ç‚º 3 å¤§é¡ï¼š

#### é¡åˆ¥ä¸€ï¼šç†±é–€è©±é¡Œè§¸ç™¼å™¨ (1 å€‹)

##### 1. ç†±é–€è©±é¡Œ (trending_topics)
- **ä½¿ç”¨æ™‚æ©Ÿ**ï¼šæƒ³è¦è¹­ç†±åº¦ã€è¿½è¹¤å¸‚å ´é—œæ³¨ç„¦é»
- **è³‡æ–™ä¾†æº**ï¼šCMoney Trending API
- **API ç«¯é»**ï¼š`GET /api/trending`
- **é‹ä½œæ–¹å¼**ï¼š
  1. ç³»çµ±å¾ Trending API å–å¾—ç•¶å‰ç†±é–€è©±é¡Œ
  2. æ¯å€‹è©±é¡ŒåŒ…å«ï¼šè©±é¡Œæ¨™é¡Œã€ç›¸é—œè‚¡ç¥¨æ¸…å–®
  3. ä½¿ç”¨è€…å¯å‹¾é¸è¦ç”Ÿæˆçš„è©±é¡Œ
  4. ç³»çµ±æœƒç‚ºæ¯å€‹è©±é¡Œä¸­çš„è‚¡ç¥¨ç”Ÿæˆå…§å®¹

**å‰ç«¯é…ç½®**ï¼š
```typescript
generationConfig.triggers = {
  trigger_type: 'trending',
  triggerConfig: {
    triggerKey: 'trending_topics',
    displayName: 'CMoneyç†±é–€è©±é¡Œ'
  },
  selectedTopics: [
    { topic_id: 123, title: 'AIä¼ºæœå™¨æ¦‚å¿µè‚¡çˆ†ç™¼', stocks: ['2330', '3231'] }
  ]
}
```

---

#### é¡åˆ¥äºŒï¼šç›¤å¾Œè§¸ç™¼å™¨ (6 å€‹)

##### 2. ç›¤å¾Œæ¼² (limit_up_after_hours)
- **ä½¿ç”¨æ™‚æ©Ÿ**ï¼šæ”¶ç›¤å¾Œç¬¬ä¸€æ™‚é–“æ¶ç™¼ä¸Šæ¼²è‚¡åˆ†æ
- **API ç«¯é»**ï¼š`GET /api/after_hours_limit_up`
- **ç¯©é¸æ¢ä»¶**ï¼šæ”¶ç›¤ä¸Šæ¼²è‚¡ç¥¨ï¼Œä¾æˆäº¤é‡æ’åº

##### 3. ç›¤å¾Œè·Œ (limit_down_after_hours)
- **ä½¿ç”¨æ™‚æ©Ÿ**ï¼šæ”¶ç›¤å¾Œåˆ†æä¸‹è·Œè‚¡ç¥¨
- **API ç«¯é»**ï¼š`GET /api/after_hours_limit_down`
- **ç¯©é¸æ¢ä»¶**ï¼šæ”¶ç›¤ä¸‹è·Œè‚¡ç¥¨ï¼Œä¾æˆäº¤é‡æ’åº

##### 4. æˆäº¤é‡‘é¡é«˜ (volume_amount_high)
- **ä½¿ç”¨æ™‚æ©Ÿ**ï¼šåˆ†æé«˜æˆäº¤é‡‘é¡è‚¡ç¥¨ï¼ˆè³‡é‡‘é—œæ³¨åº¦é«˜ï¼‰
- **API ç«¯é»**ï¼š`GET /api/after_hours_volume_amount_high`
- **ç¯©é¸æ¢ä»¶**ï¼šæˆäº¤é‡‘é¡çµ•å°å€¼æ’åºï¼ˆç”±å¤§åˆ°å°ï¼‰

##### 5. æˆäº¤é‡‘é¡ä½ (volume_amount_low)
- **ä½¿ç”¨æ™‚æ©Ÿ**ï¼šåˆ†æä½æˆäº¤é‡‘é¡è‚¡ç¥¨ï¼ˆå†·é–€è‚¡ã€è§€æœ›æ°›åœï¼‰
- **API ç«¯é»**ï¼š`GET /api/after_hours_volume_amount_low`
- **ç¯©é¸æ¢ä»¶**ï¼šæˆäº¤é‡‘é¡çµ•å°å€¼æ’åºï¼ˆç”±å°åˆ°å¤§ï¼‰

##### 6. æˆäº¤é‡‘é¡è®ŠåŒ–ç‡é«˜ (volume_change_rate_high)
- **ä½¿ç”¨æ™‚æ©Ÿ**ï¼šæ•æ‰çªç„¶æ”¾é‡çš„è‚¡ç¥¨ï¼ˆç•°å¸¸æ´»èºï¼‰
- **API ç«¯é»**ï¼š`GET /api/after_hours_volume_change_rate_high`
- **ç¯©é¸æ¢ä»¶**ï¼šæˆäº¤é‡‘é¡è®ŠåŒ–ç‡æ’åºï¼ˆç”±å¤§åˆ°å°ï¼‰

##### 7. æˆäº¤é‡‘é¡è®ŠåŒ–ç‡ä½ (volume_change_rate_low)
- **ä½¿ç”¨æ™‚æ©Ÿ**ï¼šåˆ†æé‡èƒ½èç¸®çš„è‚¡ç¥¨ï¼ˆè§€æœ›ã€ç¸®é‡ï¼‰
- **API ç«¯é»**ï¼š`GET /api/after_hours_volume_change_rate_low`
- **ç¯©é¸æ¢ä»¶**ï¼šæˆäº¤é‡‘é¡è®ŠåŒ–ç‡æ’åºï¼ˆç”±å°åˆ°å¤§ï¼‰

---

#### é¡åˆ¥ä¸‰ï¼šç›¤ä¸­è§¸ç™¼å™¨ (6 å€‹)

##### 8. æ¼²å¹…æ’åº+æˆäº¤é¡ (intraday_gainers_by_amount)
- **ä½¿ç”¨æ™‚æ©Ÿ**ï¼šç›¤ä¸­å³æ™‚è¿½è¹¤é«˜æ¼²å¹…ä¸”æœ‰è³‡é‡‘é—œæ³¨çš„è‚¡ç¥¨
- **API ç«¯é»**ï¼š`GET /api/intraday/gainers-by-amount`
- **ç¯©é¸æ¢ä»¶**ï¼šæŒ‰æˆäº¤é¡æ’åºçš„æ¼²å¹…è‚¡ç¥¨ï¼ˆå‰ 20 åï¼‰

##### 9. æˆäº¤é‡æ’åº (intraday_volume_leaders)
- **ä½¿ç”¨æ™‚æ©Ÿ**ï¼šç›¤ä¸­è¿½è¹¤ç†±é–€äº¤æ˜“è‚¡ç¥¨
- **API ç«¯é»**ï¼š`GET /api/intraday/volume-leaders`
- **ç¯©é¸æ¢ä»¶**ï¼šæŒ‰æˆäº¤é‡æ’åºï¼ˆå‰ 20 åï¼‰

##### 10. æˆäº¤é¡æ’åº (intraday_amount_leaders)
- **ä½¿ç”¨æ™‚æ©Ÿ**ï¼šç›¤ä¸­è¿½è¹¤å¤§æˆ¶é—œæ³¨è‚¡ç¥¨
- **API ç«¯é»**ï¼š`GET /api/intraday/amount-leaders`
- **ç¯©é¸æ¢ä»¶**ï¼šæŒ‰æˆäº¤é¡æ’åºï¼ˆå‰ 20 åï¼‰

##### 11. è·Œåœç¯©é¸ (intraday_limit_down)
- **ä½¿ç”¨æ™‚æ©Ÿ**ï¼šç›¤ä¸­å³æ™‚åˆ†æè·Œåœè‚¡ç¥¨
- **API ç«¯é»**ï¼š`GET /api/intraday/limit-down`
- **ç¯©é¸æ¢ä»¶**ï¼šç¯©é¸è·Œåœè‚¡ç¥¨ï¼ˆå‰ 20 åï¼‰

##### 12. æ¼²åœç¯©é¸ (intraday_limit_up)
- **ä½¿ç”¨æ™‚æ©Ÿ**ï¼šç›¤ä¸­å³æ™‚è¿½è¹¤æ¼²åœå¼·å‹¢è‚¡
- **API ç«¯é»**ï¼š`GET /api/intraday/limit-up`
- **ç¯©é¸æ¢ä»¶**ï¼šç¯©é¸æ¼²åœè‚¡ç¥¨ï¼ˆå‰ 20 åï¼‰

##### 13. è·Œåœç¯©é¸+æˆäº¤é¡ (intraday_limit_down_by_amount)
- **ä½¿ç”¨æ™‚æ©Ÿ**ï¼šç›¤ä¸­åˆ†ææœ‰è³‡é‡‘é—œæ³¨çš„è·Œåœè‚¡
- **API ç«¯é»**ï¼š`GET /api/intraday/limit-down-by-amount`
- **ç¯©é¸æ¢ä»¶**ï¼šæŒ‰æˆäº¤é¡æ’åºçš„è·Œåœè‚¡ç¥¨ï¼ˆå‰ 20 åï¼‰

---

**å‰ç«¯é…ç½®ç¯„ä¾‹**ï¼š
```typescript
// ç›¤å¾Œè§¸ç™¼å™¨ç¯„ä¾‹
generationConfig.triggers = {
  trigger_type: 'individual',
  triggerConfig: {
    triggerKey: 'limit_up_after_hours',
    displayName: 'ç›¤å¾Œæ¼²'
  }
}

// ç›¤ä¸­è§¸ç™¼å™¨ç¯„ä¾‹
generationConfig.triggers = {
  trigger_type: 'intraday',
  triggerConfig: {
    triggerKey: 'intraday_limit_up',
    displayName: 'æ¼²åœç¯©é¸'
  }
}
```

---

### è§¸ç™¼å™¨é¸æ“‡æœ€ä½³å¯¦è¸

| æƒ…å¢ƒ | æ¨è–¦è§¸ç™¼å™¨ | åŸå›  |
|------|------------|------|
| æƒ³è¦è¿½ç†±åº¦ã€é«˜äº’å‹• | ç†±é–€è©±é¡Œ (trending_topics) | è©±é¡Œæœ¬èº«å°±æœ‰æµé‡ï¼Œå®¹æ˜“å¼•èµ·å…±é³´ |
| æ”¶ç›¤å¾Œæ¶ç¬¬ä¸€æ™‚é–“ | ç›¤å¾Œæ¼²/è·Œ (limit_up/down_after_hours) | æ”¶ç›¤å¾Œç«‹å³ç”Ÿæˆï¼Œæ™‚æ•ˆæ€§æœ€å¼· |
| ç›¤ä¸­å³æ™‚è¿½è¹¤ | ç›¤ä¸­æ¼²/è·Œåœç¯©é¸ (intraday_limit_up/down) | æ•æ‰ç›¤ä¸­çªç™¼å¼·å‹¢è‚¡æˆ–å¼±å‹¢è‚¡ |
| åˆ†æè³‡é‡‘é—œæ³¨åº¦ | æˆäº¤é¡æ’åºç³»åˆ— (amount_leaders, gainers_by_amount) | è¿½è¹¤å¤§æˆ¶å‹•å‘ |
| æ•æ‰ç•°å¸¸æ”¾é‡ | æˆäº¤é‡‘é¡è®ŠåŒ–ç‡é«˜ (volume_change_rate_high) | ç™¼ç¾çªç™¼ç•°å¸¸äº¤æ˜“æ´»å‹• |
| åˆ†æå†·é–€è‚¡è§€æœ› | æˆäº¤é‡‘é¡ä½/è®ŠåŒ–ç‡ä½ | æ‰¾å‡ºé‡èƒ½èç¸®ã€å¸‚å ´è§€æœ›çš„è‚¡ç¥¨ |

**è§¸ç™¼å™¨åˆ†é¡å¿«é€Ÿé¸æ“‡**ï¼š
- **ç†±åº¦å„ªå…ˆ** â†’ ç†±é–€è©±é¡Œ (trending_topics)
- **ç›¤å¾Œåˆ†æ** â†’ 6 å€‹ç›¤å¾Œè§¸ç™¼å™¨ (limit_up/down, volume ç³»åˆ—)
- **ç›¤ä¸­å³æ™‚** â†’ 6 å€‹ç›¤ä¸­è§¸ç™¼å™¨ (intraday ç³»åˆ—)

---

## æ­¥é©ŸäºŒï¼šæ•¸æ“šæºé…ç½®

### åŠŸèƒ½èªªæ˜
æ•¸æ“šæºæ±ºå®šäº†**ç”Ÿæˆå…§å®¹æ™‚æœƒä½¿ç”¨å“ªäº›æ•¸æ“š**ã€‚ä¸åŒçš„æ•¸æ“šæºæä¾›ä¸åŒé¡å‹çš„è³‡è¨Šï¼Œçµ„åˆä½¿ç”¨å¯ä»¥ç”Ÿæˆæ›´å…¨é¢çš„åˆ†æå…§å®¹ã€‚

### å¯ç”¨æ•¸æ“šæº

#### 1. OHLC API (è‚¡åƒ¹æŠ€è¡“æ•¸æ“š)
- **æä¾›æ•¸æ“š**ï¼š
  - é–‹ç›¤åƒ¹ã€æœ€é«˜åƒ¹ã€æœ€ä½åƒ¹ã€æ”¶ç›¤åƒ¹
  - æˆäº¤é‡ã€æˆäº¤é‡‘é¡
  - æŠ€è¡“æŒ‡æ¨™ï¼šMACD, RSI, KD, å¸ƒæ—é€šé“ç­‰
- **é©ç”¨æƒ…å¢ƒ**ï¼šæŠ€è¡“åˆ†æã€åƒ¹é‡é—œä¿‚åˆ†æ
- **KOL é©é…**ï¼šæŠ€è¡“æ´¾ KOL å¿…ç”¨

```typescript
dataSources: {
  ohlc_api: {
    enabled: true,
    indicators: ['MACD', 'RSI', 'KD'],
    timeframe: 'æ—¥ç·š'  // æ—¥ç·šã€é€±ç·šã€æœˆç·š
  }
}
```

---

#### 2. Summary API (æ•¸æ“šæ‘˜è¦åˆ†æ)
- **æä¾›æ•¸æ“š**ï¼š
  - AI ç”Ÿæˆçš„æ•¸æ“šæ‘˜è¦
  - é—œéµæ•¸æ“šè§£è®€
  - è¶¨å‹¢åˆ¤æ–·å»ºè­°
- **é©ç”¨æƒ…å¢ƒ**ï¼šéœ€è¦å¿«é€Ÿç†è§£æ•¸æ“šå«ç¾©
- **ç‰¹è‰²**ï¼šå·²ç¶“é AI é è™•ç†ï¼Œæ¸›å°‘ GPT ç”Ÿæˆè² æ“”

```typescript
dataSources: {
  summary_api: {
    enabled: true,
    summary_level: 'detailed'  // brief, medium, detailed
  }
}
```

---

#### 3. Serper API (æ–°èæœå°‹)
- **æä¾›æ•¸æ“š**ï¼š
  - ç›¸é—œæ–°èæ¨™é¡Œã€æ‘˜è¦ã€é€£çµ
  - ç™¼å¸ƒæ™‚é–“ã€ä¾†æºåª’é«”
- **æœå°‹å¼•æ“**ï¼šGoogle News
- **é©ç”¨æƒ…å¢ƒ**ï¼šæ–°èé¢åˆ†æã€äº‹ä»¶é©…å‹•å…§å®¹

```typescript
dataSources: {
  serper_api: {
    enabled: true,
    max_results: 5,
    time_range: 'd2'  // æœ€è¿‘2å¤©
  }
}
```

---

#### 4. Revenue API (ç‡Ÿæ”¶æ•¸æ“š)
- **æä¾›æ•¸æ“š**ï¼š
  - æ¯æœˆç‡Ÿæ”¶
  - å¹´å¢ç‡ã€æœˆå¢ç‡
  - ç´¯è¨ˆç‡Ÿæ”¶
- **é©ç”¨æƒ…å¢ƒ**ï¼šåŸºæœ¬é¢åˆ†æã€ç‡Ÿæ”¶æˆé•·è¿½è¹¤

---

#### 5. Financial API (è²¡å‹™æ•¸æ“š)
- **æä¾›æ•¸æ“š**ï¼š
  - EPS, ROE, æœ¬ç›Šæ¯”
  - è² å‚µæ¯”ã€è‚¡æ±æ¬Šç›Šå ±é…¬ç‡
- **é©ç”¨æƒ…å¢ƒ**ï¼šæ·±åº¦åŸºæœ¬é¢åˆ†æ

---

#### 6. Fundamental API (åŸºæœ¬é¢åˆ†æ)
- **æä¾›æ•¸æ“š**ï¼š
  - ç”¢æ¥­åœ°ä½ã€ç«¶çˆ­å„ªå‹¢
  - ç‡Ÿé‹æ¨¡å¼ã€ç²åˆ©ä¾†æº
- **é©ç”¨æƒ…å¢ƒ**ï¼šé•·æœŸæŠ•è³‡åƒ¹å€¼åˆ†æ

---

### æ•¸æ“šæºçµ„åˆç­–ç•¥

**å¾Œç«¯æ™ºèƒ½åˆ†é…é‚è¼¯**ï¼š
ç³»çµ±æœƒæ ¹æ“š **KOL çš„ personaï¼ˆé¢¨æ ¼ï¼‰** è‡ªå‹•èª¿æ•´æ•¸æ“šæºæ¬Šé‡ã€‚

```python
# SmartDataSourceAssigner.py
def assign_data_sources(kol_persona, trigger_type):
    if kol_persona == 'technical':
        # æŠ€è¡“æ´¾ï¼šé‡è¦–åƒ¹é‡ã€æŠ€è¡“æŒ‡æ¨™
        return {
            'OHLC_API': 1.0,      # æœ€é«˜æ¬Šé‡
            'SUMMARY_API': 0.7,
            'SERPER_API': 0.3     # è¼ƒä½æ¬Šé‡
        }
    elif kol_persona == 'fundamental':
        # åŸºæœ¬æ´¾ï¼šé‡è¦–è²¡å ±ã€ç‡Ÿæ”¶
        return {
            'FINANCIAL_API': 1.0,
            'REVENUE_API': 1.0,
            'OHLC_API': 0.5
        }
    elif kol_persona == 'news_driven':
        # æ–°èæ´¾ï¼šé‡è¦–æ–°èã€ç†±é–€è©±é¡Œ
        return {
            'SERPER_API': 1.0,
            'TRENDING_API': 0.9,
            'OHLC_API': 0.6
        }
```

### å‰ç«¯é…ç½®ç¯„ä¾‹

```typescript
// ç¯„ä¾‹ï¼šç‚ºæŠ€è¡“æ´¾ KOL é…ç½®æ•¸æ“šæº
dataSources: {
  ohlc_api: { enabled: true, weight: 1.0 },
  summary_api: { enabled: true, weight: 0.7 },
  serper_api: { enabled: false },  // æŠ€è¡“æ´¾è¼ƒå°‘ç”¨æ–°è
  revenue_api: { enabled: false },
  financial_api: { enabled: false }
}
```

---

## æ­¥é©Ÿä¸‰ï¼šè§£é‡‹å±¤è¨­å®š

### åŠŸèƒ½èªªæ˜
è§£é‡‹å±¤æ§åˆ¶**å¦‚ä½•å°‡åŸå§‹æ•¸æ“šè½‰æ›æˆæ˜“æ‡‚çš„æ–‡å­—æè¿°**ã€‚é€™æ˜¯å…§å®¹å“è³ªçš„é—œéµç’°ç¯€ã€‚

### ä¸»è¦åŠŸèƒ½

#### 1. æ•¸æ“šæ‘˜è¦å™¨ (Summarizer)
- **åŠŸèƒ½**ï¼šå°‡å¤§é‡æ•¸æ“šå£“ç¸®æˆé‡é»æ‘˜è¦
- **é‹ä½œæ–¹å¼**ï¼š
  1. æ¥æ”¶åŸå§‹æ•¸æ“šï¼ˆä¾‹ï¼š100ç­†Kç·šæ•¸æ“šï¼‰
  2. æå–é—œéµè³‡è¨Šï¼ˆä¾‹ï¼šè¿‘æœŸé«˜ä½é»ã€è¶¨å‹¢æ–¹å‘ï¼‰
  3. ç”Ÿæˆç°¡æ½”æ‘˜è¦ï¼ˆä¾‹ï¼šã€Œè‚¡åƒ¹è¿‘æœŸå‘ˆç¾ä¸Šå‡è¶¨å‹¢ï¼Œå·²çªç ´60æ—¥å‡ç·šã€ï¼‰

```typescript
explainability: {
  summarizer_enabled: true,
  summarizer_config: {
    compression_ratio: 0.3,  // å£“ç¸®åˆ°åŸæ•¸æ“šçš„30%
    focus_areas: ['trend', 'volume', 'key_levels']
  }
}
```

---

#### 2. æ•¸æ“šæå–å™¨ (Data Extractor)
- **åŠŸèƒ½**ï¼šå¾æ•¸æ“šä¸­æå–ç‰¹å®šæŒ‡æ¨™
- **ç¯„ä¾‹**ï¼š
  - æå–ï¼šã€Œæ”¶ç›¤åƒ¹ã€ã€ã€Œæˆäº¤é‡ã€ã€ã€ŒMACDã€
  - å¿½ç•¥ï¼šå…¶ä»–ä¸é‡è¦çš„æ¬„ä½

```typescript
explainability: {
  data_extractor_enabled: true,
  extract_fields: ['close_price', 'volume', 'MACD', 'RSI']
}
```

---

#### 3. Prompt æ¨¡æ¿ (Prompt Templates)
- **åŠŸèƒ½**ï¼šé è¨­çš„æ•¸æ“šè§£è®€æ¨¡æ¿
- **å¯ç”¨æ¨¡æ¿**ï¼š
  - `stock_price_basic`ï¼šåŸºç¤è‚¡åƒ¹è§£è®€
  - `technical_deep_dive`ï¼šæ·±åº¦æŠ€è¡“åˆ†æ
  - `volume_analysis`ï¼šé‡èƒ½åˆ†æ
  - `trend_momentum`ï¼šè¶¨å‹¢å‹•èƒ½åˆ†æ

**æ¨¡æ¿ç¯„ä¾‹**ï¼š
```python
# stock_price_basic æ¨¡æ¿
template = """
æ ¹æ“šä»¥ä¸‹æ•¸æ“šåˆ†æ {stock_name}({stock_code}) çš„è‚¡åƒ¹è¡¨ç¾ï¼š
- æ”¶ç›¤åƒ¹ï¼š{close_price}ï¼Œæ¼²è·Œå¹…ï¼š{change_percent}%
- æˆäº¤é‡ï¼š{volume} å¼µï¼Œç›¸è¼ƒæ˜¨æ—¥ {volume_change}%
- MACDï¼š{macd}ï¼ŒRSIï¼š{rsi}

è«‹ç”¨ç°¡å–®æ˜“æ‡‚çš„æ–¹å¼èªªæ˜ï¼š
1. è‚¡åƒ¹ç•¶å‰è¶¨å‹¢ï¼ˆä¸Šæ¼²/ä¸‹è·Œ/ç›¤æ•´ï¼‰
2. é‡èƒ½è®ŠåŒ–çš„æ„ç¾©
3. æŠ€è¡“æŒ‡æ¨™çš„è¨Šè™Ÿ
"""
```

---

#### 4. æŠ€è¡“æŒ‡æ¨™é¸æ“‡
- **å¯é¸æŒ‡æ¨™**ï¼š
  - `MACD`ï¼šè¶¨å‹¢æ–¹å‘èˆ‡å‹•èƒ½
  - `RSI`ï¼šè¶…è²·è¶…è³£
  - `KD`ï¼šçŸ­æœŸè²·è³£è¨Šè™Ÿ
  - `å¸ƒæ—é€šé“`ï¼šåƒ¹æ ¼æ³¢å‹•ç¯„åœ
  - `å‡ç·š`ï¼šæ”¯æ’å£“åŠ›

```typescript
explainability: {
  technical_indicators: ['MACD', 'RSI', 'KD'],
  indicator_config: {
    MACD: { fast: 12, slow: 26, signal: 9 },
    RSI: { period: 14, overbought: 70, oversold: 30 }
  }
}
```

---

#### 5. å¯è§£é‡‹æ€§ç´šåˆ¥ (Explainability Level)
- **ç°¡æ˜“ (simple)**ï¼šåªèªªçµè«–ï¼Œä¸è§£é‡‹åŸå› 
  - ç¯„ä¾‹ï¼šã€Œè‚¡åƒ¹å‘ˆç¾ä¸Šæ¼²è¶¨å‹¢ã€
- **ä¸­ç­‰ (medium)**ï¼šèªªæ˜çµè«– + ç°¡å–®åŸå› 
  - ç¯„ä¾‹ï¼šã€Œè‚¡åƒ¹å‘ˆç¾ä¸Šæ¼²è¶¨å‹¢ï¼Œä¸»è¦å› ç‚ºæˆäº¤é‡æ”¾å¤§ä¸”çªç ´å£“åŠ›ã€
- **è©³ç´° (detailed)**ï¼šå®Œæ•´é‚è¼¯æ¨å°
  - ç¯„ä¾‹ï¼šã€Œè‚¡åƒ¹å‘ˆç¾ä¸Šæ¼²è¶¨å‹¢ã€‚å¾æŠ€è¡“é¢ä¾†çœ‹ï¼ŒMACD å‡ºç¾é»ƒé‡‘äº¤å‰ï¼Œé¡¯ç¤ºå¤šé ­å‹•èƒ½å¢å¼·ï¼›æˆäº¤é‡è¼ƒå‰ä¸€æ—¥æ”¾å¤§50%ï¼Œä»£è¡¨å¸‚å ´é—œæ³¨åº¦æå‡ï¼›è‚¡åƒ¹çªç ´60æ—¥å‡ç·šå¾Œç«™ç©©ï¼Œé¡¯ç¤ºå¤šæ–¹åŠ›é‡å¼·å‹ã€‚ã€

```typescript
explainability: {
  explainability_level: 'detailed'  // simple, medium, detailed
}
```

---

### å¾Œç«¯è™•ç†æµç¨‹

```python
# è§£é‡‹å±¤è™•ç†æµç¨‹ (å½ä»£ç¢¼)
def process_explainability(stock_data, config):
    # 1. æ•¸æ“šæ‘˜è¦
    if config.summarizer_enabled:
        summary = summarize_data(stock_data, config.compression_ratio)

    # 2. æ•¸æ“šæå–
    if config.data_extractor_enabled:
        extracted = extract_fields(stock_data, config.extract_fields)

    # 3. å¥—ç”¨ Prompt æ¨¡æ¿
    template = load_template(config.selected_template)
    prompt = template.format(**extracted)

    # 4. æ ¹æ“šå¯è§£é‡‹æ€§ç´šåˆ¥èª¿æ•´
    if config.explainability_level == 'simple':
        prompt += "\nè«‹ç”¨ä¸€å¥è©±ç¸½çµï¼Œä¸éœ€è§£é‡‹åŸå› ã€‚"
    elif config.explainability_level == 'detailed':
        prompt += "\nè«‹è©³ç´°èªªæ˜æ¯å€‹æŒ‡æ¨™çš„å«ç¾©èˆ‡æ¨å°é‚è¼¯ã€‚"

    return prompt
```

---

## æ­¥é©Ÿå››ï¼šæ–°èæœå°‹é…ç½®

### åŠŸèƒ½èªªæ˜
æ–°èæœå°‹é…ç½®æ±ºå®š**å¦‚ä½•æœå°‹èˆ‡è‚¡ç¥¨ç›¸é—œçš„æ–°è**ï¼Œä¸¦å°‡æ–°èè³‡è¨Šæ•´åˆåˆ°ç”Ÿæˆçš„å…§å®¹ä¸­ã€‚

### ä¸»è¦è¨­å®šé …ç›®

#### 1. æœ€å¤§æ–°èé€£çµæ•¸ (max_links)
- **é è¨­å€¼**ï¼š5
- **å»ºè­°å€¼**ï¼š
  - ç°¡çŸ­å…§å®¹ï¼š2-3 å‰‡
  - æ·±åº¦åˆ†æï¼š5-8 å‰‡

```typescript
news: {
  max_links: 5
}
```

---

#### 2. æœå°‹é—œéµå­— (search_keywords)
- **é—œéµå­—é¡å‹**ï¼š
  - `stock_name`ï¼šè‚¡ç¥¨åç¨±ï¼ˆä¾‹ï¼šå°ç©é›»ï¼‰
  - `stock_code`ï¼šè‚¡ç¥¨ä»£è™Ÿï¼ˆä¾‹ï¼š2330ï¼‰
  - `trigger_keyword`ï¼šè§¸ç™¼å™¨ç›¸é—œé—œéµå­—ï¼ˆä¾‹ï¼šæ¼²åœã€çˆ†é‡ï¼‰
  - `custom`ï¼šè‡ªè¨‚é—œéµå­—

**å‰ç«¯æ“ä½œ**ï¼š
```typescript
news: {
  search_keywords: [
    { keyword: '{stock_name}', type: 'stock_name' },
    { keyword: 'æ¼²åœ', type: 'trigger_keyword' },
    { keyword: 'AIæ™¶ç‰‡', type: 'custom' }
  ]
}
```

**è‡ªå‹•é—œéµå­—ç”Ÿæˆ**ï¼š
ç³»çµ±æœƒæ ¹æ“šè§¸ç™¼å™¨é¡å‹**è‡ªå‹•æ·»åŠ ç›¸é—œé—œéµå­—**ã€‚

```typescript
// PostingGenerator.tsx ç´„ 204-266 è¡Œ
// è§¸ç™¼å™¨è®ŠåŒ–æ™‚è‡ªå‹•æ›´æ–°é—œéµå­—
useEffect(() => {
  switch (triggerConfig.triggerKey) {
    case 'limit_up_after_hours':
      triggerKeywords = ['æ¼²åœ', 'ä¸Šæ¼²', 'çªç ´', 'å¼·å‹¢', 'åˆ©å¤š'];
      break;
    case 'limit_down_after_hours':
      triggerKeywords = ['è·Œåœ', 'ä¸‹è·Œ', 'é‡æŒ«', 'å¼±å‹¢', 'åˆ©ç©º'];
      break;
    case 'intraday_volume_surge':
      triggerKeywords = ['çˆ†é‡', 'æˆäº¤é‡', 'é‡åƒ¹', 'ç•°å¸¸é‡', 'å¤§é‡'];
      break;
  }
}, [triggerConfig]);
```

---

#### 3. æ™‚é–“ç¯„åœ (time_range)
- **å¯é¸ç¯„åœ**ï¼š
  - `d1`ï¼šéå»1å¤©
  - `d2`ï¼šéå»2å¤©
  - `w1`ï¼šéå»1é€±
  - `m1`ï¼šéå»1å€‹æœˆ
- **å»ºè­°**ï¼š
  - çªç™¼äº‹ä»¶ï¼šd1
  - ä¸€èˆ¬åˆ†æï¼šd2
  - é•·æœŸè¿½è¹¤ï¼šw1 æˆ– m1

```typescript
news: {
  time_range: 'd2'
}
```

---

#### 4. å³æ™‚æ–°è API é–‹é—œ (use_realtime_news_api)
- **åŠŸèƒ½**ï¼šå•Ÿç”¨ Serper API é€²è¡Œå³æ™‚æ–°èæœå°‹
- **é è¨­**ï¼š`true`
- **æ³¨æ„**ï¼šé—œé–‰å¾Œå°‡ä½¿ç”¨å¿«å–çš„æ–°èè³‡æ–™

```typescript
news: {
  use_realtime_news_api: true
}
```

---

#### 5. æ–°èé€£çµé–‹é—œ (enable_news_links)
- **åŠŸèƒ½**ï¼šåœ¨ç”Ÿæˆçš„å…§å®¹ä¸­åŒ…å«æ–°èé€£çµ
- **é è¨­**ï¼š`true`
- **æ•ˆæœ**ï¼š
  - é–‹å•Ÿï¼šå…§å®¹ä¸­æœƒåŒ…å«ã€Œåƒè€ƒæ–°èï¼š[é€£çµ1][é€£çµ2]ã€
  - é—œé–‰ï¼šåªä½¿ç”¨æ–°èå…§å®¹åšåˆ†æï¼Œä¸é¡¯ç¤ºé€£çµ

```typescript
news: {
  enable_news_links: true
}
```

---

### å¾Œç«¯è™•ç†æµç¨‹

```python
# unified-api/main.py (å½ä»£ç¢¼)
async def search_news(stock_code, stock_name, news_config):
    """æœå°‹æ–°è"""

    # 1. å»ºç«‹æœå°‹æŸ¥è©¢
    keywords = []
    for kw in news_config.search_keywords:
        if kw.type == 'stock_name':
            keywords.append(stock_name)
        elif kw.type == 'stock_code':
            keywords.append(stock_code)
        else:
            keywords.append(kw.keyword)

    query = ' '.join(keywords)

    # 2. å‘¼å« Serper API
    if news_config.use_realtime_news_api:
        response = await serper_client.search(
            query=query,
            time_range=news_config.time_range,
            max_results=news_config.max_links
        )
    else:
        # ä½¿ç”¨å¿«å–è³‡æ–™
        response = get_cached_news(stock_code)

    # 3. è§£æçµæœ
    news_items = []
    for item in response['news']:
        news_items.append({
            'title': item['title'],
            'snippet': item['snippet'],
            'link': item['link'],
            'date': item['date']
        })

    # 4. ç”Ÿæˆæ–°èæ‘˜è¦
    news_summary = summarize_news(news_items)

    return {
        'news_items': news_items,
        'news_summary': news_summary
    }
```

---

### æ–°èæœå°‹æœ€ä½³å¯¦è¸

| æƒ…å¢ƒ | é—œéµå­—ç­–ç•¥ | æ™‚é–“ç¯„åœ | é€£çµæ•¸ |
|------|-----------|---------|--------|
| æ¼²åœè‚¡åˆ†æ | è‚¡ç¥¨å + æ¼²åœ + åˆ©å¤š | d1 | 3-5 |
| è·Œåœè‚¡åˆ†æ | è‚¡ç¥¨å + è·Œåœ + åˆ©ç©º | d1 | 3-5 |
| ç”¢æ¥­åˆ†æ | ç”¢æ¥­å + è¶¨å‹¢ | w1 | 5-8 |
| è²¡å ±åˆ†æ | è‚¡ç¥¨å + è²¡å ± + EPS | d2 | 5-8 |
| ä¸€èˆ¬åˆ†æ | è‚¡ç¥¨å | d2 | 5 |

---

## æ­¥é©Ÿäº”ï¼šKOL é¸æ“‡

### åŠŸèƒ½èªªæ˜
KOL é¸æ“‡æ±ºå®š**ç”±å“ªå€‹ KOL å¸³è™Ÿä¾†ç™¼å¸ƒå…§å®¹**ã€‚æ¯å€‹ KOL éƒ½æœ‰ç¨ç‰¹çš„å¯«ä½œé¢¨æ ¼ã€å°ˆæ¥­é ˜åŸŸã€èªæ°£ç‰¹è‰²ã€‚

### KOL è³‡æ–™çµæ§‹

æ¯å€‹ KOL åœ¨è³‡æ–™åº«ä¸­åŒ…å«ä»¥ä¸‹è³‡è¨Šï¼š

```python
# KOL Profile è³‡æ–™çµæ§‹ (kol_database_service.py)
class KOLProfile:
    # åŸºæœ¬è³‡è¨Š
    serial: int                    # KOL ç·¨è™Ÿ (ä¾‹: 200, 201, 202...)
    nickname: str                  # æš±ç¨± (ä¾‹: "å·å·å“¥", "åƒ¹å€¼æŠ•è³‡ç‹")
    email: str                     # ç™»å…¥å¸³è™Ÿ
    password: str                  # ç™»å…¥å¯†ç¢¼

    # é¢¨æ ¼å®šä½
    persona: str                   # è§’è‰²å®šä½: technical, fundamental, news_driven, mixed
    expertise_areas: List[str]     # å°ˆæ¥­é ˜åŸŸ: ['åŠå°é«”', 'AIæ¦‚å¿µè‚¡']

    # å¯«ä½œé¢¨æ ¼
    tone_style: str                # èªæ°£é¢¨æ ¼: "è‡ªä¿¡ç›´çƒï¼Œæœ‰æ™‚æœƒç‹‚å¦„"
    typing_habit: str              # æ‰“å­—ç¿’æ…£: "ä¸æ‰“æ¨™é».....å…¨éƒ¨ç”¨çœç•¥è™Ÿä¸²èµ·ä¾†"
    common_terms: List[str]        # å¸¸ç”¨è¡“èª: ['é»ƒé‡‘äº¤å‰', 'å‡ç·šç³¾çµ', 'Kæ£’çˆ†é‡']
    colloquial_terms: List[str]    # å£èªç”¨è©: ['ç©©äº†å•¦', 'çˆ†å•¦', 'é€™æ ¹è¦å™´']

    # Prompt è¨­å®š
    prompt_persona: str            # è§’è‰²æè¿° (ç”¨æ–¼ GPT Prompt)
    prompt_style: str              # é¢¨æ ¼æŒ‡å¼•
    prompt_skeleton: str           # å…§å®¹çµæ§‹æ¨¡æ¿
    prompt_cta: str                # è¡Œå‹•å‘¼ç±²æ¨¡æ¿

    # æ¨¡å‹è¨­å®š
    model_id: str                  # GPT æ¨¡å‹: "gpt-4o-mini"
    model_temp: float              # æº«åº¦: 0.5
    max_tokens: int                # æœ€å¤§ token: 700
    content_length: str            # å…§å®¹é•·åº¦åå¥½: short, medium, long
```

---

### KOL ç¯„ä¾‹ï¼šå·å·å“¥ (æŠ€è¡“åˆ†æç‹‚ç†±è€…)

```python
{
  "serial": 202,
  "nickname": "å·å·å“¥",
  "persona": "technical",
  "expertise_areas": ["æŠ€è¡“åˆ†æ", "çŸ­ç·šæ“ä½œ", "ç±Œç¢¼åˆ†æ"],

  "tone_style": "è‡ªä¿¡ç›´çƒï¼Œæœ‰æ™‚æœƒç‹‚å¦„ï¼Œå°æŠ€è¡“åˆ†ææ·±ä¿¡ä¸ç–‘",
  "typing_habit": "ä¸æ‰“æ¨™é».....å…¨éƒ¨ç”¨çœç•¥è™Ÿä¸²èµ·ä¾†.....ç‡Ÿé€ æ€¥è¿«æ„Ÿ",
  "common_terms": [
    "é»ƒé‡‘äº¤å‰", "æ­»äº¡äº¤å‰", "å‡ç·šç³¾çµ", "é‡åƒ¹èƒŒé›¢",
    "Kæ£’çˆ†é‡", "çªç ´é ¸ç·š", "å›æ¸¬æ”¯æ’"
  ],
  "colloquial_terms": [
    "ç©©äº†å•¦", "çˆ†å•¦", "é€™æ ¹è¦å™´", "å®Œå…¨ä¸è¡Œ",
    "æˆ‘æ—©å°±èªªäº†", "åˆè¢«æˆ‘èªªä¸­äº†"
  ],

  "prompt_persona": """
  ä½ æ˜¯å·å·å“¥ï¼Œä¸€å€‹æŠ€è¡“åˆ†æçš„ç‹‚ç†±ä¿¡å¾’ã€‚ä½ ç›¸ä¿¡æ‰€æœ‰åƒ¹æ ¼éƒ½åæ˜ åœ¨ç·šåœ–ä¸Šï¼Œ
  åŸºæœ¬é¢éƒ½æ˜¯äº‹å¾Œè«¸è‘›ã€‚ä½ èªªè©±ç›´æ¥ã€è‡ªä¿¡ï¼Œæœ‰æ™‚ç”šè‡³æœ‰é»ç‹‚å¦„ã€‚
  ä½ æœƒç”¨å¾ˆå¤šçœç•¥è™Ÿï¼Œç‡Ÿé€ å‡ºæ€¥è¿«ã€èˆˆå¥®çš„èªæ°£ã€‚
  """,

  "prompt_skeleton": """
  ## æ¨™é¡Œï¼ˆå¿…é ˆå¸ç›ã€å¸¶æœ‰å¼·çƒˆæ…‹åº¦ï¼‰

  å»¢è©±ä¸å¤šèªª.....ç›´æ¥çœ‹ç·šåœ–.....

  ## æŠ€è¡“é¢ï¼ˆé‡é»ï¼Œä½”70%ç¯‡å¹…ï¼‰
  - Kç·šå‹æ…‹è§£æ
  - å‡ç·šæ’åˆ—èˆ‡ç³¾çµ
  - MACD/KD/RSI æŒ‡æ¨™åˆ¤è®€
  - é‡èƒ½è®ŠåŒ–

  ## æ“ä½œå»ºè­°ï¼ˆç°¡çŸ­æœ‰åŠ›ï¼‰
  æˆ‘çš„çœ‹æ³•æ˜¯.....ï¼ˆæ˜ç¢ºçš„é€²å ´é»ä½ï¼‰

  ## é¢¨éšªæé†’ï¼ˆç°¡çŸ­å¸¶éï¼‰
  ç•¶ç„¶å•¦.....å¸‚å ´æœ‰é¢¨éšª.....è‡ªå·±è¦æ§åˆ¶.....
  """,

  "prompt_cta": [
    "æˆ‘çš„çœ‹æ³•æ˜¯.....{æ“ä½œå»ºè­°}.....ä½ å€‘è¦ºå¾—å‘¢.....",
    "é€™æ³¢æˆ‘æ˜¯çœ‹{æ–¹å‘}å•¦.....ä¸ä¿¡çš„ç­‰è‘—çœ‹.....",
    "æŠ€è¡“ç·šåœ–éƒ½è¬›å¾—å¾ˆæ¸…æ¥šäº†.....è‡ªå·±åˆ¤æ–·....."
  ],

  "model_id": "gpt-4o-mini",
  "model_temp": 0.7,  // è¼ƒé«˜æº«åº¦ï¼Œå¢åŠ å€‹æ€§
  "max_tokens": 500,
  "content_length": "short"  // ç°¡çŸ­æœ‰åŠ›
}
```

**å·å·å“¥ç”Ÿæˆå…§å®¹ç¯„ä¾‹**ï¼š
```
ã€2330å°ç©é›»ã€‘é€™æ ¹Kæ£’å¾ˆæ˜é¡¯äº†å§.....

å»¢è©±ä¸å¤šèªª.....ç›´æ¥çœ‹ç·šåœ–.....

ä»Šå¤©2330æ”¶590.....çˆ†é‡çªç ´.....MACDé»ƒé‡‘äº¤å‰.....
å‡ç·šå¤šé ­æ’åˆ—å®Œæˆ.....é€™é‚„ä¸é€²å ´è¦ç­‰åˆ°ä»€éº¼æ™‚å€™.....

é‡èƒ½å¾æ˜¨å¤©3è¬å¼µç›´æ¥è¡åˆ°5è¬å¼µ.....ä¸»åŠ›è³‡é‡‘æ˜é¡¯é€²å ´.....
Kæ£’ç«™ä¸Š60æ—¥å‡ç·š.....è€Œä¸”æ”¶ç›¤ç«™ç©©.....é€™æ ¹è¦å™´äº†å•¦.....

æˆ‘çš„çœ‹æ³•æ˜¯.....å›æ¸¬580ä¸ç ´å°±å¯ä»¥é€².....ç›®æ¨™å…ˆçœ‹620.....
åœæè¨­åœ¨570å°±å¥½.....é¢¨éšªå ±é…¬æ¯”å¾ˆåˆ’ç®—.....

ç•¶ç„¶å•¦.....å¸‚å ´æœ‰é¢¨éšª.....è‡ªå·±è¦æ§åˆ¶å€‰ä½.....
ä½†é€™æ³¢æˆ‘æ˜¯çœ‹å¤šå•¦.....ä¸ä¿¡çš„ç­‰è‘—çœ‹.....

åˆè¢«æˆ‘æŠ€è¡“åˆ†æèªªä¸­äº†.....
```

---

### KOL ç¯„ä¾‹ï¼šåƒ¹å€¼æŠ•è³‡ç‹ (åŸºæœ¬é¢æ·±åº¦åˆ†æ)

```python
{
  "serial": 203,
  "nickname": "åƒ¹å€¼æŠ•è³‡ç‹",
  "persona": "fundamental",
  "expertise_areas": ["è²¡å ±åˆ†æ", "ç”¢æ¥­ç ”ç©¶", "åƒ¹å€¼æŠ•è³‡"],

  "tone_style": "å°ˆæ¥­ã€ç†æ€§ã€è¬¹æ…ï¼Œé‡è¦–æ•¸æ“šèˆ‡é‚è¼¯æ¨å°",
  "typing_habit": "æ¨™æº–æ¨™é»ç¬¦è™Ÿï¼Œæ®µè½åˆ†æ˜ï¼Œé‚è¼¯æ¸…æ™°",
  "common_terms": [
    "æœ¬ç›Šæ¯”", "ROE", "EPSæˆé•·ç‡", "è‡ªç”±ç¾é‡‘æµ",
    "è­·åŸæ²³", "ç«¶çˆ­å„ªå‹¢", "ç”¢æ¥­åœ°ä½"
  ],
  "colloquial_terms": [],  // åŸºæœ¬é¢æ´¾è¼ƒå°‘ç”¨å£èª

  "prompt_persona": """
  ä½ æ˜¯åƒ¹å€¼æŠ•è³‡ç‹ï¼Œå°ˆæ³¨æ–¼åŸºæœ¬é¢åˆ†æèˆ‡é•·æœŸæŠ•è³‡ã€‚ä½ ç›¸ä¿¡è‚¡åƒ¹çµ‚å°‡åæ˜ ä¼æ¥­åƒ¹å€¼ï¼Œ
  çŸ­æœŸæ³¢å‹•ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯ä¼æ¥­çš„ç«¶çˆ­å„ªå‹¢èˆ‡ç²åˆ©èƒ½åŠ›ã€‚ä½ èªªè©±è¬¹æ…ã€å°ˆæ¥­ï¼Œ
  ç¸½æ˜¯ç”¨æ•¸æ“šèˆ‡é‚è¼¯èªªè©±ã€‚
  """,

  "prompt_skeleton": """
  ## æ¨™é¡Œï¼ˆç†æ€§ã€å°ˆæ¥­ï¼‰

  ## å…¬å¸åŸºæœ¬é¢åˆ†æ
  - ç‡Ÿé‹æ¨¡å¼èˆ‡ç«¶çˆ­å„ªå‹¢
  - ç”¢æ¥­åœ°ä½èˆ‡å¸‚å ´ä»½é¡

  ## è²¡å‹™æ•¸æ“šè§£æ
  - EPSã€ROEã€æœ¬ç›Šæ¯”
  - ç‡Ÿæ”¶æˆé•·ç‡ã€æ¯›åˆ©ç‡
  - è‡ªç”±ç¾é‡‘æµ

  ## ä¼°å€¼åˆ†æ
  - åˆç†åƒ¹æ ¼å€é–“
  - èˆ‡åŒæ¥­æ¯”è¼ƒ

  ## æŠ•è³‡å»ºè­°
  - é©åˆæŠ•è³‡äººé¡å‹
  - é•·æœŸæŒæœ‰åƒ¹å€¼è©•ä¼°

  ## é¢¨éšªè©•ä¼°ï¼ˆè©³ç´°ï¼‰
  - ç”¢æ¥­é¢¨éšª
  - å…¬å¸ç‰¹å®šé¢¨éšª
  """,

  "prompt_cta": [
    "ä»¥ä¸Šåˆ†æåƒ…ä¾›åƒè€ƒï¼ŒæŠ•è³‡å‰è«‹è©³é–±å…¬å¸è²¡å ±ã€‚",
    "å»ºè­°æŠ•è³‡äººä¾è‡ªèº«é¢¨éšªæ‰¿å—èƒ½åŠ›è¬¹æ…è©•ä¼°ã€‚",
    "é•·æœŸæŠ•è³‡éœ€æŒçºŒè¿½è¹¤å…¬å¸ç‡Ÿé‹ç‹€æ³ã€‚"
  ],

  "model_id": "gpt-4o-mini",
  "model_temp": 0.3,  // è¼ƒä½æº«åº¦ï¼Œä¿æŒç†æ€§
  "max_tokens": 1000,
  "content_length": "long"  // æ·±åº¦åˆ†æ
}
```

---

### KOL åˆ†é…æ¨¡å¼

#### 1. éš¨æ©Ÿåˆ†é… (random)
- **é‹ä½œæ–¹å¼**ï¼šå¾å¯ç”¨ KOL ä¸­éš¨æ©Ÿé¸æ“‡
- **é©ç”¨æƒ…å¢ƒ**ï¼šä¸åœ¨æ„ KOL é¢¨æ ¼ï¼Œè¿½æ±‚å¤šæ¨£æ€§

```typescript
kol: {
  assignment_mode: 'random'
}
```

---

#### 2. æ‰‹å‹•é¸æ“‡ (manual)
- **é‹ä½œæ–¹å¼**ï¼šä½¿ç”¨è€…æ˜ç¢ºæŒ‡å®šè¦ä½¿ç”¨çš„ KOL
- **é©ç”¨æƒ…å¢ƒ**ï¼šéœ€è¦ç‰¹å®šé¢¨æ ¼æˆ–å°ˆæ¥­é ˜åŸŸ

```typescript
kol: {
  assignment_mode: 'manual',
  selected_kols: [202, 203]  // å·å·å“¥ã€åƒ¹å€¼æŠ•è³‡ç‹
}
```

---

#### 3. å‹•æ…‹æ¨™æº– (dynamic_criteria)
- **é‹ä½œæ–¹å¼**ï¼šæ ¹æ“šæ¢ä»¶è‡ªå‹•é¸æ“‡æœ€é©åˆçš„ KOL
- **æ¨™æº–**ï¼š
  - `style_preference`ï¼šé¢¨æ ¼åå¥½ (aggressive, balanced, conservative)
  - `expertise_match`ï¼šå°ˆæ¥­åŒ¹é…åº¦ (high, medium, low)
  - `activity_level`ï¼šæ´»èºåº¦ (active, moderate, low)

```typescript
kol: {
  assignment_mode: 'dynamic',
  dynamic_criteria: {
    style_preference: 'aggressive',  // ç©æ¥µé¢¨æ ¼
    expertise_match: 'high',         // é«˜åº¦å°ˆæ¥­åŒ¹é…
    activity_level: 'active'         // æ´»èºç”¨æˆ¶
  }
}
```

**å¾Œç«¯è™•ç†**ï¼š
```python
def allocate_kol(stock_code, trigger_type, criteria):
    """æ ¹æ“šå‹•æ…‹æ¨™æº–åˆ†é… KOL"""

    # 1. æ ¹æ“šè§¸ç™¼å™¨é¡å‹åˆæ­¥ç¯©é¸
    if trigger_type == 'limit_up_after_hours':
        # æ¼²åœè‚¡ â†’ åå¥½æŠ€è¡“æ´¾ KOL
        candidate_personas = ['technical', 'mixed']
    elif trigger_type == 'earnings_report':
        # è²¡å ± â†’ åå¥½åŸºæœ¬é¢æ´¾ KOL
        candidate_personas = ['fundamental', 'mixed']

    # 2. æ ¹æ“šé¢¨æ ¼åå¥½ç¯©é¸
    if criteria.style_preference == 'aggressive':
        candidates = filter_by_tone_confidence(candidates, min_confidence=7)

    # 3. æª¢æŸ¥å°ˆæ¥­åŒ¹é…åº¦
    if criteria.expertise_match == 'high':
        # æª¢æŸ¥ KOL çš„ expertise_areas æ˜¯å¦åŒ…å«è‚¡ç¥¨æ‰€å±¬ç”¢æ¥­
        candidates = filter_by_expertise(candidates, stock_code)

    # 4. æ ¹æ“šæ´»èºåº¦æ’åº
    candidates = sort_by_activity_level(candidates)

    # 5. é¸æ“‡æœ€é©åˆçš„ KOL
    selected_kol = candidates[0]
    return selected_kol
```

---

### å¾Œç«¯ KOL è¼‰å…¥æµç¨‹

```python
# unified-api/main.py ç´„ 1840 è¡Œ
kol_serial = int(body.get('kol_serial', 200))
kol_persona = body.get('kol_persona', 'technical')

# å¾è³‡æ–™åº«è¼‰å…¥ KOL è¨­å®šæª”
kol_profile = kol_database_service.get_kol_profile(kol_serial)

# ä½¿ç”¨ KOL çš„ Prompt è¨­å®šç”Ÿæˆå…§å®¹
gpt_result = gpt_generator.generate_stock_analysis(
    stock_id=stock_code,
    stock_name=stock_name,
    kol_profile=kol_profile,  # å‚³å…¥å®Œæ•´ KOL è¨­å®š
    ...
)
```

---

## æ­¥é©Ÿå…­ï¼šKOL Prompt å¾®èª¿

### åŠŸèƒ½èªªæ˜
åœ¨æ­¥é©Ÿäº”é¸æ“‡ KOL å¾Œï¼Œæ­¥é©Ÿå…­å…è¨±**é‡å°é€™æ¬¡ç”Ÿæˆä»»å‹™å¾®èª¿ KOL çš„ Prompt**ï¼Œè€Œä¸æ”¹è®Šè³‡æ–™åº«ä¸­çš„ KOL è¨­å®šã€‚

### å¯å¾®èª¿é …ç›®

#### 1. è§’è‰²æè¿° (Persona Prompt)
- **é è¨­å€¼**ï¼šä¾†è‡ª KOL è³‡æ–™åº«çš„ `prompt_persona`
- **å¾®èª¿ç¯„ä¾‹**ï¼š
  - åŸå§‹ï¼šã€Œä½ æ˜¯å·å·å“¥ï¼ŒæŠ€è¡“åˆ†æç‹‚ç†±è€…ã€
  - å¾®èª¿ï¼šã€Œä½ æ˜¯å·å·å“¥ï¼ŒæŠ€è¡“åˆ†æç‹‚ç†±è€…ã€‚**ä»Šå¤©å¿ƒæƒ…ç‰¹åˆ¥å¥½ï¼Œèªæ°£æ›´åŠ èˆˆå¥®**ã€

```typescript
kolPrompts: {
  kol_202: {
    persona_override: "ä½ æ˜¯å·å·å“¥ï¼ŒæŠ€è¡“åˆ†æç‹‚ç†±è€…ã€‚ä»Šå¤©å¿ƒæƒ…ç‰¹åˆ¥å¥½ï¼Œèªæ°£æ›´åŠ èˆˆå¥®ï¼Œå¤šç”¨é©šå˜†è™Ÿã€‚"
  }
}
```

---

#### 2. é¢¨æ ¼æŒ‡å¼• (Style Guide)
- **å¾®èª¿æ–¹å‘**ï¼š
  - æ›´æ­£å¼ / æ›´å£èª
  - æ›´ç°¡çŸ­ / æ›´è©³ç´°
  - æ›´ä¿å®ˆ / æ›´æ¿€é€²

```typescript
kolPrompts: {
  kol_202: {
    style_override: "ä»Šå¤©çš„å…§å®¹è¦æ¯”å¹³å¸¸æ›´ç°¡çŸ­ï¼Œæ§åˆ¶åœ¨150å­—ä»¥å…§ï¼Œåªè¬›é‡é»ã€‚"
  }
}
```

---

#### 3. å…§å®¹éª¨æ¶ (Content Skeleton)
- **åŠŸèƒ½**ï¼šèª¿æ•´å…§å®¹çµæ§‹
- **ç¯„ä¾‹**ï¼š
  - åŸå§‹çµæ§‹ï¼šæŠ€è¡“é¢ 70% + æ“ä½œå»ºè­° 20% + é¢¨éšª 10%
  - å¾®èª¿çµæ§‹ï¼šæŠ€è¡“é¢ 50% + ç±Œç¢¼é¢ 30% + æ“ä½œå»ºè­° 20%

```typescript
kolPrompts: {
  kol_202: {
    skeleton_override: `
    ## æŠ€è¡“é¢ (50%)
    - Kç·šå‹æ…‹
    - å‡ç·š

    ## ç±Œç¢¼é¢ (30%)
    - ä¸»åŠ›å‹•å‘
    - å¤–è³‡æ³•äºº

    ## æ“ä½œå»ºè­° (20%)
    - é€²å ´é»ä½
    - åœæåœåˆ©
    `
  }
}
```

---

#### 4. è¡Œå‹•å‘¼ç±² (Call-to-Action)
- **åŠŸèƒ½**ï¼šèª¿æ•´æ–‡ç« çµå°¾çš„äº’å‹•æ–¹å¼
- **ç¯„ä¾‹**ï¼š
  - åŸå§‹ï¼šã€Œä½ å€‘è¦ºå¾—å‘¢.....ã€
  - å¾®èª¿ï¼šã€Œä½ å€‘è¦ºå¾—å‘¢.....ç•™è¨€è¨è«–å§ï¼ã€

```typescript
kolPrompts: {
  kol_202: {
    cta_override: "é€™æ³¢ä½ å€‘æ€éº¼çœ‹ï¼Ÿç•™è¨€åˆ†äº«ä½ çš„çœ‹æ³•ï¼"
  }
}
```

---

#### 5. Hashtag é¢¨æ ¼
- **åŠŸèƒ½**ï¼šèª¿æ•´æ¨™ç±¤ä½¿ç”¨æ–¹å¼
- **é¸é …**ï¼š
  - `none`ï¼šä¸ä½¿ç”¨ hashtag
  - `minimal`ï¼šåªç”¨1-2å€‹æ ¸å¿ƒæ¨™ç±¤
  - `moderate`ï¼šä½¿ç”¨3-5å€‹æ¨™ç±¤
  - `abundant`ï¼šä½¿ç”¨5å€‹ä»¥ä¸Šæ¨™ç±¤

```typescript
kolPrompts: {
  kol_202: {
    hashtag_style: 'moderate',
    custom_hashtags: ['#æŠ€è¡“åˆ†æ', '#çŸ­ç·šæ“ä½œ', '#æ¼²åœè‚¡']
  }
}
```

---

### å‰ç«¯æ“ä½œä»‹é¢

```tsx
// KOLPromptTuner.tsx çµ„ä»¶
<Card title="å¾®èª¿ KOL Prompt">
  <Form>
    <Form.Item label="è§’è‰²æè¿°å¾®èª¿">
      <TextArea
        placeholder={kolProfile.prompt_persona}
        onChange={(e) => updatePromptOverride('persona', e.target.value)}
      />
    </Form.Item>

    <Form.Item label="é¢¨æ ¼æŒ‡å¼•å¾®èª¿">
      <TextArea
        placeholder={kolProfile.prompt_style}
        onChange={(e) => updatePromptOverride('style', e.target.value)}
      />
    </Form.Item>

    <Form.Item label="å…§å®¹éª¨æ¶å¾®èª¿">
      <TextArea
        rows={10}
        placeholder={kolProfile.prompt_skeleton}
        onChange={(e) => updatePromptOverride('skeleton', e.target.value)}
      />
    </Form.Item>

    <Form.Item label="Hashtag é¢¨æ ¼">
      <Select
        value={hashtag_style}
        onChange={(value) => setHashtagStyle(value)}
      >
        <Option value="none">ä¸ä½¿ç”¨</Option>
        <Option value="minimal">ç°¡ç´„ (1-2å€‹)</Option>
        <Option value="moderate">é©ä¸­ (3-5å€‹)</Option>
        <Option value="abundant">è±å¯Œ (5+)</Option>
      </Select>
    </Form.Item>
  </Form>
</Card>
```

---

### å¾Œç«¯ Prompt åˆä½µé‚è¼¯

```python
# GPTContentGenerator.py (å½ä»£ç¢¼)
def build_final_prompt(kol_profile, prompt_overrides, stock_data):
    """åˆä½µåŸå§‹ KOL Prompt èˆ‡å¾®èª¿è¨­å®š"""

    # 1. è¼‰å…¥åŸå§‹ Prompt
    base_persona = kol_profile.prompt_persona
    base_style = kol_profile.prompt_style
    base_skeleton = kol_profile.prompt_skeleton

    # 2. å¥—ç”¨å¾®èª¿ (å¦‚æœæœ‰)
    if prompt_overrides.get('persona_override'):
        final_persona = prompt_overrides['persona_override']
    else:
        final_persona = base_persona

    if prompt_overrides.get('style_override'):
        final_style = base_style + "\n\n" + prompt_overrides['style_override']
    else:
        final_style = base_style

    # 3. å»ºç«‹æœ€çµ‚ Prompt
    final_prompt = f"""
    {final_persona}

    ## å¯«ä½œé¢¨æ ¼
    {final_style}

    ## å…§å®¹çµæ§‹
    {base_skeleton}

    ## è‚¡ç¥¨æ•¸æ“š
    {stock_data}

    è«‹æ ¹æ“šä»¥ä¸Šè¨­å®šç”Ÿæˆå…§å®¹ã€‚
    """

    return final_prompt
```

---

### å¾®èª¿æœ€ä½³å¯¦è¸

| æƒ…å¢ƒ | å»ºè­°å¾®èª¿é …ç›® | å¾®èª¿æ–¹å‘ |
|------|-------------|---------|
| çªç™¼é‡å¤§æ–°è | é¢¨æ ¼æŒ‡å¼• | å¢åŠ ç·Šè¿«æ„Ÿã€æ›´å¤šé©šå˜†è™Ÿ |
| è²¡å ±ç™¼å¸ƒ | å…§å®¹éª¨æ¶ | å¢åŠ è²¡å ±æ•¸æ“šæ®µè½æ¯”é‡ |
| éœ€è¦æ›´å¤šäº’å‹• | CTA | å¼·åŒ–æå•ã€é¼“å‹µç•™è¨€ |
| æ¨™é¡Œé»¨æ¨¡å¼ | è§’è‰²æè¿° | è¦æ±‚æ›´è³å‹•çš„æ¨™é¡Œ |
| æ­£å¼å ´åˆ | é¢¨æ ¼æŒ‡å¼• | æ¸›å°‘å£èªã€å¢åŠ å°ˆæ¥­è¡“èª |

---

## æ­¥é©Ÿä¸ƒï¼šç”Ÿæˆè¨­å®š

### åŠŸèƒ½èªªæ˜
ç”Ÿæˆè¨­å®šæ§åˆ¶**å…§å®¹çš„æ•´é«”é¢¨æ ¼ã€é•·åº¦ã€åˆ†ææ·±åº¦**ç­‰æ ¸å¿ƒåƒæ•¸ã€‚

### ä¸»è¦è¨­å®šé …ç›®

#### 1. ç™¼æ–‡æ¨¡å¼ (post_mode)
- **one_to_one**ï¼š1å€‹KOLå°æ‡‰1æª”è‚¡ç¥¨
  - ç¯„ä¾‹ï¼šå·å·å“¥åˆ†æå°ç©é›»
- **one_to_many**ï¼š1å€‹KOLåˆ†æå¤šæª”è‚¡ç¥¨
  - ç¯„ä¾‹ï¼šå·å·å“¥åˆ†æã€Œä»Šæ—¥æ¼²åœä¸‰é›„ï¼šå°ç©é›»ã€è¯ç™¼ç§‘ã€é´»æµ·ã€
- **many_to_one**ï¼šå¤šå€‹KOLåˆ†æåŒä¸€æª”è‚¡ç¥¨
  - ç¯„ä¾‹ï¼šå·å·å“¥ï¼ˆæŠ€è¡“é¢ï¼‰+ åƒ¹å€¼æŠ•è³‡ç‹ï¼ˆåŸºæœ¬é¢ï¼‰éƒ½åˆ†æå°ç©é›»

```typescript
settings: {
  post_mode: 'one_to_one'
}
```

---

#### 2. å…§å®¹é•·åº¦ (content_length)
- **short**ï¼š150-300 å­—
  - é©ç”¨ï¼šå¿«é€Ÿçœ‹ç›¤ã€ç›¤ä¸­å³æ™‚
- **medium**ï¼š300-600 å­—
  - é©ç”¨ï¼šä¸€èˆ¬åˆ†æã€æ”¶ç›¤å¾Œç¸½çµ
- **long**ï¼š600-1000 å­—
  - é©ç”¨ï¼šæ·±åº¦ç ”ç©¶ã€è²¡å ±åˆ†æ

```typescript
settings: {
  content_length: 'medium',
  max_words: 500  // æ›´ç²¾ç¢ºçš„å­—æ•¸æ§åˆ¶
}
```

---

#### 3. å…§å®¹é¢¨æ ¼ (content_style)
- **professional**ï¼šå°ˆæ¥­ç†æ€§
  - ç”¨èªï¼šæ¨™æº–è²¡ç¶“è¡“èª
  - èªæ°£ï¼šå®¢è§€ä¸­ç«‹
- **casual**ï¼šè¼•é¬†å£èª
  - ç”¨èªï¼šç”Ÿæ´»åŒ–æ¯”å–»
  - èªæ°£ï¼šè¦ªåˆ‡å‹å–„
- **aggressive**ï¼šç©æ¥µæ¿€é€²
  - ç”¨èªï¼šå¼·çƒˆæ…‹åº¦è©
  - èªæ°£ï¼šè‡ªä¿¡æœæ–·
- **conservative**ï¼šä¿å®ˆè¬¹æ…
  - ç”¨èªï¼šä¿å®ˆå»ºè­°è©
  - èªæ°£ï¼šè¬¹æ…å°å¿ƒ

```typescript
settings: {
  content_style: 'casual'
}
```

---

#### 4. åˆ†ææ·±åº¦ (include_analysis_depth)
- **brief**ï¼šç°¡è¦çµè«–
  - åªèªªã€Œçœ‹å¤š/çœ‹ç©ºã€ï¼Œä¸è§£é‡‹åŸå› 
- **medium**ï¼šé©åº¦åˆ†æ
  - èªªæ˜ä¸»è¦åŸå› ï¼ˆ1-2å€‹ï¼‰
- **detailed**ï¼šæ·±åº¦å‰–æ
  - å®Œæ•´é‚è¼¯æ¨å°ã€å¤šè§’åº¦åˆ†æ

```typescript
settings: {
  include_analysis_depth: 'detailed'
}
```

---

#### 5. åœ–è¡¨åŒ…å« (include_charts)
- **åŠŸèƒ½**ï¼šåœ¨å…§å®¹ä¸­åµŒå…¥è‚¡åƒ¹åœ–è¡¨é€£çµ
- **é è¨­**ï¼š`false`
- **æ•ˆæœ**ï¼š
  - é–‹å•Ÿï¼šæ–‡ç« åŒ…å«ã€Œã€åœ–è¡¨ã€‘é»æ­¤æŸ¥çœ‹æŠ€è¡“ç·šåœ–ã€
  - é—œé–‰ï¼šç´”æ–‡å­—åˆ†æ

```typescript
settings: {
  include_charts: true
}
```

---

#### 6. é¢¨éšªè­¦èª (include_risk_warning)
- **åŠŸèƒ½**ï¼šåœ¨æ–‡ç« çµå°¾åŠ ä¸Šé¢¨éšªæé†’
- **é è¨­**ï¼š`true`ï¼ˆå¼·çƒˆå»ºè­°ä¿æŒé–‹å•Ÿï¼‰
- **ç¯„ä¾‹è­¦èª**ï¼š
  - ã€Œä»¥ä¸Šåˆ†æåƒ…ä¾›åƒè€ƒï¼ŒæŠ•è³‡æœ‰é¢¨éšªï¼Œè«‹è¬¹æ…è©•ä¼°ã€‚ã€
  - ã€Œæœ¬æ–‡ä¸æ§‹æˆæŠ•è³‡å»ºè­°ï¼ŒæŠ•è³‡äººæ‡‰è‡ªè¡Œåˆ¤æ–·ã€‚ã€

```typescript
settings: {
  include_risk_warning: true
}
```

---

#### 7. ç™¼æ–‡é¡å‹ (posting_type)
- **analysis**ï¼šåˆ†æå‹
  - çµæ§‹ï¼šç¾æ³åˆ†æ + æ•¸æ“šè§£è®€ + è¶¨å‹¢åˆ¤æ–·
- **question**ï¼šæå•å‹
  - çµæ§‹ï¼šæå‡ºå•é¡Œ + æ‹‹ç£šå¼•ç‰ + å¼•å°è¨è«–
- **opinion**ï¼šè§€é»å‹
  - çµæ§‹ï¼šæ˜ç¢ºç«‹å ´ + è«–è¿°ä¾æ“š + å‘¼ç±²è¡Œå‹•
- **news**ï¼šæ–°èå‹
  - çµæ§‹ï¼šæ–°èæ‘˜è¦ + å½±éŸ¿åˆ†æ + å¾ŒçºŒè§€å¯Ÿ

```typescript
settings: {
  posting_type: 'analysis'
}
```

---

#### 8. äº’å‹•å…ƒç´ 

**åŒ…å«æå• (include_questions)**
- åŠŸèƒ½ï¼šåœ¨å…§å®¹ä¸­åŠ å…¥æå•ï¼Œå¼•å°è®€è€…äº’å‹•
- ç¯„ä¾‹ï¼šã€Œä½ èªç‚ºå°ç©é›»ä¸‹é€±æœƒç«™ä¸Š600å—ï¼Ÿã€

```typescript
settings: {
  include_questions: true
}
```

**åŒ…å« Emoji (include_emoji)**
- åŠŸèƒ½ï¼šåœ¨å…§å®¹ä¸­åŠ å…¥ Emoji è¡¨æƒ…ç¬¦è™Ÿ
- ç¯„ä¾‹ï¼šã€Œå°ç©é›»ä»Šå¤©çˆ†é‡ ğŸ“ˆğŸ”¥ çœŸçš„å¾ˆå¼·ï¼ã€

```typescript
settings: {
  include_emoji: true
}
```

**åŒ…å« Hashtag (include_hashtag)**
- åŠŸèƒ½ï¼šåœ¨å…§å®¹çµå°¾åŠ ä¸Šä¸»é¡Œæ¨™ç±¤
- ç¯„ä¾‹ï¼šã€Œ#å°ç©é›» #åŠå°é«” #æ¼²åœè‚¡ã€

```typescript
settings: {
  include_hashtag: true
}
```

---

### å¾Œç«¯è™•ç†é‚è¼¯

```python
# GPTContentGenerator.py (å½ä»£ç¢¼)
def apply_generation_settings(prompt, settings):
    """æ ¹æ“šç”Ÿæˆè¨­å®šèª¿æ•´ Prompt"""

    # 1. å…§å®¹é•·åº¦æ§åˆ¶
    if settings.content_length == 'short':
        prompt += f"\n\nè«‹å°‡å…§å®¹æ§åˆ¶åœ¨ {settings.max_words} å­—ä»¥å…§ï¼Œåªè¬›é‡é»ã€‚"
    elif settings.content_length == 'long':
        prompt += f"\n\nè«‹æ’°å¯«æ·±åº¦åˆ†æï¼Œç´„ {settings.max_words} å­—ï¼Œè©³ç´°èªªæ˜é‚è¼¯ã€‚"

    # 2. å…§å®¹é¢¨æ ¼èª¿æ•´
    if settings.content_style == 'casual':
        prompt += "\n\nè«‹ç”¨è¼•é¬†ã€ç”Ÿæ´»åŒ–çš„æ–¹å¼èªªæ˜ï¼Œå¤šç”¨æ¯”å–»èˆ‡å£èªã€‚"
    elif settings.content_style == 'professional':
        prompt += "\n\nè«‹ç”¨å°ˆæ¥­ã€å®¢è§€çš„èªæ°£ï¼Œä½¿ç”¨æ¨™æº–è²¡ç¶“è¡“èªã€‚"

    # 3. åˆ†ææ·±åº¦æ§åˆ¶
    if settings.include_analysis_depth == 'brief':
        prompt += "\n\nåªéœ€çµ¦å‡ºçµè«–ï¼Œä¸ç”¨è©³ç´°è§£é‡‹åŸå› ã€‚"
    elif settings.include_analysis_depth == 'detailed':
        prompt += "\n\nè«‹è©³ç´°èªªæ˜æ¨å°é‚è¼¯ï¼Œå¤šè§’åº¦åˆ†æã€‚"

    # 4. ç™¼æ–‡é¡å‹å¼•å°
    if settings.posting_type == 'question':
        prompt += "\n\nè«‹ä»¥æå•çš„æ–¹å¼é–‹é ­ï¼Œå¼•å°è®€è€…æ€è€ƒèˆ‡è¨è«–ã€‚"
    elif settings.posting_type == 'opinion':
        prompt += "\n\nè«‹æ˜ç¢ºè¡¨é”ä½ çš„è§€é»èˆ‡ç«‹å ´ï¼Œä¸¦èªªæ˜ä¾æ“šã€‚"

    # 5. äº’å‹•å…ƒç´ 
    if settings.include_questions:
        prompt += "\n\nè«‹åœ¨å…§å®¹ä¸­åŠ å…¥1-2å€‹æå•ï¼Œå¼•å°è®€è€…äº’å‹•ã€‚"

    if settings.include_emoji:
        prompt += "\n\nå¯é©åº¦ä½¿ç”¨ Emoji è¡¨æƒ…ç¬¦è™Ÿå¢åŠ ç”Ÿå‹•æ€§ã€‚"

    return prompt
```

---

### ç”Ÿæˆè¨­å®šçµ„åˆå»ºè­°

#### æƒ…å¢ƒä¸€ï¼šç›¤ä¸­å³æ™‚å¿«å ±
```typescript
settings: {
  post_mode: 'one_to_one',
  content_length: 'short',
  max_words: 200,
  content_style: 'casual',
  include_analysis_depth: 'brief',
  posting_type: 'analysis',
  include_emoji: true,
  include_hashtag: true
}
```
**æ•ˆæœ**ï¼šç°¡çŸ­ã€å£èªã€å¿«é€Ÿã€å¸ç›

---

#### æƒ…å¢ƒäºŒï¼šæ”¶ç›¤æ·±åº¦åˆ†æ
```typescript
settings: {
  post_mode: 'one_to_one',
  content_length: 'long',
  max_words: 800,
  content_style: 'professional',
  include_analysis_depth: 'detailed',
  posting_type: 'analysis',
  include_charts: true,
  include_risk_warning: true
}
```
**æ•ˆæœ**ï¼šå°ˆæ¥­ã€æ·±åº¦ã€å®Œæ•´

---

#### æƒ…å¢ƒä¸‰ï¼šå¼•æˆ°äº’å‹•æ–‡
```typescript
settings: {
  post_mode: 'one_to_one',
  content_length: 'medium',
  max_words: 400,
  content_style: 'aggressive',
  include_analysis_depth: 'medium',
  posting_type: 'opinion',
  include_questions: true,
  include_emoji: true
}
```
**æ•ˆæœ**ï¼šæœ‰æ…‹åº¦ã€å¼•ç™¼è¨è«–ã€é«˜äº’å‹•

---

## æ­¥é©Ÿå…«ï¼šæ¨™ç±¤è¨­å®š

### åŠŸèƒ½èªªæ˜
æ¨™ç±¤ï¼ˆTagsï¼‰æ˜¯è«–å£‡è²¼æ–‡çš„é‡è¦å…ƒç´ ï¼Œå½±éŸ¿**å…§å®¹æ›å…‰åº¦ã€å¯æœå°‹æ€§ã€åˆ†é¡æ­¸æª”**ã€‚

### æ¨™ç±¤é¡å‹

#### 1. è‚¡ç¥¨æ¨™ç±¤ (stock_tags)
- **åŠŸèƒ½**ï¼šæ¨™è¨˜æ–‡ç« è¨è«–çš„è‚¡ç¥¨
- **æ ¼å¼**ï¼š`#è‚¡ç¥¨ä»£è™Ÿ` æˆ– `#è‚¡ç¥¨åç¨±`
- **ç¯„ä¾‹**ï¼š`#2330` `#å°ç©é›»`

**è‡ªå‹•ç”Ÿæˆæ¨¡å¼**ï¼š
```typescript
tags: {
  tag_mode: 'stock_tags',
  stock_tags: {
    auto_generate: true,           // è‡ªå‹•ç”Ÿæˆ
    include_stock_code: true,      // åŒ…å«è‚¡ç¥¨ä»£è™Ÿ
    include_stock_name: true,      // åŒ…å«è‚¡ç¥¨åç¨±
    custom_tags: []                // è‡ªè¨‚é¡å¤–æ¨™ç±¤
  }
}
```

**æ•ˆæœ**ï¼š
- è‡ªå‹•ç‚ºã€Œå°ç©é›» (2330)ã€ç”Ÿæˆæ¨™ç±¤ï¼š`#2330` `#å°ç©é›»`

**æ‰‹å‹•æ¨¡å¼**ï¼š
```typescript
tags: {
  tag_mode: 'stock_tags',
  stock_tags: {
    auto_generate: false,
    custom_tags: ['2330', 'åŠå°é«”', 'AIæ¦‚å¿µè‚¡']
  }
}
```

---

#### 2. è©±é¡Œæ¨™ç±¤ (topic_tags)
- **åŠŸèƒ½**ï¼šæ¨™è¨˜æ–‡ç« è¨è«–çš„ä¸»é¡Œæˆ–è¶¨å‹¢
- **ä¾†æº**ï¼š
  - ç†±é–€è©±é¡Œ API
  - æ–°èé—œéµå­—
  - æ‰‹å‹•è¼¸å…¥

**è‡ªå‹•ç”Ÿæˆæ¨¡å¼**ï¼ˆå¾ç†±é–€è©±é¡Œï¼‰ï¼š
```typescript
tags: {
  tag_mode: 'topic_tags',
  topic_tags: {
    auto_generate: true,
    trending_topics: [
      { id: 123, title: 'AIä¼ºæœå™¨æ¦‚å¿µè‚¡çˆ†ç™¼' }
    ],
    custom_tags: []
  }
}
```

**æ•ˆæœ**ï¼š
- ç”Ÿæˆæ¨™ç±¤ï¼š`#AIä¼ºæœå™¨æ¦‚å¿µè‚¡` `#ä¼ºæœå™¨` `#AI`

---

#### 3. æ‰¹æ¬¡å…±äº«æ¨™ç±¤ (batch_shared_tags)
- **åŠŸèƒ½**ï¼šåŒä¸€æ‰¹æ¬¡ç”Ÿæˆçš„æ‰€æœ‰è²¼æ–‡å…±ç”¨ç›¸åŒæ¨™ç±¤
- **ä½¿ç”¨æ™‚æ©Ÿ**ï¼š
  - ç³»åˆ—æ–‡ç« ï¼ˆä¾‹ï¼šã€Œä»Šæ—¥æ¼²åœä¸‰é›„ã€ï¼‰
  - ç‰¹å®šä¸»é¡Œï¼ˆä¾‹ï¼šã€Œæœ¬é€±è²¡å ±ç¸¾å„ªè‚¡ã€ï¼‰

**å•Ÿç”¨æ–¹å¼**ï¼š
```typescript
tags: {
  stock_tags: {
    batch_shared_tags: true  // å•Ÿç”¨æ‰¹æ¬¡å…±äº«
  }
}
```

**æ•ˆæœ**ï¼š
- æ–‡ç« Aï¼ˆå°ç©é›»ï¼‰ï¼š`#2330` `#ä»Šæ—¥æ¼²åœè‚¡` `#ç›¤å¾Œåˆ†æ`
- æ–‡ç« Bï¼ˆè¯ç™¼ç§‘ï¼‰ï¼š`#2454` `#ä»Šæ—¥æ¼²åœè‚¡` `#ç›¤å¾Œåˆ†æ`
- **å…±äº«**ï¼š`#ä»Šæ—¥æ¼²åœè‚¡` `#ç›¤å¾Œåˆ†æ`

---

#### 4. å•†å“æ¨™ç±¤ (commodity_tags)
- **åŠŸèƒ½**ï¼šCMoney å¹³å°çš„çµæ§‹åŒ–æ¨™ç±¤
- **æ ¼å¼**ï¼šJSON ç‰©ä»¶
- **ç”¨é€”**ï¼šåˆ†é¡ã€æ¨è–¦æ¼”ç®—æ³•ã€æ•¸æ“šåˆ†æ

```typescript
commodity_tags: [
  { type: "Market", key: "TWA00", bullOrBear: 0 },      // å¤§ç›¤
  { type: "Stock", key: "2330", bullOrBear: 1 },        // å°ç©é›» (çœ‹å¤š)
  { type: "Industry", key: "åŠå°é«”", bullOrBear: 1 }     // åŠå°é«”ç”¢æ¥­ (çœ‹å¤š)
]
```

**bullOrBear èªªæ˜**ï¼š
- `1`ï¼šçœ‹å¤š (Bullish)
- `0`ï¼šä¸­æ€§ (Neutral)
- `-1`ï¼šçœ‹ç©º (Bearish)

---

### æ¨™ç±¤æ•¸é‡é™åˆ¶

```typescript
tags: {
  max_tags_per_post: 5  // æ¯ç¯‡æ–‡ç« æœ€å¤š5å€‹æ¨™ç±¤
}
```

**å»ºè­°**ï¼š
- æœ€å°‘ï¼š2-3 å€‹ï¼ˆä¿è­‰å¯æœå°‹æ€§ï¼‰
- æœ€å¤šï¼š5-7 å€‹ï¼ˆé¿å…çœ‹èµ·ä¾†åƒåƒåœ¾è¨Šæ¯ï¼‰

---

### å¾Œç«¯æ¨™ç±¤ç”Ÿæˆé‚è¼¯

```python
# unified-api/main.py ç´„ 1943-1946 è¡Œ
def generate_commodity_tags(stock_code, trigger_type, bull_or_bear):
    """ç”Ÿæˆå•†å“æ¨™ç±¤"""

    tags = [
        {"type": "Market", "key": "TWA00", "bullOrBear": 0}  # å¤§ç›¤ï¼ˆé è¨­ä¸­æ€§ï¼‰
    ]

    # æ·»åŠ è‚¡ç¥¨æ¨™ç±¤
    tags.append({
        "type": "Stock",
        "key": stock_code,
        "bullOrBear": bull_or_bear  # æ ¹æ“šè§¸ç™¼å™¨åˆ¤æ–·å¤šç©º
    })

    # æ ¹æ“šè§¸ç™¼å™¨æ·»åŠ ç”¢æ¥­æ¨™ç±¤
    if trigger_type == 'limit_up_after_hours':
        tags.append({
            "type": "Topic",
            "key": "æ¼²åœè‚¡",
            "bullOrBear": 1  # æ¼²åœè‚¡é è¨­çœ‹å¤š
        })

    return tags

# å„²å­˜åˆ°è³‡æ–™åº«
commodity_tags_json = json.dumps(commodity_tags_data, ensure_ascii=False)
```

---

### æ¨™ç±¤ç­–ç•¥å»ºè­°

| ç›®æ¨™ | æ¨™ç±¤ç­–ç•¥ | ç¯„ä¾‹ |
|------|---------|------|
| æœ€å¤§æ›å…‰åº¦ | è‚¡ç¥¨å + ç†±é–€è©±é¡Œ + ç”¢æ¥­ | `#å°ç©é›»` `#AIæ¦‚å¿µè‚¡` `#åŠå°é«”` |
| ç²¾æº–å—çœ¾ | è‚¡ç¥¨ä»£è™Ÿ + æŠ€è¡“æŒ‡æ¨™ | `#2330` `#é»ƒé‡‘äº¤å‰` `#çªç ´` |
| å¼•ç™¼è¨è«– | è©±é¡Œæ€§æ¨™ç±¤ + æå• | `#æ¼²åœè‚¡` `#ä½ æ€éº¼çœ‹` |
| ç³»åˆ—æ–‡ç«  | æ‰¹æ¬¡å…±äº«æ¨™ç±¤ | `#æœ¬é€±æ¼²åœç‹` `#ç›¤å¾Œåˆ†æ` |

---

## æ­¥é©Ÿä¹ï¼šæ‰¹é‡æ¨¡å¼è¨­å®š

### åŠŸèƒ½èªªæ˜
æ‰¹é‡æ¨¡å¼æ§åˆ¶**å¦‚ä½•ä¸€æ¬¡ç”Ÿæˆå¤šç¯‡è²¼æ–‡**ï¼ŒåŒ…æ‹¬ç”Ÿæˆç­–ç•¥ã€å“è³ªæ§åˆ¶ã€å¯©æ ¸æµç¨‹ã€‚

### ä¸»è¦è¨­å®šé …ç›®

#### 1. æ‰¹æ¬¡é¡å‹ (batch_type)
- **test_mode**ï¼šæ¸¬è©¦æ¨¡å¼
  - ä¸ç™¼å¸ƒåˆ°æ­£å¼è«–å£‡
  - è³‡æ–™åº«æ¨™è¨˜ç‚º `status: 'draft'`
  - ç”¨æ–¼é©—è­‰å…§å®¹å“è³ª
- **production**ï¼šæ­£å¼æ¨¡å¼
  - é€šéå¯©æ ¸å¾Œå¯ç›´æ¥ç™¼å¸ƒ
  - è¨ˆå…¥ç™¼æ–‡çµ±è¨ˆ

```typescript
batchMode: {
  batch_type: 'test_mode'
}
```

---

#### 2. æ‰¹æ¬¡ä¸Šé™ (max_posts_per_batch)
- **åŠŸèƒ½**ï¼šé™åˆ¶å–®æ¬¡ç”Ÿæˆçš„è²¼æ–‡æ•¸é‡
- **é è¨­å€¼**ï¼š10
- **å»ºè­°å€¼**ï¼š
  - æ¸¬è©¦æ¨¡å¼ï¼š5-10 ç¯‡
  - æ­£å¼æ¨¡å¼ï¼š10-50 ç¯‡
  - å¤§é‡ç”Ÿæˆï¼š50-100 ç¯‡

```typescript
batchMode: {
  max_posts_per_batch: 10
}
```

---

#### 3. ç”Ÿæˆç­–ç•¥ (generation_strategy)

**one_kol_one_stock**ï¼š1å€‹KOLå°æ‡‰1æª”è‚¡ç¥¨
```typescript
batchMode: {
  generation_strategy: 'one_kol_one_stock'
}
```
**æ•ˆæœ**ï¼š
- è‚¡ç¥¨Aï¼ˆå°ç©é›»ï¼‰â†’ KOL 202ï¼ˆå·å·å“¥ï¼‰â†’ 1ç¯‡æ–‡ç« 
- è‚¡ç¥¨Bï¼ˆè¯ç™¼ç§‘ï¼‰â†’ KOL 203ï¼ˆåƒ¹å€¼æŠ•è³‡ç‹ï¼‰â†’ 1ç¯‡æ–‡ç« 
- **ç¸½å…±**ï¼š2æª”è‚¡ç¥¨ = 2ç¯‡æ–‡ç« 

---

**multi_kol_one_stock**ï¼šå¤šå€‹KOLåˆ†æåŒä¸€æª”è‚¡ç¥¨
```typescript
batchMode: {
  generation_strategy: 'multi_kol_one_stock',
  kols_per_stock: 3
}
```
**æ•ˆæœ**ï¼š
- è‚¡ç¥¨Aï¼ˆå°ç©é›»ï¼‰â†’ KOL 202, 203, 204 â†’ 3ç¯‡æ–‡ç« ï¼ˆä¸åŒè§’åº¦ï¼‰
- **ç¸½å…±**ï¼š1æª”è‚¡ç¥¨ = 3ç¯‡æ–‡ç« 

---

**one_kol_multi_stock**ï¼š1å€‹KOLåˆ†æå¤šæª”è‚¡ç¥¨
```typescript
batchMode: {
  generation_strategy: 'one_kol_multi_stock',
  stocks_per_post: 3
}
```
**æ•ˆæœ**ï¼š
- KOL 202ï¼ˆå·å·å“¥ï¼‰â†’ æ–‡ç« æ¨™é¡Œï¼šã€Œä»Šæ—¥æ¼²åœä¸‰é›„ï¼šå°ç©é›»ã€è¯ç™¼ç§‘ã€é´»æµ·ã€
- **ç¸½å…±**ï¼š3æª”è‚¡ç¥¨ = 1ç¯‡æ–‡ç« 

---

#### 4. å¯©æ ¸æ©Ÿåˆ¶ (review_required)
- **true**ï¼šç”Ÿæˆå¾Œéœ€äººå·¥å¯©æ ¸æ‰èƒ½ç™¼å¸ƒ
  - è³‡æ–™åº« `status: 'draft'` â†’ å¯©æ ¸é€šé â†’ `status: 'approved'`
- **false**ï¼šç”Ÿæˆå¾Œè‡ªå‹•æ¨™è¨˜ç‚ºå·²å¯©æ ¸
  - è³‡æ–™åº« `status: 'approved'`ï¼ˆä½†ä»éœ€æ‰‹å‹•é»æ“Šç™¼å¸ƒï¼‰

```typescript
batchMode: {
  review_required: true
}
```

---

#### 5. è‡ªå‹•é€šéé–€æª» (auto_approve_threshold)
- **åŠŸèƒ½**ï¼šå“è³ªåˆ†æ•¸é”æ¨™è‡ªå‹•é€šéå¯©æ ¸
- **ç¯„åœ**ï¼š0.0 - 1.0
- **å»ºè­°å€¼**ï¼š
  - åš´æ ¼ï¼š0.9
  - ä¸€èˆ¬ï¼š0.8
  - å¯¬é¬†ï¼š0.7

```typescript
batchMode: {
  auto_approve_threshold: 0.8
}
```

**å¾Œç«¯é‚è¼¯**ï¼š
```python
# è¨ˆç®—å…§å®¹å“è³ªåˆ†æ•¸
quality_score = calculate_quality_score(content)

# è‡ªå‹•å¯©æ ¸åˆ¤æ–·
if quality_score >= auto_approve_threshold:
    status = 'approved'
else:
    status = 'draft'  # éœ€äººå·¥å¯©æ ¸
```

---

#### 6. ç™¼å¸ƒå»¶é² (publish_delay_minutes)
- **åŠŸèƒ½**ï¼šæ¯ç¯‡è²¼æ–‡ä¹‹é–“çš„ç™¼å¸ƒé–“éš”
- **ç›®çš„**ï¼šé¿å…è¢«å¹³å°åˆ¤å®šç‚ºæ´—ç‰ˆ
- **å»ºè­°å€¼**ï¼š
  - æ¸¬è©¦ç’°å¢ƒï¼š0-1 åˆ†é˜
  - æ­£å¼ç’°å¢ƒï¼š5-10 åˆ†é˜

```typescript
batchMode: {
  publish_delay_minutes: 5
}
```

---

#### 7. å“è³ªæª¢æŸ¥ (quality_check_enabled)
- **åŠŸèƒ½**ï¼šå•Ÿç”¨å…§å®¹å“è³ªè‡ªå‹•æª¢æŸ¥
- **æª¢æŸ¥é …ç›®**ï¼š
  - å…§å®¹é•·åº¦æ˜¯å¦ç¬¦åˆè¦æ±‚
  - æ˜¯å¦åŒ…å«ç¦ç”¨è©å½™
  - é‚è¼¯æ˜¯å¦é€£è²«
  - æ•¸æ“šå¼•ç”¨æ˜¯å¦æ­£ç¢º

```typescript
batchMode: {
  quality_check_enabled: true
}
```

**å¾Œç«¯æª¢æŸ¥é‚è¼¯**ï¼š
```python
# ContentQualityChecker.py (å½ä»£ç¢¼)
def check_quality(content, settings):
    score = 1.0
    issues = []

    # 1. é•·åº¦æª¢æŸ¥
    word_count = len(content)
    if word_count < settings.min_words:
        score -= 0.2
        issues.append(f"å…§å®¹éçŸ­ï¼š{word_count} å­— (æœ€å°‘ {settings.min_words} å­—)")

    # 2. ç¦ç”¨è©æª¢æŸ¥
    banned_words = ['ä¿è­‰ç²åˆ©', 'ç©©è³ºä¸è³ ', 'å…§ç·šæ¶ˆæ¯']
    for word in banned_words:
        if word in content:
            score -= 0.3
            issues.append(f"åŒ…å«ç¦ç”¨è©ï¼š{word}")

    # 3. é‚è¼¯é€£è²«æ€§æª¢æŸ¥
    coherence_score = check_coherence(content)
    score *= coherence_score

    # 4. æ•¸æ“šå¼•ç”¨æª¢æŸ¥
    if not has_data_citation(content):
        score -= 0.1
        issues.append("ç¼ºå°‘æ•¸æ“šå¼•ç”¨")

    return {
        'quality_score': score,
        'issues': issues,
        'pass': score >= 0.7
    }
```

---

#### 8. AI æª¢æ¸¬ (ai_detection_enabled)
- **åŠŸèƒ½**ï¼šæª¢æ¸¬å…§å®¹æ˜¯å¦éæ–¼ã€ŒAI å‘³ã€
- **æª¢æ¸¬æŒ‡æ¨™**ï¼š
  - ç”¨è©é‡è¤‡ç‡
  - å¥å¼å–®èª¿æ€§
  - ç¼ºä¹å€‹æ€§åŒ–å…ƒç´ 

```typescript
batchMode: {
  ai_detection_enabled: true
}
```

**å¾Œç«¯æª¢æ¸¬**ï¼š
```python
def detect_ai_generated(content):
    """æª¢æ¸¬ AI ç”Ÿæˆç—•è·¡"""

    ai_score = 0.0

    # 1. æª¢æŸ¥å¸¸è¦‹ AI ç”¨èª
    ai_phrases = [
        'ç¶œåˆä¾†çœ‹', 'ç¸½çš„ä¾†èªª', 'å¾æ•¸æ“šä¾†çœ‹',
        'å€¼å¾—æ³¨æ„çš„æ˜¯', 'éœ€è¦æŒ‡å‡ºçš„æ˜¯'
    ]
    ai_phrase_count = sum(1 for phrase in ai_phrases if phrase in content)
    ai_score += ai_phrase_count * 0.1

    # 2. æª¢æŸ¥å¥å¼é‡è¤‡
    sentences = split_sentences(content)
    similarity_matrix = calculate_sentence_similarity(sentences)
    avg_similarity = similarity_matrix.mean()
    if avg_similarity > 0.7:
        ai_score += 0.3

    # 3. æª¢æŸ¥å€‹æ€§åŒ–å…ƒç´ ï¼ˆçœç•¥è™Ÿã€é©šå˜†è™Ÿã€å£èªç­‰ï¼‰
    personality_markers = count_personality_markers(content)
    if personality_markers < 3:
        ai_score += 0.2

    return min(ai_score, 1.0)
```

---

#### 9. ç”Ÿæˆæ¨¡å¼ (generation_mode)
- **high_quality**ï¼šé«˜å“è³ªæ¨¡å¼
  - æº«åº¦ï¼š0.3-0.5ï¼ˆè¼ƒä½ï¼Œæ›´ç©©å®šï¼‰
  - é‡è©¦æ¬¡æ•¸ï¼š3æ¬¡
  - å“è³ªé–€æª»ï¼š0.8
- **balanced**ï¼šå¹³è¡¡æ¨¡å¼
  - æº«åº¦ï¼š0.5-0.7
  - é‡è©¦æ¬¡æ•¸ï¼š2æ¬¡
  - å“è³ªé–€æª»ï¼š0.7
- **fast**ï¼šå¿«é€Ÿæ¨¡å¼
  - æº«åº¦ï¼š0.7-0.9ï¼ˆè¼ƒé«˜ï¼Œæ›´å¤šè®Šï¼‰
  - é‡è©¦æ¬¡æ•¸ï¼š1æ¬¡
  - å“è³ªé–€æª»ï¼š0.6

```typescript
batchMode: {
  generation_mode: 'high_quality'
}
```

---

### æ‰¹é‡ç”Ÿæˆå®Œæ•´æµç¨‹

```python
# unified-api/main.py (å½ä»£ç¢¼)
async def batch_generate_posts(config):
    """æ‰¹é‡ç”Ÿæˆè²¼æ–‡"""

    session_id = generate_session_id()
    posts = []

    # 1. æ ¹æ“šè§¸ç™¼å™¨å–å¾—è‚¡ç¥¨æ¸…å–®
    stock_list = execute_trigger(config.triggers)

    # 2. é™åˆ¶æ‰¹æ¬¡æ•¸é‡
    stock_list = stock_list[:config.batchMode.max_posts_per_batch]

    # 3. æ ¹æ“šç”Ÿæˆç­–ç•¥æ±ºå®š KOL åˆ†é…
    if config.batchMode.generation_strategy == 'one_kol_one_stock':
        for stock in stock_list:
            kol = allocate_kol(stock, config.kol)
            post = await generate_single_post(stock, kol, config)

            # 4. å“è³ªæª¢æŸ¥
            if config.batchMode.quality_check_enabled:
                quality_result = check_quality(post.content, config)
                post.quality_score = quality_result['quality_score']

            # 5. AI æª¢æ¸¬
            if config.batchMode.ai_detection_enabled:
                post.ai_detection_score = detect_ai_generated(post.content)

            # 6. è‡ªå‹•å¯©æ ¸
            if post.quality_score >= config.batchMode.auto_approve_threshold:
                post.status = 'approved'
            else:
                post.status = 'draft'

            # 7. å„²å­˜åˆ°è³‡æ–™åº«
            save_post_to_db(post, session_id)
            posts.append(post)

            # 8. ç™¼å¸ƒå»¶é²
            await asyncio.sleep(config.batchMode.publish_delay_minutes * 60)

    return {
        'success': True,
        'session_id': session_id,
        'posts': posts,
        'count': len(posts)
    }
```

---

### æ‰¹é‡æ¨¡å¼æœ€ä½³å¯¦è¸

#### æƒ…å¢ƒä¸€ï¼šç›¤å¾Œå¿«é€Ÿç™¼å¸ƒï¼ˆ10æª”æ¼²åœè‚¡ï¼‰
```typescript
batchMode: {
  batch_type: 'production',
  max_posts_per_batch: 10,
  generation_strategy: 'one_kol_one_stock',
  review_required: false,              // ä¸éœ€å¯©æ ¸
  auto_approve_threshold: 0.7,         // è¼ƒä½é–€æª»
  publish_delay_minutes: 3,            // çŸ­å»¶é²
  quality_check_enabled: true,
  ai_detection_enabled: false,         // é—œé–‰ï¼ˆçœæ™‚é–“ï¼‰
  generation_mode: 'fast'
}
```
**ç‰¹è‰²**ï¼šå¿«é€Ÿã€è‡ªå‹•ã€å¤§é‡

---

#### æƒ…å¢ƒäºŒï¼šé«˜å“è³ªæ·±åº¦åˆ†æï¼ˆ3æª”ç²¾é¸è‚¡ï¼‰
```typescript
batchMode: {
  batch_type: 'production',
  max_posts_per_batch: 3,
  generation_strategy: 'multi_kol_one_stock',  // å¤šè§’åº¦åˆ†æ
  kols_per_stock: 3,
  review_required: true,               // éœ€äººå·¥å¯©æ ¸
  auto_approve_threshold: 0.9,         // é«˜é–€æª»
  publish_delay_minutes: 10,           // é•·å»¶é²
  quality_check_enabled: true,
  ai_detection_enabled: true,
  generation_mode: 'high_quality'
}
```
**ç‰¹è‰²**ï¼šç²¾å“ã€å¤šè§’åº¦ã€åš´æ ¼å“æ§

---

#### æƒ…å¢ƒä¸‰ï¼šæ¸¬è©¦æ–° KOL é¢¨æ ¼
```typescript
batchMode: {
  batch_type: 'test_mode',             // æ¸¬è©¦æ¨¡å¼
  max_posts_per_batch: 5,
  generation_strategy: 'one_kol_one_stock',
  review_required: true,
  quality_check_enabled: true,
  ai_detection_enabled: true,
  generation_mode: 'balanced'
}
```
**ç‰¹è‰²**ï¼šå®‰å…¨ã€å¯é©—è­‰ã€ä¸å½±éŸ¿æ­£å¼ç’°å¢ƒ

---

## å¾Œç«¯è™•ç†æµç¨‹

### å®Œæ•´ç”Ÿæˆæµç¨‹åœ–

```
[å‰ç«¯æäº¤è«‹æ±‚]
    â†“
[å¾Œç«¯æ¥æ”¶è«‹æ±‚] POST /api/manual-posting
    â†“
[æ­¥é©Ÿ1] è§£æè«‹æ±‚åƒæ•¸
    â”œâ”€ stock_code, stock_name
    â”œâ”€ kol_serial, kol_persona
    â”œâ”€ trigger_type
    â””â”€ posting_type, max_words
    â†“
[æ­¥é©Ÿ2] åŸ·è¡Œè§¸ç™¼å™¨é‚è¼¯
    â”œâ”€ æ ¹æ“š trigger_type å–å¾—è‚¡ç¥¨æ¸…å–®
    â”œâ”€ ç¯©é¸æ¢ä»¶ï¼ˆé‡èƒ½ã€æ¼²å¹…ç­‰ï¼‰
    â””â”€ å›å‚³ stock_codes[]
    â†“
[æ­¥é©Ÿ3] æ•¸æ“šæ”¶é›†ï¼ˆä¸¦è¡Œï¼‰
    â”œâ”€ OHLC API â†’ è‚¡åƒ¹æŠ€è¡“æ•¸æ“š
    â”œâ”€ Summary API â†’ æ•¸æ“šæ‘˜è¦
    â”œâ”€ Serper API â†’ æ–°èæœå°‹
    â”œâ”€ Revenue API â†’ ç‡Ÿæ”¶æ•¸æ“š
    â””â”€ Financial API â†’ è²¡å‹™æ•¸æ“š
    â†“
[æ­¥é©Ÿ4] è¼‰å…¥ KOL è¨­å®šæª”
    â”œâ”€ å¾ PostgreSQL è¼‰å…¥ kol_profile
    â”œâ”€ åŒ…å«ï¼špersona, tone_style, prompt_persona...
    â””â”€ åˆä½µ prompt_overridesï¼ˆå¦‚æœ‰å¾®èª¿ï¼‰
    â†“
[æ­¥é©Ÿ5] å»ºç«‹å‹•æ…‹ Prompt
    â”œâ”€ ç³»çµ± Prompt (è§’è‰²å®šä½)
    â”‚   â””â”€ "ä½ æ˜¯ {kol_nickname}ï¼Œ{persona} é¢¨æ ¼çš„åˆ†æå¸«..."
    â”œâ”€ æ•¸æ“š Prompt (è‚¡ç¥¨æ•¸æ“š)
    â”‚   â””â”€ "è‚¡ç¥¨ä»£è™Ÿ: {stock_code}, æ”¶ç›¤åƒ¹: {close_price}..."
    â”œâ”€ é¢¨æ ¼ Prompt (å¯«ä½œé¢¨æ ¼)
    â”‚   â””â”€ "èªæ°£ï¼š{tone_style}, æ‰“å­—ç¿’æ…£ï¼š{typing_habit}..."
    â””â”€ è¨­å®š Prompt (ç”Ÿæˆè¨­å®š)
        â””â”€ "å…§å®¹é•·åº¦ï¼š{max_words} å­—ï¼Œé¢¨æ ¼ï¼š{content_style}..."
    â†“
[æ­¥é©Ÿ6] å‘¼å« OpenAI API
    â”œâ”€ Model: gpt-4o-mini
    â”œâ”€ Temperature: {kol_profile.model_temp}
    â”œâ”€ Max Tokens: {kol_profile.max_tokens}
    â””â”€ Messages: [system_prompt, user_prompt]
    â†“
[æ­¥é©Ÿ7] å¾Œè™•ç†ç”Ÿæˆå…§å®¹
    â”œâ”€ æå–æ¨™é¡Œèˆ‡å…§å®¹
    â”œâ”€ ç§»é™¤å¤šé¤˜ Hashtagï¼ˆå¾ŒçºŒç”±æ¨™ç±¤è¨­å®šè™•ç†ï¼‰
    â”œâ”€ é•·åº¦é©—è­‰èˆ‡èª¿æ•´
    â””â”€ å“è³ªæª¢æŸ¥
    â†“
[æ­¥é©Ÿ8] å€‹äººåŒ–è™•ç†ï¼ˆå¯é¸ï¼‰
    â”œâ”€ å¦‚æœ posting_type == 'personalized'
    â”œâ”€ å‘¼å« PersonalizationModule
    â”œâ”€ ç”Ÿæˆ 3-5 å€‹æ›¿ä»£ç‰ˆæœ¬
    â””â”€ å„²å­˜åˆ° alternative_versions
    â†“
[æ­¥é©Ÿ9] å„²å­˜åˆ°è³‡æ–™åº«
    â”œâ”€ ç”Ÿæˆ post_id (UUID)
    â”œâ”€ ç”Ÿæˆ commodity_tags
    â”œâ”€ å„²å­˜ generation_params
    â””â”€ INSERT INTO post_records
        â”œâ”€ status: 'draft'
        â”œâ”€ session_id: {session_id}
        â””â”€ trigger_type: {trigger_type}
    â†“
[æ­¥é©Ÿ10] å›å‚³å‰ç«¯
    â””â”€ { success: true, post_id, content: {...} }
```

---

### é—œéµç¨‹å¼ç¢¼ä½ç½®

| åŠŸèƒ½ | æª”æ¡ˆè·¯å¾‘ | è¡Œæ•¸ç¯„åœ |
|------|---------|---------|
| æ‰‹å‹•ç™¼æ–‡ API | `/apps/unified-api/main.py` | 1827-2058 |
| GPT å…§å®¹ç”Ÿæˆ | `/apps/posting-service/gpt_content_generator.py` | - |
| å€‹äººåŒ–è™•ç† | `/apps/posting-service/personalization_module.py` | - |
| KOL è³‡æ–™ç®¡ç† | `/apps/posting-service/kol_database_service.py` | - |
| è³‡æ–™åº«è¡¨çµæ§‹ | `/apps/unified-api/main.py` | 96-176 |

---

## ç™¼å¸ƒèˆ‡å¯©æ ¸æµç¨‹

### å¯©æ ¸é é¢ (PostReviewPage)

**åŠŸèƒ½**ï¼š
1. æŸ¥çœ‹ç”Ÿæˆçš„è²¼æ–‡
2. åˆ‡æ›æ›¿ä»£ç‰ˆæœ¬
3. æ‰‹å‹•ç·¨è¼¯å…§å®¹
4. å¯©æ ¸é€šé / æ‹’çµ•
5. ç™¼å¸ƒåˆ°è«–å£‡

**API æŸ¥è©¢**ï¼š
```typescript
// æŸ¥è©¢æŒ‡å®š session çš„æ‰€æœ‰è²¼æ–‡
GET /posts/session/{session_id}

// å›æ‡‰ç¯„ä¾‹
{
  "posts": [
    {
      "post_id": "uuid-1234",
      "stock_code": "2330",
      "stock_name": "å°ç©é›»",
      "title": "å°ç©é›»çˆ†é‡çªç ´.....é€™æ ¹è¦å™´äº†å•¦.....",
      "content": "...",
      "status": "draft",
      "quality_score": 0.85,
      "alternative_versions": [...]
    }
  ]
}
```

---

### å¯©æ ¸é€šé

```typescript
// å¯©æ ¸é€šé API
POST /posts/{post_id}/approve

// Request Body
{
  "approved_by": "reviewer_123",
  "reviewer_notes": "å…§å®¹å“è³ªè‰¯å¥½ï¼Œå¯ç™¼å¸ƒ"
}

// å¾Œç«¯æ›´æ–°
UPDATE post_records
SET status = 'approved',
    approved_by = 'reviewer_123',
    approved_at = NOW(),
    reviewer_notes = '...'
WHERE post_id = 'uuid-1234';
```

---

### ç™¼å¸ƒåˆ°è«–å£‡

**ç™¼å¸ƒæµç¨‹**ï¼š
```
[1] ä½¿ç”¨è€…é»æ“Šã€Œç™¼å¸ƒã€
    â†“
[2] å‰ç«¯å‘¼å« POST /posts/{post_id}/publish
    â†“
[3] å¾Œç«¯è¼‰å…¥ KOL å¸³è™Ÿè³‡è¨Š
    â”œâ”€ email, password
    â””â”€ å¾ kol_profiles è¡¨
    â†“
[4] ç™»å…¥ CMoney å¹³å°
    â”œâ”€ CMoneyClient.login(email, password)
    â””â”€ å–å¾— auth_token
    â†“
[5] ç™¼å¸ƒè²¼æ–‡
    â”œâ”€ CMoneyClient.create_post({
    â”‚     title,
    â”‚     content,
    â”‚     commodity_tags
    â”‚   })
    â””â”€ å›å‚³ cmoney_post_id, cmoney_post_url
    â†“
[6] æ›´æ–°è³‡æ–™åº«
    â””â”€ UPDATE post_records SET
        status = 'published',
        published_at = NOW(),
        cmoney_post_id = '...',
        cmoney_post_url = '...'
    â†“
[7] åŒæ­¥åˆ° Google Sheetsï¼ˆå¯é¸ï¼‰
    â””â”€ SheetsClient.update_post_record(post)
    â†“
[8] å›å‚³å‰ç«¯æˆåŠŸè¨Šæ¯
```

---

### ç™¼å¸ƒå¤±æ•—è™•ç†

```python
try:
    # å˜—è©¦ç™¼å¸ƒ
    result = cmoney_client.create_post(post_data)
except Exception as e:
    # è¨˜éŒ„éŒ¯èª¤
    UPDATE post_records
    SET status = 'publish_failed',
        publish_error = str(e)
    WHERE post_id = post_id

    # å›å‚³éŒ¯èª¤è¨Šæ¯çµ¦å‰ç«¯
    return {
        'success': False,
        'error': str(e),
        'message': 'ç™¼å¸ƒå¤±æ•—ï¼Œè«‹æª¢æŸ¥ KOL å¸³è™Ÿç‹€æ…‹'
    }
```

---

## ç¸½çµèˆ‡æœ€ä½³å¯¦è¸

### å®Œæ•´æ“ä½œæµç¨‹å›é¡§

1. **æ­¥é©Ÿä¸€**ï¼šé¸æ“‡è§¸ç™¼å™¨ â†’ æ±ºå®šè¦åˆ†æå“ªäº›è‚¡ç¥¨
2. **æ­¥é©ŸäºŒ**ï¼šé…ç½®æ•¸æ“šæº â†’ æ±ºå®šä½¿ç”¨å“ªäº›æ•¸æ“š API
3. **æ­¥é©Ÿä¸‰**ï¼šè¨­å®šè§£é‡‹å±¤ â†’ æ±ºå®šå¦‚ä½•è§£è®€æ•¸æ“š
4. **æ­¥é©Ÿå››**ï¼šé…ç½®æ–°èæœå°‹ â†’ æ±ºå®šæ–°èä¾†æºèˆ‡ç¯„åœ
5. **æ­¥é©Ÿäº”**ï¼šé¸æ“‡ KOL â†’ æ±ºå®šç”±èª°ç™¼æ–‡
6. **æ­¥é©Ÿå…­**ï¼šå¾®èª¿ Prompt â†’ é‡å°æ­¤æ¬¡ä»»å‹™èª¿æ•´é¢¨æ ¼
7. **æ­¥é©Ÿä¸ƒ**ï¼šç”Ÿæˆè¨­å®š â†’ æ±ºå®šå…§å®¹é•·åº¦ã€é¢¨æ ¼ã€æ·±åº¦
8. **æ­¥é©Ÿå…«**ï¼šæ¨™ç±¤è¨­å®š â†’ æ±ºå®šæ–‡ç« æ¨™ç±¤
9. **æ­¥é©Ÿä¹**ï¼šæ‰¹é‡æ¨¡å¼ â†’ æ±ºå®šæ‰¹é‡ç­–ç•¥èˆ‡å“è³ªæ§åˆ¶
10. **ç”Ÿæˆå…§å®¹** â†’ å¾Œç«¯è™•ç†ä¸¦å„²å­˜
11. **å¯©æ ¸** â†’ äººå·¥æª¢æŸ¥èˆ‡ä¿®æ”¹
12. **ç™¼å¸ƒ** â†’ ç™¼å¸ƒåˆ°è«–å£‡

---

### å¸¸è¦‹ä½¿ç”¨æƒ…å¢ƒç¯„æœ¬

#### ã€æƒ…å¢ƒä¸€ã€‘ç›¤å¾Œå¿«é€Ÿç™¼å¸ƒæ¼²åœè‚¡ï¼ˆè¿½æ±‚é€Ÿåº¦ï¼‰

```typescript
{
  triggers: { trigger_type: 'limit_up_after_hours_high_volume' },
  dataSources: { ohlc_api: true, serper_api: true },
  news: { time_range: 'd1', max_links: 3 },
  kol: { assignment_mode: 'random' },
  settings: {
    content_length: 'short',
    max_words: 200,
    posting_type: 'analysis'
  },
  batchMode: {
    batch_type: 'production',
    max_posts_per_batch: 10,
    generation_strategy: 'one_kol_one_stock',
    review_required: false,
    generation_mode: 'fast'
  }
}
```

---

#### ã€æƒ…å¢ƒäºŒã€‘æ·±åº¦è²¡å ±åˆ†æï¼ˆè¿½æ±‚å“è³ªï¼‰

```typescript
{
  triggers: { trigger_type: 'earnings_report' },
  dataSources: {
    financial_api: true,
    revenue_api: true,
    fundamental_api: true
  },
  kol: {
    assignment_mode: 'manual',
    selected_kols: [203]  // åƒ¹å€¼æŠ•è³‡ç‹
  },
  settings: {
    content_length: 'long',
    max_words: 800,
    content_style: 'professional',
    include_analysis_depth: 'detailed',
    posting_type: 'analysis'
  },
  batchMode: {
    batch_type: 'production',
    max_posts_per_batch: 3,
    review_required: true,
    generation_mode: 'high_quality'
  }
}
```

---

#### ã€æƒ…å¢ƒä¸‰ã€‘ç†±é–€è©±é¡Œè¹­æµé‡ï¼ˆè¿½æ±‚äº’å‹•ï¼‰

```typescript
{
  triggers: {
    trigger_type: 'trending_topics',
    selectedTopics: [...]
  },
  dataSources: { serper_api: true, trending_api: true },
  news: { time_range: 'd1', max_links: 5 },
  kol: { assignment_mode: 'dynamic', style_preference: 'aggressive' },
  settings: {
    content_length: 'medium',
    content_style: 'casual',
    posting_type: 'opinion',
    include_questions: true,
    include_emoji: true
  },
  tags: {
    topic_tags: { auto_generate: true }
  },
  batchMode: {
    batch_type: 'production',
    generation_strategy: 'one_kol_one_stock'
  }
}
```

---

### ç³»çµ±å„ªå‹¢ç¸½çµ

1. **é«˜åº¦æ¨¡çµ„åŒ–**ï¼šä¹æ­¥é©Ÿå„å¸å…¶è·ï¼Œæ¸…æ™°æ˜ç¢º
2. **æ·±åº¦å€‹æ€§åŒ–**ï¼šæ¯å€‹ KOL éƒ½æœ‰ç¨ç‰¹é¢¨æ ¼
3. **æ™ºèƒ½æ•¸æ“šæ•´åˆ**ï¼šå¤šæºæ•¸æ“šè‡ªå‹•çµ„åˆ
4. **éˆæ´»å“è³ªæ§åˆ¶**ï¼šå¤šå±¤å“è³ªæª¢æŸ¥æ©Ÿåˆ¶
5. **å®Œæ•´å¯©æ ¸æµç¨‹**ï¼šè‰ç¨¿ â†’ å¯©æ ¸ â†’ ç™¼å¸ƒ
6. **æ‰¹é‡é«˜æ•ˆè™•ç†**ï¼šæ”¯æ´å¤§æ‰¹é‡è‡ªå‹•åŒ–ç”Ÿæˆ

---

### æ³¨æ„äº‹é …

1. **API Key ç®¡ç†**ï¼šç¢ºä¿æ‰€æœ‰ API Key æ­£ç¢ºé…ç½®åœ¨ç’°å¢ƒè®Šæ•¸ä¸­
2. **KOL å¸³è™Ÿå®‰å…¨**ï¼šå®šæœŸæ›´æ–°å¯†ç¢¼ï¼Œé¿å…å¸³è™Ÿè¢«å°
3. **ç™¼å¸ƒé »ç‡æ§åˆ¶**ï¼šé¿å…çŸ­æ™‚é–“å…§å¤§é‡ç™¼æ–‡è¢«åˆ¤å®šç‚ºæ´—ç‰ˆ
4. **å…§å®¹åˆè¦æ€§**ï¼šé¿å…ä½¿ç”¨ã€Œä¿è­‰ç²åˆ©ã€ç­‰é•è¦è©å½™
5. **æ•¸æ“šå¼•ç”¨æ­£ç¢ºæ€§**ï¼šç¢ºä¿å¼•ç”¨çš„æ•¸æ“šçœŸå¯¦æœ‰æ•ˆ
6. **é¢¨éšªè­¦èª**ï¼šæ‰€æœ‰æŠ•è³‡å»ºè­°éƒ½æ‡‰åŒ…å«é¢¨éšªæé†’

---

### ç³»çµ±é™åˆ¶èˆ‡å·²çŸ¥å•é¡Œ

1. **GPT API é™æµ**ï¼šå–®ä½æ™‚é–“å…§è«‹æ±‚æ¬¡æ•¸æœ‰é™åˆ¶
2. **CMoney å¹³å°é™åˆ¶**ï¼šéƒ¨åˆ†å¸³è™Ÿæœ‰ç™¼æ–‡é »ç‡é™åˆ¶
3. **æ–°èæœå°‹æ™‚æ•ˆæ€§**ï¼šSerper API å¯èƒ½æœ‰å»¶é²
4. **KOL é¢¨æ ¼ä¸€è‡´æ€§**ï¼šéœ€å®šæœŸèª¿æ•´ Prompt ç¶­æŒé¢¨æ ¼

---

### æœªä¾†æ”¹é€²æ–¹å‘

1. **èªéŸ³å…§å®¹ç”Ÿæˆ**ï¼šæ”¯æ´èªéŸ³ç‰ˆæœ¬çš„è‚¡ç¥¨åˆ†æ
2. **åœ–è¡¨è‡ªå‹•ç”Ÿæˆ**ï¼šè‡ªå‹•ç”ŸæˆæŠ€è¡“ç·šåœ–ä¸¦åµŒå…¥æ–‡ç« 
3. **äº’å‹•æ•¸æ“šè¿½è¹¤**ï¼šè¿½è¹¤æ¯ç¯‡æ–‡ç« çš„é»é–±ã€ç•™è¨€ã€æŒ‰è®šæ•¸
4. **A/B æ¸¬è©¦**ï¼šåŒä¸€è‚¡ç¥¨ç”Ÿæˆå¤šç¨®é¢¨æ ¼ï¼Œæ¯”è¼ƒæˆæ•ˆ
5. **æ™ºèƒ½æ’ç¨‹**ï¼šæ ¹æ“šæµé‡é«˜å³°è‡ªå‹•å®‰æ’ç™¼å¸ƒæ™‚é–“

---

## é™„éŒ„

### A. API ç«¯é»é€ŸæŸ¥è¡¨

| ç«¯é» | æ–¹æ³• | åŠŸèƒ½ | åƒæ•¸ |
|------|------|------|------|
| `/api/manual-posting` | POST | æ‰‹å‹•ç™¼æ–‡ | stock_code, kol_serial, ... |
| `/api/simple-mode/generate-batch` | POST | æ‰¹é‡ç”Ÿæˆ | triggers, dataSources, ... |
| `/posts/session/{session_id}` | GET | æŸ¥è©¢ session è²¼æ–‡ | session_id |
| `/posts/{post_id}/approve` | POST | å¯©æ ¸é€šé | approved_by, notes |
| `/posts/{post_id}/publish` | POST | ç™¼å¸ƒåˆ°è«–å£‡ | post_id |
| `/api/database/test` | GET | æ¸¬è©¦è³‡æ–™åº«é€£æ¥ | - |

---

### B. è³‡æ–™åº«çµæ§‹

**post_records è¡¨çµæ§‹**ï¼š
```sql
CREATE TABLE post_records (
    post_id VARCHAR PRIMARY KEY,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    session_id BIGINT,
    kol_serial INTEGER NOT NULL,
    kol_nickname VARCHAR NOT NULL,
    kol_persona VARCHAR,
    stock_code VARCHAR NOT NULL,
    stock_name VARCHAR NOT NULL,
    title VARCHAR NOT NULL,
    content TEXT NOT NULL,
    content_md TEXT,
    status VARCHAR DEFAULT 'draft',  -- draft, approved, published, publish_failed
    reviewer_notes TEXT,
    approved_by VARCHAR,
    approved_at TIMESTAMP,
    scheduled_at TIMESTAMP,
    published_at TIMESTAMP,
    cmoney_post_id VARCHAR,
    cmoney_post_url VARCHAR,
    publish_error TEXT,
    views BIGINT DEFAULT 0,
    likes BIGINT DEFAULT 0,
    comments BIGINT DEFAULT 0,
    shares BIGINT DEFAULT 0,
    topic_id VARCHAR,
    topic_title VARCHAR,
    technical_analysis TEXT,
    serper_data TEXT,
    quality_score FLOAT,
    ai_detection_score FLOAT,
    risk_level VARCHAR,
    generation_params TEXT,
    commodity_tags TEXT,
    alternative_versions TEXT,
    trigger_type VARCHAR
);
```

---

### C. ç’°å¢ƒè®Šæ•¸æ¸…å–®

```bash
# FinLab API
FINLAB_API_KEY=your_finlab_api_key

# OpenAI
OPENAI_API_KEY=your_openai_api_key

# PostgreSQL
DATABASE_URL=postgresql://user:password@host:5432/dbname

# CMoney KOL å¸³è™Ÿ (ç¯„ä¾‹)
FORUM_200_EMAIL=kol200@example.com
FORUM_200_PASSWORD=password200

# Serper API (æ–°èæœå°‹)
SERPER_API_KEY=your_serper_api_key

# Railway éƒ¨ç½²
PORT=8000
```

---

**æ–‡ä»¶ç‰ˆæœ¬**ï¼šv1.0
**æœ€å¾Œæ›´æ–°**ï¼š2025-10-20
**ä½œè€…**ï¼šClaude Code
**è¯çµ¡æ–¹å¼**ï¼šè«‹é€é GitHub Issues å›å ±å•é¡Œ
