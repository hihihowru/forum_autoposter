# å¾Œç«¯æ¶æ§‹

## ğŸ¯ å¾Œç«¯æŠ€è¡“æ£§

### æ ¸å¿ƒæŠ€è¡“
- **FastAPI** - ç¾ä»£ Python Web æ¡†æ¶
- **Python 3.11+** - ç·¨ç¨‹èªè¨€
- **PostgreSQL** - é—œä¿‚å‹æ•¸æ“šåº«
- **SQLAlchemy** - ORM æ¡†æ¶
- **Pydantic** - æ•¸æ“šé©—è­‰
- **Docker** - å®¹å™¨åŒ–éƒ¨ç½²

### å¤–éƒ¨ä¾è³´
- **OpenAI GPT API** - AI å…§å®¹ç”Ÿæˆ
- **CMoney API** - å…§å®¹ç™¼å¸ƒå¹³å°
- **Serper API** - æ–°èæœå°‹
- **FinLab API** - é‡‘èæ•¸æ“š
- **HTTPX** - ç•°æ­¥ HTTP å®¢æˆ¶ç«¯

## ğŸ—ï¸ æœå‹™æ¶æ§‹

### å¾®æœå‹™æ¶æ§‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    posting-service (8001)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - è²¼æ–‡ç®¡ç† API        - KOL ç®¡ç† API        - äº’å‹•åˆ†æ API     â”‚
â”‚  - æ‰¹æ¬¡è™•ç† API        - æ’ç¨‹ç®¡ç† API        - è§¸ç™¼å™¨ API       â”‚
â”‚  - ç™¼å¸ƒç®¡ç† API        - è‡ªæˆ‘å­¸ç¿’ API        - ä¸¦è¡Œè™•ç† API     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  dashboard-backend (8012)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - å„€è¡¨æ¿ API          - ç³»çµ±ç›£æ§ API        - ç”¨æˆ¶ç®¡ç† API     â”‚
â”‚  - çµ±è¨ˆåˆ†æ API        - é…ç½®ç®¡ç† API        - æ¬Šé™æ§åˆ¶ API     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PostgreSQL (5432)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - post_records        - kol_profiles        - schedules        â”‚
â”‚  - interaction_data    - user_management     - system_logs      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ é …ç›®çµæ§‹

```
posting-service/
â”œâ”€â”€ main.py                    # FastAPI æ‡‰ç”¨å…¥å£
â”œâ”€â”€ requirements.txt           # Python ä¾è³´
â”œâ”€â”€ Dockerfile                # Docker é…ç½®
â”œâ”€â”€ routes/                   # API è·¯ç”±æ¨¡çµ„
â”‚   â”œâ”€â”€ __init__.py          # è·¯ç”±åˆå§‹åŒ–
â”‚   â”œâ”€â”€ post_routes.py       # è²¼æ–‡ç®¡ç†è·¯ç”±
â”‚   â”œâ”€â”€ kol_routes.py        # KOL ç®¡ç†è·¯ç”±
â”‚   â”œâ”€â”€ kol_api_routes.py    # KOL API è·¯ç”±
â”‚   â”œâ”€â”€ publish_route.py     # ç™¼å¸ƒç®¡ç†è·¯ç”±
â”‚   â”œâ”€â”€ interaction_routes.py # äº’å‹•åˆ†æè·¯ç”±
â”‚   â”œâ”€â”€ interaction_batch_routes.py # æ‰¹æ¬¡äº’å‹•è·¯ç”±
â”‚   â”œâ”€â”€ schedule_routes_simple.py # æ’ç¨‹ç®¡ç†è·¯ç”±
â”‚   â”œâ”€â”€ intraday_trigger_route.py # ç›¤ä¸­è§¸ç™¼å™¨è·¯ç”±
â”‚   â””â”€â”€ parallel_intraday_route.py # ä¸¦è¡Œè§¸ç™¼å™¨è·¯ç”±
â”œâ”€â”€ services/                 # æ¥­å‹™é‚è¼¯æœå‹™
â”‚   â”œâ”€â”€ post_record_service.py # è²¼æ–‡è¨˜éŒ„æœå‹™
â”‚   â”œâ”€â”€ postgresql_service.py # PostgreSQL æœå‹™
â”‚   â”œâ”€â”€ parallel_processor.py # ä¸¦è¡Œè™•ç†æœå‹™
â”‚   â””â”€â”€ parallel_batch_generator.py # æ‰¹æ¬¡ç”Ÿæˆæœå‹™
â”œâ”€â”€ models/                   # æ•¸æ“šæ¨¡å‹
â”‚   â”œâ”€â”€ post_record.py       # è²¼æ–‡è¨˜éŒ„æ¨¡å‹
â”‚   â”œâ”€â”€ kol_profile.py       # KOL é…ç½®æ¨¡å‹
â”‚   â””â”€â”€ schedule.py          # æ’ç¨‹æ¨¡å‹
â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•¸
â”‚   â”œâ”€â”€ date_utils.py        # æ—¥æœŸå·¥å…·
â”‚   â”œâ”€â”€ validation_utils.py  # é©—è­‰å·¥å…·
â”‚   â””â”€â”€ security_utils.py    # å®‰å…¨å·¥å…·
â”œâ”€â”€ src/                      # å¤–éƒ¨æœå‹™å®¢æˆ¶ç«¯
â”‚   â”œâ”€â”€ clients/             # API å®¢æˆ¶ç«¯
â”‚   â”‚   â”œâ”€â”€ cmoney/          # CMoney å®¢æˆ¶ç«¯
â”‚   â”‚   â”œâ”€â”€ openai/          # OpenAI å®¢æˆ¶ç«¯
â”‚   â”‚   â””â”€â”€ serper/          # Serper å®¢æˆ¶ç«¯
â”‚   â””â”€â”€ services/            # å¤–éƒ¨æœå‹™
â”‚       â”œâ”€â”€ news_service.py  # æ–°èæœå‹™
â”‚       â””â”€â”€ stock_service.py # è‚¡ç¥¨æœå‹™
â””â”€â”€ tests/                    # æ¸¬è©¦æ–‡ä»¶
    â”œâ”€â”€ test_post_routes.py  # è²¼æ–‡è·¯ç”±æ¸¬è©¦
    â”œâ”€â”€ test_kol_routes.py   # KOL è·¯ç”±æ¸¬è©¦
    â””â”€â”€ test_services.py     # æœå‹™æ¸¬è©¦
```

## ğŸ›£ï¸ API è·¯ç”±æ¶æ§‹

### ä¸»è¦è·¯ç”±æ¨¡çµ„

#### post_routes.py - è²¼æ–‡ç®¡ç†
```python
router = APIRouter(prefix="/posts", tags=["posts"])

@router.get("/")
async def get_all_posts(skip: int = 0, limit: int = 100, status: Optional[str] = None)

@router.get("/{post_id}")
async def get_post_detail(post_id: str)

@router.post("/")
async def create_post(post_data: PostCreateRequest)

@router.put("/{post_id}")
async def update_post(post_id: str, update_data: PostUpdateRequest)

@router.delete("/{post_id}")
async def delete_post(post_id: str)

@router.get("/history-stats")
async def get_post_history_stats()
```

#### kol_routes.py - KOL ç®¡ç†
```python
router = APIRouter(prefix="/kol", tags=["kol"])

@router.get("/list")
async def get_kol_list()

@router.get("/{kol_serial}")
async def get_kol_detail(kol_serial: int)

@router.post("/")
async def create_kol(kol_data: KOLCreateRequest)

@router.put("/{kol_serial}")
async def update_kol(kol_serial: int, update_data: KOLUpdateRequest)

@router.delete("/{kol_serial}")
async def delete_kol(kol_serial: int)
```

#### interaction_routes.py - äº’å‹•åˆ†æ
```python
router = APIRouter(prefix="/interactions", tags=["interactions"])

@router.post("/update/{post_id}")
async def update_post_interactions(post_id: str, interaction_data: Dict[str, Any])

@router.get("/{post_id}")
async def get_post_interactions(post_id: str)

@router.post("/batch-update")
async def batch_update_interactions(updates: List[InteractionUpdate])

@router.get("/stats")
async def get_interaction_stats()
```

#### schedule_routes_simple.py - æ’ç¨‹ç®¡ç†
```python
router = APIRouter(prefix="/api/schedule", tags=["schedule"])

@router.get("/tasks")
async def get_schedule_tasks()

@router.get("/daily-stats")
async def get_daily_stats()

@router.post("/create")
async def create_schedule(schedule_data: ScheduleCreateRequest)

@router.put("/{schedule_id}")
async def update_schedule(schedule_id: str, update_data: ScheduleUpdateRequest)

@router.delete("/{schedule_id}")
async def delete_schedule(schedule_id: str)
```

## ğŸ—„ï¸ æ•¸æ“šåº«è¨­è¨ˆ

### ä¸»è¦æ•¸æ“šè¡¨

#### post_records - è²¼æ–‡è¨˜éŒ„
```sql
CREATE TABLE post_records (
    post_id VARCHAR(255) PRIMARY KEY,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    session_id INTEGER,
    kol_serial INTEGER,
    kol_nickname VARCHAR(100),
    kol_persona VARCHAR(50),
    stock_code VARCHAR(10),
    stock_name VARCHAR(100),
    title TEXT,
    content TEXT,
    content_md TEXT,
    status VARCHAR(20) DEFAULT 'draft',
    reviewer_notes TEXT,
    approved_by VARCHAR(100),
    approved_at TIMESTAMP,
    scheduled_at TIMESTAMP,
    published_at TIMESTAMP,
    cmoney_post_id VARCHAR(255),
    cmoney_post_url TEXT,
    publish_error TEXT,
    views INTEGER DEFAULT 0,
    likes INTEGER DEFAULT 0,
    comments INTEGER DEFAULT 0,
    shares INTEGER DEFAULT 0,
    topic_id VARCHAR(255),
    topic_title VARCHAR(255),
    technical_analysis TEXT,
    serper_data JSONB,
    quality_score DECIMAL(3,2),
    ai_detection_score DECIMAL(3,2),
    risk_level VARCHAR(20),
    generation_params JSONB,
    commodity_tags JSONB
);
```

#### kol_profiles - KOL é…ç½®
```sql
CREATE TABLE kol_profiles (
    serial INTEGER PRIMARY KEY,
    nickname VARCHAR(100) NOT NULL,
    persona VARCHAR(50) NOT NULL,
    content_style VARCHAR(50),
    target_audience VARCHAR(50),
    expertise_areas TEXT[],
    tone_settings JSONB,
    model_settings JSONB,
    statistics JSONB,
    email VARCHAR(255),
    password VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### schedules - æ’ç¨‹ç®¡ç†
```sql
CREATE TABLE schedules (
    schedule_id VARCHAR(255) PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    trigger_type VARCHAR(50),
    trigger_config JSONB,
    kol_allocation VARCHAR(50),
    post_time TIME,
    status VARCHAR(20) DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_executed_at TIMESTAMP,
    next_execution_at TIMESTAMP,
    execution_count INTEGER DEFAULT 0,
    success_count INTEGER DEFAULT 0,
    error_count INTEGER DEFAULT 0
);
```

## ğŸ”§ æ ¸å¿ƒæœå‹™

### PostgreSQLPostRecordService
```python
class PostgreSQLPostRecordService:
    def __init__(self):
        self.connection_string = self._get_connection_string()
        self.engine = create_engine(self.connection_string)
        self.SessionLocal = sessionmaker(bind=self.engine)
    
    def get_all_posts(self, skip: int = 0, limit: int = 100, status: Optional[str] = None) -> List[PostRecordInDB]
    
    def get_post_record(self, post_id: str) -> Optional[PostRecordInDB]
    
    def create_post_record(self, post_record: PostRecordInDB) -> PostRecordInDB
    
    def update_post_record(self, post_id: str, update_data: Dict[str, Any]) -> Optional[PostRecordInDB]
    
    def delete_post_record(self, post_id: str) -> bool
    
    def get_kol_profile(self, kol_serial: int) -> Optional[KOLProfile]
    
    def get_schedule_list(self) -> List[Schedule]
```

### ParallelProcessor
```python
class ParallelProcessor:
    def __init__(self, max_concurrent: int = 5, timeout: int = 30, max_retries: int = 3):
        self.semaphore = asyncio.Semaphore(max_concurrent)
        self.timeout = timeout
        self.max_retries = max_retries
    
    async def process_batch_async(self, tasks: List[Callable], progress_callback: Optional[Callable] = None) -> List[Dict[str, Any]]
    
    async def _process_task_with_retry(self, task_func: Callable, *args, **kwargs) -> Any

class InteractionDataProcessor(ParallelProcessor):
    async def fetch_interactions_parallel(self, posts: List[Dict[str, Any]]) -> List[Dict[str, Any]]
    
    async def _fetch_single_interaction(self, post: Dict[str, Any]) -> Dict[str, Any]

class PostGenerationProcessor(ParallelProcessor):
    async def generate_posts_parallel(self, requests: List[PostingRequest]) -> List[Dict[str, Any]]
    
    async def _generate_single_post(self, request: PostingRequest) -> Dict[str, Any]
```

## ğŸ¤– AI å…§å®¹ç”Ÿæˆ

### OpenAI å®¢æˆ¶ç«¯
```python
class OpenAIClient:
    def __init__(self, api_key: str):
        self.client = OpenAI(api_key=api_key)
    
    async def generate_content(self, prompt: str, model: str = "gpt-4") -> str:
        response = await self.client.chat.completions.create(
            model=model,
            messages=[{"role": "user", "content": prompt}],
            max_tokens=2000,
            temperature=0.7
        )
        return response.choices[0].message.content

class ContentGenerator:
    def __init__(self):
        self.openai_client = OpenAIClient(os.getenv("OPENAI_API_KEY"))
        self.serper_client = SerperClient(os.getenv("SERPER_API_KEY"))
    
    async def generate_post_content(self, request: PostingRequest) -> GeneratedContent:
        # 1. æ”¶é›†è‚¡ç¥¨æ•¸æ“š
        stock_data = await self._get_stock_data(request.stock_code)
        
        # 2. æœå°‹ç›¸é—œæ–°è
        news_data = await self._search_news(request.stock_name, request.news_config)
        
        # 3. ç”Ÿæˆå…§å®¹
        content = await self._generate_content(stock_data, news_data, request)
        
        return content
```

## ğŸ“Š è§¸ç™¼å™¨ç³»çµ±

### è§¸ç™¼å™¨é¡å‹
```python
class TriggerType(Enum):
    INDIVIDUAL = "individual"      # å€‹è‚¡è§¸ç™¼å™¨
    SECTOR = "sector"             # é¡è‚¡è§¸ç™¼å™¨
    MACRO = "macro"               # ç¸½ç¶“è§¸ç™¼å™¨
    NEWS = "news"                 # æ–°èè§¸ç™¼å™¨
    INTRADAY = "intraday"         # ç›¤ä¸­è§¸ç™¼å™¨
    VOLUME = "volume"             # æˆäº¤é‡è§¸ç™¼å™¨
    CUSTOM = "custom"             # è‡ªå®šç¾©è§¸ç™¼å™¨

class TriggerConfig:
    trigger_type: TriggerType
    trigger_key: str
    stock_filter: str
    volume_filter: Optional[str] = None
    sector_filter: Optional[str] = None
    macro_filter: Optional[str] = None
    news_filter: Optional[str] = None
    custom_filters: Optional[Dict[str, Any]] = None
    news_keywords: Optional[List[str]] = None
```

### è§¸ç™¼å™¨è™•ç†
```python
class TriggerProcessor:
    def __init__(self):
        self.finlab_client = FinLabClient()
        self.serper_client = SerperClient()
    
    async def process_trigger(self, trigger_config: TriggerConfig) -> TriggerResult:
        if trigger_config.trigger_type == TriggerType.INDIVIDUAL:
            return await self._process_individual_trigger(trigger_config)
        elif trigger_config.trigger_type == TriggerType.VOLUME:
            return await self._process_volume_trigger(trigger_config)
        elif trigger_config.trigger_type == TriggerType.CUSTOM:
            return await self._process_custom_trigger(trigger_config)
    
    async def _process_individual_trigger(self, config: TriggerConfig) -> TriggerResult:
        # è™•ç†å€‹è‚¡è§¸ç™¼å™¨é‚è¼¯
        pass
    
    async def _process_volume_trigger(self, config: TriggerConfig) -> TriggerResult:
        # è™•ç†æˆäº¤é‡è§¸ç™¼å™¨é‚è¼¯
        pass
```

## ğŸ”„ æ‰¹æ¬¡è™•ç†

### æ‰¹æ¬¡ç”Ÿæˆå™¨
```python
class ParallelBatchGenerator:
    def __init__(self, max_concurrent: int = 2, timeout: int = 120):
        self.post_generation_processor = PostGenerationProcessor(max_concurrent, timeout)
    
    async def generate_posts_parallel_stream(self, request: BatchRequest, progress_callback: Optional[Callable] = None) -> AsyncGenerator[str, None]:
        total_posts = len(request.posts)
        successful_posts = 0
        failed_posts = 0
        
        # ç”Ÿæˆæ‰¹æ¬¡ç´šåˆ¥çš„å…±äº« commodity tags
        batch_commodity_tags = await self._generate_batch_tags(request)
        
        yield f"data: {json.dumps({'type': 'batch_start', 'total': total_posts, 'session_id': request.session_id})}\n\n"
        
        tasks = [
            (self._generate_single_post_task, post_data, request, batch_commodity_tags)
            for post_data in request.posts
        ]
        
        async for result_event in self.post_generation_processor.process_batch_stream(tasks, progress_callback):
            if result_event.get('success'):
                successful_posts += 1
            else:
                failed_posts += 1
            
            result_event['progress'] = {
                'current': successful_posts + failed_posts,
                'total': total_posts,
                'percentage': round((successful_posts + failed_posts) / total_posts * 100, 1),
                'successful': successful_posts,
                'failed': failed_posts
            }
            yield f"data: {json.dumps(result_event)}\n\n"
        
        yield f"data: {json.dumps({'type': 'batch_end', 'total': total_posts, 'successful': successful_posts, 'failed': failed_posts})}\n\n"
```

## ğŸ“ˆ è‡ªæˆ‘å­¸ç¿’ç³»çµ±

### äº’å‹•æ•¸æ“šåˆ†æ
```python
class SelfLearningService:
    def __init__(self):
        self.post_service = PostgreSQLPostRecordService()
    
    async def analyze_top_performing_content(self, time_period: str = "7d") -> AnalysisResult:
        # 1. ç²å–æŒ‡å®šæ™‚é–“æ®µå…§çš„è²¼æ–‡æ•¸æ“š
        posts = await self._get_posts_by_period(time_period)
        
        # 2. è¨ˆç®—äº’å‹•åˆ†æ•¸
        posts_with_scores = await self._calculate_interaction_scores(posts)
        
        # 3. æ‰¾å‡ºå‰20%çš„é«˜äº’å‹•å…§å®¹
        top_20_percent = await self._get_top_percentile(posts_with_scores, 0.2)
        
        # 4. åˆ†æå…±åŒç‰¹å¾µ
        common_features = await self._analyze_common_features(top_20_percent)
        
        # 5. ç”Ÿæˆå„ªåŒ–å»ºè­°
        optimization_suggestions = await self._generate_optimization_suggestions(common_features)
        
        return AnalysisResult(
            total_posts=len(posts),
            top_performing_count=len(top_20_percent),
            common_features=common_features,
            suggestions=optimization_suggestions
        )
    
    async def _calculate_interaction_scores(self, posts: List[PostRecord]) -> List[PostWithScore]:
        # äº’å‹•åˆ†æ•¸è¨ˆç®—é‚è¼¯
        # æŒ‰è®š Ã— 1 + ç•™è¨€ Ã— 1.5 + åˆ†äº« Ã— 2 + æ”¶è— Ã— 2
        pass
    
    async def _analyze_common_features(self, top_posts: List[PostRecord]) -> CommonFeatures:
        # åˆ†æé«˜äº’å‹•å…§å®¹çš„å…±åŒç‰¹å¾µ
        # - KOL äººæ ¼è¨­å®š
        # - å…§å®¹é¢¨æ ¼
        # - ç™¼å¸ƒæ™‚é–“
        # - è‚¡ç¥¨é¡å‹
        # - æ–°èé—œéµå­—
        pass
```

## ğŸ”’ å®‰å…¨èˆ‡èªè­‰

### API é‡‘é‘°ç®¡ç†
```python
class APIKeyManager:
    def __init__(self):
        self.keys = {
            'openai': os.getenv('OPENAI_API_KEY'),
            'serper': os.getenv('SERPER_API_KEY'),
            'cmoney': os.getenv('CMONEY_API_KEY'),
        }
    
    def get_key(self, service: str) -> Optional[str]:
        return self.keys.get(service)
    
    def validate_key(self, service: str, key: str) -> bool:
        # é©—è­‰ API é‡‘é‘°æœ‰æ•ˆæ€§
        pass

class SecurityMiddleware:
    def __init__(self, app: FastAPI):
        self.app = app
        self.api_key_manager = APIKeyManager()
    
    async def __call__(self, request: Request, call_next):
        # å®‰å…¨æª¢æŸ¥é‚è¼¯
        # - API é‡‘é‘°é©—è­‰
        # - è«‹æ±‚é »ç‡é™åˆ¶
        # - CORS æª¢æŸ¥
        pass
```

## ğŸ“Š ç›£æ§èˆ‡æ—¥èªŒ

### æ—¥èªŒé…ç½®
```python
import logging
import sys

# é…ç½®æ—¥èªŒ
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s | %(levelname)s | %(name)s | %(message)s',
    handlers=[
        logging.StreamHandler(sys.stdout),
        logging.FileHandler('app.log')
    ]
)

logger = logging.getLogger(__name__)

# æ€§èƒ½ç›£æ§
import time
from functools import wraps

def monitor_performance(func):
    @wraps(func)
    async def wrapper(*args, **kwargs):
        start_time = time.time()
        try:
            result = await func(*args, **kwargs)
            execution_time = time.time() - start_time
            logger.info(f"âœ… {func.__name__} åŸ·è¡Œå®Œæˆï¼Œè€—æ™‚: {execution_time:.2f}ç§’")
            return result
        except Exception as e:
            execution_time = time.time() - start_time
            logger.error(f"âŒ {func.__name__} åŸ·è¡Œå¤±æ•—ï¼Œè€—æ™‚: {execution_time:.2f}ç§’ï¼ŒéŒ¯èª¤: {e}")
            raise
    return wrapper
```

## ğŸš€ éƒ¨ç½²é…ç½®

### Docker é…ç½®
```dockerfile
# Dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

EXPOSE 8000

CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
```

### ç’°å¢ƒè®Šæ•¸é…ç½®
```bash
# .env
OPENAI_API_KEY=your_openai_key
SERPER_API_KEY=your_serper_key
POSTGRES_HOST=postgres-db
POSTGRES_PORT=5432
POSTGRES_DB=posting_management
POSTGRES_USER=postgres
POSTGRES_PASSWORD=password
DATABASE_URL=postgresql://postgres:password@postgres-db:5432/posting_management
```

### å¥åº·æª¢æŸ¥
```python
@app.get("/health")
async def health_check():
    return {
        "status": "healthy",
        "timestamp": datetime.now().isoformat(),
        "services": {
            "trending_api": "connected",
            "summary_api": "connected",
            "ohlc_api": "connected"
        }
    }
```


