# KOL 數據偏好設定

## 概述

KOL 數據偏好設定是個人化引擎的核心組件，通過「刪去法」的方式來控制每個 KOL 使用的數據源，確保內容風格的一致性和個人化程度。

## 設計理念

### 刪去法設計
- **優點**：簡單直接，易於管理和維護
- **適用場景**：數據源數量有限時的最佳選擇
- **擴展性**：未來數據源增加時可升級為更複雜的權重系統

### 核心概念
```
KOL 數據偏好 = 所有可用數據源 - 排除清單
```

## Google Sheets 欄位設計

### 同學會帳號管理工作表

| 欄位名稱 | 欄位類型 | 說明 | 範例 |
|---------|---------|------|------|
| `excluded_data_sources` | 文字 | 數據源排除清單 | `technical_indicators,finlab_ohlc` |
| `data_preference_note` | 文字 | 數據偏好說明 | `專注籌碼面分析，避免複雜技術指標` |

### 欄位格式規範

#### 1. excluded_data_sources
- **格式**：逗號分隔的字串
- **大小寫**：小寫，使用下劃線分隔
- **範例**：
  ```
  technical_indicators,finlab_ohlc,serper_news
  ```

#### 2. data_preference_note
- **格式**：自由文字描述
- **長度**：建議不超過 100 字
- **範例**：
  ```
  專注籌碼面分析，避免複雜技術指標，偏好外資動向數據
  ```

## 數據源分類

### 可排除的數據源列表

| 數據源代碼 | 數據源名稱 | 描述 | 適用 KOL 類型 |
|-----------|-----------|------|--------------|
| `technical_indicators` | 技術指標 | MACD、KD、RSI 等技術指標 | 籌碼派、情緒派 |
| `finlab_ohlc` | 開高低收數據 | 股價開高低收數據 | 技術派 |
| `cmoney_news` | CMoney 新聞 | CMoney 平台新聞數據 | 情緒派 |
| `serper_news` | Serper 新聞 | 外部新聞搜尋結果 | 情緒派、題材派 |
| `chip_data` | 籌碼面數據 | 外資、投信、融資等籌碼數據 | 籌碼派 |
| `monthly_revenue` | 月營收 | 公司月營收數據 | 基本面派 |
| `financial_reports` | 財報數據 | 財報相關數據 | 基本面派 |

## KOL 類型與數據偏好

### 1. 籌碼派 KOL
```json
{
  "excluded_data_sources": "technical_indicators,serper_news",
  "data_preference_note": "專注籌碼面分析，強調資金流向和大戶動向",
  "preferred_sources": ["chip_data", "finlab_ohlc", "cmoney_news"]
}
```

### 2. 技術派 KOL
```json
{
  "excluded_data_sources": "chip_data,monthly_revenue",
  "data_preference_note": "專注技術分析，使用技術指標和價格數據",
  "preferred_sources": ["technical_indicators", "finlab_ohlc"]
}
```

### 3. 情緒派 KOL
```json
{
  "excluded_data_sources": "technical_indicators,chip_data",
  "data_preference_note": "專注市場情緒和投資人心理變化",
  "preferred_sources": ["serper_news", "cmoney_news"]
}
```

### 4. 基本面派 KOL
```json
{
  "excluded_data_sources": "technical_indicators,serper_news",
  "data_preference_note": "專注基本面分析，重視財報和營收數據",
  "preferred_sources": ["monthly_revenue", "financial_reports", "cmoney_news"]
}
```

## 實現邏輯

### 1. 數據源過濾器

```python
class DataSourceFilter:
    def __init__(self, kol_preferences):
        self.excluded_sources = kol_preferences.get('excluded_data_sources', '').split(',')
    
    def filter_data_sources(self, available_sources):
        """根據 KOL 偏好過濾數據源"""
        return [source for source in available_sources 
                if source not in self.excluded_sources]
    
    def get_preferred_sources(self, available_sources):
        """獲取 KOL 偏好的數據源"""
        filtered_sources = self.filter_data_sources(available_sources)
        return filtered_sources
```

### 2. 智能數據調度器

```python
class SmartDataOrchestrator:
    def __init__(self, kol_serial):
        self.kol_serial = kol_serial
        self.kol_preferences = self.load_kol_preferences()
        self.data_filter = DataSourceFilter(self.kol_preferences)
    
    def orchestrate_data(self, topic_type, related_stocks):
        """根據 KOL 偏好調度數據"""
        # 1. 獲取所有可用數據源
        available_sources = self.get_available_sources(topic_type)
        
        # 2. 根據 KOL 偏好過濾
        preferred_sources = self.data_filter.get_preferred_sources(available_sources)
        
        # 3. 調度數據
        data_materials = {}
        for source in preferred_sources:
            data_materials[source] = self.fetch_data(source, related_stocks)
        
        return data_materials
```

## 配置範例

### Google Sheets 配置範例

| KOL 序號 | KOL 暱稱 | 人設 | 排除數據源 | 偏好說明 |
|---------|---------|------|-----------|---------|
| 200 | 川川哥 | 籌碼派 | `technical_indicators,serper_news` | 專注籌碼面分析，強調資金流向 |
| 201 | 韭割哥 | 情緒派 | `technical_indicators,chip_data` | 注重市場情緒和投資人心理 |
| 202 | 技術哥 | 技術派 | `chip_data,monthly_revenue` | 專注技術分析，使用技術指標 |
| 203 | 龜狗一日散戶 | 籌碼派 | `technical_indicators,finlab_ohlc` | 專注籌碼面，避免複雜技術指標 |

## 未來擴展

### 1. 權重系統 (未來升級)
```json
{
  "data_source_weights": {
    "chip_data": 0.8,
    "technical_indicators": 0.2,
    "serper_news": 0.6
  }
}
```

### 2. 動態學習
- 根據內容效果自動調整數據源偏好
- 記錄 KOL 對不同數據源的反饋
- 智能推薦最適合的數據源組合

### 3. 情境化偏好
```json
{
  "contextual_preferences": {
    "bull_market": ["chip_data", "serper_news"],
    "bear_market": ["technical_indicators", "cmoney_news"],
    "sideways_market": ["finlab_ohlc", "monthly_revenue"]
  }
}
```

## 最佳實踐

### 1. 配置建議
- 每個 KOL 至少保留 2-3 個數據源
- 避免完全排除某個類型的數據源
- 定期檢視和調整數據源偏好

### 2. 監控指標
- 內容生成成功率
- 數據源使用頻率
- KOL 內容風格一致性

### 3. 故障排除
- 檢查數據源代碼是否正確
- 確認 Google Sheets 欄位格式
- 驗證數據源 API 可用性

