# 前端 UI 設計與功能文檔

## 🎨 系統概覽

### 技術棧
- **前端框架**: React 18 + TypeScript
- **UI 組件庫**: Ant Design 5.x
- **路由管理**: React Router v6
- **狀態管理**: Zustand
- **樣式方案**: CSS-in-JS (Ant Design)
- **圖表庫**: Ant Design Charts
- **日期處理**: Day.js

### 專案結構
```
src/
├── components/           # 組件目錄
│   ├── Dashboard/        # 儀表板組件
│   ├── KOL/             # KOL 管理組件
│   ├── Layout/          # 布局組件
│   └── PostingManagement/ # 發文管理組件
├── pages/               # 頁面組件
├── services/            # API 服務
├── stores/              # 狀態管理
├── types/               # 類型定義
└── utils/               # 工具函數
```

## 🏗️ 主要功能模組

### 1. 儀表板總覽 (Dashboard Overview)

#### 功能描述
系統首頁，提供整體運營狀況的概覽

#### 主要組件
- `DashboardOverview.tsx` - 主要儀表板組件
- `SystemMonitoring.tsx` - 系統監控組件
- `ContentManagement.tsx` - 內容管理組件
- `InteractionAnalysis.tsx` - 互動分析組件

#### 核心功能
```typescript
interface DashboardOverviewProps {
  systemData: SystemMonitoringData | null;
  interactionData: InteractionAnalysisData | null;
  onRefresh: () => void;
  loading: boolean;
}
```

#### 統計指標
- **KOL 統計**: 總 KOL 數、活躍 KOL 數
- **貼文統計**: 總貼文數、已發布貼文數
- **成功率**: 發文成功率
- **互動統計**: 總互動數、按讚數、留言數
- **微服務健康**: 健康服務數/總服務數

#### UI 特色
- 響應式卡片布局
- 實時數據更新
- 互動式圖表
- 狀態指示器

### 2. 發文管理系統 (Posting Management)

#### 功能描述
完整的發文生成、審核、發布流程管理

#### 主要組件結構
```
PostingManagement/
├── PostingGenerator/          # 發文生成器
│   ├── PostingGenerator.tsx  # 主生成器組件
│   ├── TriggerSelector.tsx   # 觸發器選擇
│   ├── KOLSelector.tsx       # KOL 選擇器
│   ├── TagSettings.tsx       # 標籤設定
│   ├── TrendingTopicsDisplay.tsx # 熱門話題顯示
│   └── ...
├── PostReview/               # 發文審核
│   ├── PostReviewPage.tsx    # 審核頁面
│   └── PublishedPostsSidebar.tsx # 已發布貼文側邊欄
├── PostingDashboard.tsx      # 發文儀表板
└── PostingManagement.tsx     # 主管理組件
```

#### 核心功能

##### 2.1 發文生成器 (PostingGenerator)
**功能描述**: 智能發文內容生成工具

**主要特性**:
- **觸發器選擇**: 支援多種觸發器類型
  - 盤後漲停 (Limit Up After Hours)
  - 盤中漲停 (Intraday Limit Up)
  - 熱門話題 (Trending Topics)
  - 自定義股票 (Custom Stocks)
  - 新聞事件 (News Events)

- **KOL 選擇**: 智能 KOL 分配和選擇
- **標籤設定**: 股票標籤和話題標籤管理
- **批次設定**: 批次生成模式和設定
- **數據源選擇**: 多種數據源整合

**組件架構**:
```typescript
interface PostingGeneratorProps {
  onGenerate: (config: GenerationConfig) => void;
  onBatchGenerate: (configs: GenerationConfig[]) => void;
  loading: boolean;
  error: string | null;
}
```

##### 2.2 熱門話題顯示 (TrendingTopicsDisplay)
**功能描述**: 顯示和管理熱門話題

**主要特性**:
- 即時熱門話題獲取
- 話題選擇和批量生成
- 話題相關股票顯示
- 話題標籤管理

**UI 組件**:
```typescript
interface TrendingTopicsDisplayProps {
  topics: TrendingTopic[];
  selectedTopics: string[];
  onTopicSelect: (topicId: string) => void;
  onBatchGenerate: (topicIds: string[]) => void;
  loading: boolean;
}
```

##### 2.3 標籤設定 (TagSettings)
**功能描述**: 股票標籤和話題標籤的智能管理

**主要特性**:
- 股票標籤自動生成
- 話題標籤管理
- 混合模式支援
- 標籤預覽和編輯

##### 2.4 發文審核 (PostReview)
**功能描述**: 發文內容審核和管理

**主要特性**:
- 待審核貼文列表
- 內容預覽和編輯
- 審核狀態管理
- 批量操作支援

**審核流程**:
1. **草稿狀態** → 生成完成
2. **待審核** → 等待審核
3. **已審核** → 審核通過
4. **已發布** → 發布成功
5. **發布失敗** → 需要重新處理

### 3. KOL 管理系統

#### 功能描述
KOL 帳號管理和個人化設定

#### 主要組件
- `KOLDetail.tsx` - KOL 詳細頁面
- `KOLSelector.tsx` - KOL 選擇器
- `KOLPromptTuner.tsx` - KOL Prompt 調優

#### 核心功能
- **KOL 基本資訊管理**
- **個人化設定配置**
- **Prompt 參數調優**
- **發文歷史追蹤**
- **互動數據分析**

#### KOL 資訊結構
```typescript
interface KOLInfo {
  serial: string;           // 序號
  nickname: string;         // 暱稱
  member_id: string;       // Member ID
  persona: string;         // 人設
  status: string;          // 狀態
  owner: string;           // 認領人
  email: string;           // Email
  password: string;        // 密碼
  whitelist: boolean;      // 白名單狀態
  
  // 發文設定
  post_times: string;      // 發文時間
  target_audience: string; // 目標受眾
  interaction_threshold: number; // 互動閾值
  content_types: string[]; // 內容類型
  
  // 人設設定
  common_terms: string;    // 常用詞彙
  colloquial_terms: string; // 口語化用詞
  tone_style: string;      // 語氣風格
  typing_habit: string;    // 打字習慣
  backstory: string;       // 背景故事
  expertise: string;       // 專長領域
  
  // Prompt 設定
  prompt_persona: string;  // Prompt 人設
  prompt_style: string;   // Prompt 風格
  prompt_guardrails: string; // Prompt 限制
  prompt_skeleton: string; // Prompt 骨架
  prompt_cta: string;     // Prompt 行動呼籲
  prompt_hashtags: string; // Prompt 標籤
  
  // 模型設定
  model_id: string;       // 模型 ID
  model_temp: number;     // 模型溫度
  max_tokens: number;     // 最大 Token 數
}
```

### 4. 系統監控

#### 功能描述
系統運行狀態和微服務監控

#### 主要功能
- **微服務健康監控**
- **系統資源使用情況**
- **任務執行狀態**
- **錯誤日誌追蹤**

#### 監控指標
```typescript
interface SystemMonitoringData {
  system_overview: {
    total_kols: number;
    active_kols: number;
    total_posts: number;
    published_posts: number;
    success_rate: number;
  };
  microservices: {
    [serviceName: string]: {
      status: 'healthy' | 'unhealthy' | 'unknown';
      uptime: number;
      response_time: number;
      error_rate: number;
    };
  };
  system_resources: {
    cpu_usage: number;
    memory_usage: number;
    disk_usage: number;
  };
}
```

## 🎯 用戶界面設計

### 1. 布局設計

#### 整體布局
```
┌─────────────────────────────────────────────────────────┐
│ Header (頂部導航)                                        │
├─────────────┬───────────────────────────────────────────┤
│             │                                           │
│   Sidebar   │              Main Content                │
│  (側邊欄)   │              (主要內容區)                │
│             │                                           │
│             │                                           │
└─────────────┴───────────────────────────────────────────┘
```

#### 側邊欄導航
```typescript
const menuItems = [
  {
    key: '/',
    label: '儀表板總覽',
    icon: <DashboardOutlined />,
  },
  {
    key: 'system-monitoring',
    label: '系統監控',
    icon: <MonitorOutlined />,
    children: [
      { key: '/system-monitoring', label: '系統狀態' },
      { key: '/system-monitoring/services', label: '微服務監控' },
      { key: '/system-monitoring/tasks', label: '任務執行' },
    ],
  },
  {
    key: 'content-management',
    label: '內容管理',
    icon: <FileTextOutlined />,
    children: [
      { key: '/content-management', label: '內容總覽' },
      { key: '/content-management/kols', label: 'KOL 管理' },
      { key: '/content-management/posts', label: '貼文管理' },
    ],
  },
  {
    key: 'posting-management',
    label: '發文管理',
    icon: <EditOutlined />,
    children: [
      { key: '/posting-management', label: '發文總覽' },
      { key: '/posting-management/dashboard', label: '發文儀表板' },
      { key: '/posting-management/generator', label: '發文生成器' },
      { key: '/posting-management/review', label: '發文審核' },
      { key: '/posting-management/published', label: '已發布貼文' },
    ],
  },
];
```

### 2. 組件設計原則

#### 設計系統
- **一致性**: 統一的視覺風格和交互模式
- **響應式**: 支援多種螢幕尺寸
- **可訪問性**: 符合無障礙設計標準
- **性能優化**: 組件懶加載和虛擬化

#### 色彩系統
```css
:root {
  --primary-color: #1890ff;
  --success-color: #52c41a;
  --warning-color: #faad14;
  --error-color: #f5222d;
  --text-color: #262626;
  --text-color-secondary: #8c8c8c;
  --background-color: #f5f5f5;
  --border-color: #d9d9d9;
}
```

#### 字體系統
- **主字體**: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto
- **中文字體**: 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei'
- **字體大小**: 12px, 14px, 16px, 18px, 20px, 24px

### 3. 交互設計

#### 用戶流程
1. **登入系統** → 儀表板總覽
2. **選擇功能** → 發文管理/KOL管理/系統監控
3. **執行操作** → 生成/審核/發布
4. **查看結果** → 狀態追蹤/數據分析

#### 狀態管理
```typescript
interface DashboardState {
  systemData: SystemMonitoringData | null;
  interactionData: InteractionAnalysisData | null;
  kolData: KOLData[] | null;
  postData: PostData[] | null;
  loading: {
    system: boolean;
    interaction: boolean;
    kol: boolean;
    post: boolean;
  };
  lastUpdated: {
    system: string | null;
    interaction: string | null;
    kol: string | null;
    post: string | null;
  };
  error: string | null;
}
```

## 📱 響應式設計

### 斷點設定
```css
/* 手機 */
@media (max-width: 768px) {
  .sidebar { display: none; }
  .main-content { margin-left: 0; }
}

/* 平板 */
@media (min-width: 769px) and (max-width: 1024px) {
  .sidebar { width: 200px; }
}

/* 桌面 */
@media (min-width: 1025px) {
  .sidebar { width: 256px; }
}
```

### 組件適配
- **表格**: 橫向滾動、列隱藏
- **卡片**: 堆疊布局、內容壓縮
- **表單**: 單列布局、按鈕全寬
- **導航**: 抽屜式側邊欄

## 🔧 技術實現

### 1. 狀態管理 (Zustand)
```typescript
export const useDashboardStore = create<DashboardState>((set, get) => ({
  // 狀態
  systemData: null,
  interactionData: null,
  kolData: null,
  postData: null,
  loading: {
    system: false,
    interaction: false,
    kol: false,
    post: false,
  },
  
  // 操作
  setSystemData: (data) => set({ systemData: data }),
  setLoading: (key, loading) => set((state) => ({
    loading: { ...state.loading, [key]: loading }
  })),
  
  // 異步操作
  fetchSystemData: async () => {
    set({ loading: { ...get().loading, system: true } });
    try {
      const data = await systemAPI.getSystemData();
      set({ systemData: data });
    } catch (error) {
      set({ error: error.message });
    } finally {
      set({ loading: { ...get().loading, system: false } });
    }
  },
}));
```

### 2. API 服務層
```typescript
class PostingManagementAPI {
  static async generateBatchPosts(config: BatchGenerationConfig) {
    const response = await fetch('/api/posting/batch-generate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(config),
    });
    return response.json();
  }
  
  static async getSessionPosts(sessionId: number) {
    const response = await fetch(`/api/posting/session/${sessionId}/posts`);
    return response.json();
  }
  
  static async publishToCMoney(postId: string) {
    const response = await fetch(`/api/posting/${postId}/publish`, {
      method: 'POST',
    });
    return response.json();
  }
}
```

### 3. 組件懶加載
```typescript
const PostingGenerator = lazy(() => import('./components/PostingManagement/PostingGenerator'));
const KOLDetail = lazy(() => import('./components/KOL/KOLDetail'));
const SystemMonitoring = lazy(() => import('./components/Dashboard/SystemMonitoring'));

// 路由配置
<Route path="/posting-management/generator" element={
  <Suspense fallback={<Loading />}>
    <PostingGenerator />
  </Suspense>
} />
```

## 🎨 UI 組件庫

### 1. Ant Design 組件使用

#### 數據展示
- `Table` - 數據表格
- `Card` - 卡片容器
- `Statistic` - 統計數值
- `Progress` - 進度條
- `Tag` - 標籤
- `Timeline` - 時間軸

#### 數據輸入
- `Form` - 表單
- `Input` - 輸入框
- `Select` - 選擇器
- `DatePicker` - 日期選擇
- `Switch` - 開關
- `Slider` - 滑塊

#### 反饋
- `Alert` - 警告提示
- `Modal` - 對話框
- `Notification` - 通知
- `Spin` - 載入中
- `Result` - 結果頁

#### 導航
- `Menu` - 導航菜單
- `Breadcrumb` - 麵包屑
- `Pagination` - 分頁
- `Steps` - 步驟條

### 2. 自定義組件

#### 發文生成器組件
```typescript
interface PostingGeneratorProps {
  onGenerate: (config: GenerationConfig) => void;
  onBatchGenerate: (configs: GenerationConfig[]) => void;
  loading: boolean;
  error: string | null;
}

const PostingGenerator: React.FC<PostingGeneratorProps> = ({
  onGenerate,
  onBatchGenerate,
  loading,
  error
}) => {
  const [config, setConfig] = useState<GenerationConfig>({});
  
  return (
    <Card title="發文生成器" loading={loading}>
      <Form layout="vertical">
        <TriggerSelector onChange={handleTriggerChange} />
        <KOLSelector onChange={handleKOLChange} />
        <TagSettings onChange={handleTagChange} />
        <Button 
          type="primary" 
          onClick={() => onGenerate(config)}
          loading={loading}
        >
          生成貼文
        </Button>
      </Form>
    </Card>
  );
};
```

## 📊 數據可視化

### 1. 圖表組件
- **折線圖**: 互動趨勢、系統性能
- **柱狀圖**: KOL 表現對比
- **餅圖**: 內容類型分布
- **散點圖**: 互動率分析

### 2. 實時數據
- WebSocket 連接
- 數據自動刷新
- 狀態實時更新
- 錯誤即時通知

## 🔒 安全性

### 1. 認證授權
- JWT Token 認證
- 角色基礎權限控制
- API 請求攔截
- 路由守衛

### 2. 數據安全
- 敏感數據加密
- XSS 防護
- CSRF 防護
- 輸入驗證

## 🚀 性能優化

### 1. 代碼分割
- 路由級別分割
- 組件懶加載
- 第三方庫分割

### 2. 緩存策略
- API 響應緩存
- 組件狀態緩存
- 本地存儲優化

### 3. 渲染優化
- React.memo 優化
- useMemo/useCallback
- 虛擬化長列表
- 圖片懶加載

---

**文檔版本**: v1.0  
**最後更新**: 2025-01-15  
**審核狀態**: 待審核
