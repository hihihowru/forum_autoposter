## 第四章：排程管理

### 4.1 什麼是排程管理？

排程管理讓您可以**設定自動化的發文任務**，系統會在指定的時間自動執行：
- 抓取符合條件的股票
- 生成文章
- 審核（如果設定自動審核）
- 發布（如果設定自動發布）

**核心價值**：解放人力，實現全自動發文

### 4.2 排程與手動生成的差異

| 比較項目 | 手動生成 | 排程自動生成 |
|---------|---------|-------------|
| **觸發方式** | 人工點擊「生成」 | 系統自動執行 |
| **執行時間** | 立即執行 | 指定時間執行 |
| **適用情境** | 一次性需求 | 週期性需求 |
| **範例** | 臨時想分析某檔股票 | 每天盤後 14:30 自動分析漲停股 |

### 4.3 如何進入排程管理頁面？

1. 點擊左側選單的「**排程管理**」

### 4.4 頁面介面說明

**上方統計區**：
- **總排程數**：目前設定的排程任務數
- **啟用中**：正在運作的排程數
- **即將執行**：下一個執行時間在 1 小時內的排程
- **下次執行時間**：最近的排程執行時間

**背景排程器開關**：
- 🟢 **啟動**：排程器正在運作，會自動執行排程任務
- 🔴 **停止**：排程器已停止，不會執行任何任務

**排程列表表格**：

| 欄位 | 說明 |
|------|------|
| **任務名稱** | 排程的識別名稱 |
| **說明** | 此排程的用途描述 |
| **狀態** | 🟢 啟用中 / 🟡 暫停 / 🔴 失敗 |
| **排程類型** | 每日定時 / 間隔執行 / 批次執行 |
| **下次執行** | 下一次執行的時間 |
| **上次執行** | 上一次執行的時間 |
| **成功率** | 成功次數 / 總執行次數 |
| **操作** | 編輯、啟用/停用、刪除 |

### 4.5 新增排程

**操作步驟**：

1. 點擊「**+ 新增排程**」按鈕
2. 填寫排程設定

---

#### 📝 第一部分：基本資訊

**任務名稱**：
- 範例：「盤後高量漲停-自動發布」

**任務說明**：
- 範例：「每日盤後 14:30 自動抓取高量漲停股並發文」

---

#### ⏰ 第二部分：排程時間設定

**排程類型**：

##### 📅 每日定時執行
- **說明**：每天在固定時間執行
- **設定項目**：
  - 執行時間：選擇時 & 分（例：14:30）
  - 執行日期：選擇星期幾執行
    - 範例：勾選「週一到週五」（只在交易日執行）

**使用情境**：
- 每天盤後 14:30 分析漲停股
- 每天早上 09:00 分析盤前消息
- 每週五 17:00 發布週報

---

##### ⏱️ 間隔執行
- **說明**：每隔固定時間執行一次
- **設定項目**：
  - 間隔時間：輸入秒數
    - 範例：3600 秒（= 1 小時）
    - 範例：300 秒（= 5 分鐘）

**使用情境**：
- 盤中每 30 分鐘檢查一次漲停股
- 每小時更新熱門話題

---

##### 📦 批次執行
- **說明**：在一段時間內分批執行
- **設定項目**：
  - 開始時間
  - 結束時間
  - 批次間隔

**使用情境**：
- 從 14:30 到 16:00，每 15 分鐘發布 3 篇文章

---

#### 🎯 第三部分：觸發器設定

與「發文生成設定」的步驟一相同，選擇：
- 觸發器類型（熱門話題、盤後漲停等）
- 篩選條件

**範例**：
- 觸發器：盤後高量漲停
- 篩選：成交量 > 5000 張

---

#### 🎨 第四部分：內容生成設定

簡化版的設定，包括：
- **KOL 分配方式**：隨機 / 手動指定 / 動態標準
- **內容長度**：簡短 / 中等 / 詳細
- **數據源**：勾選要使用的數據源
- **新聞搜尋**：是否啟用

---

#### ⚙️ 第五部分：自動化設定

**自動審核**：
- ✅ **啟用**：生成後自動標記為已審核（品質分數達標者）
- ❌ **停用**：生成後需人工審核

**自動發布**：
- ✅ **啟用**：審核通過後自動發布到論壇
- ❌ **停用**：審核通過後等待人工發布

**品質門檻**：
- 設定自動審核的品質分數門檻（0.0 - 1.0）
- 範例：設定為 0.8
- 只有品質分數 ≥ 0.8 的文章會自動審核

**最大生成數量**：
- 限制單次執行最多生成幾篇文章
- 範例：最多 10 篇

---

3. 填寫完成後，點擊「**儲存**」

**系統會自動啟用此排程**，並在指定時間執行。

---

### 4.6 編輯排程

**操作步驟**：

1. 在排程列表中，找到要編輯的排程
2. 點擊「**🔧 編輯**」按鈕
3. 修改設定
4. 點擊「**儲存**」

---

### 4.7 啟用 / 暫停排程

**操作步驟**：

1. 在排程列表中，找到該排程
2. 點擊「**狀態**」欄位的開關
   - 🟢 **啟用** → 🟡 **暫停**
   - 🟡 **暫停** → 🟢 **啟用**

**注意**：
- 暫停的排程不會執行，但設定會保留
- 可以隨時重新啟用

---

### 4.8 刪除排程

**操作步驟**：

1. 在排程列表中，找到要刪除的排程
2. 點擊「**🗑️ 刪除**」按鈕
3. 確認刪除

**注意**：
- ⚠️ 刪除後無法復原
- ⚠️ 已生成的文章不會被刪除

---

### 4.9 查看排程執行歷史

**操作步驟**：

1. 在排程列表中，點擊排程名稱
2. 進入排程詳情頁面

**排程詳情頁面內容**：

#### 📊 上方資訊卡片
- **任務名稱 & 說明**
- **狀態**：啟用中 / 暫停
- **總執行次數**
- **成功次數 & 失敗次數**
- **成功率**

#### 📈 執行歷史時間軸

以時間軸方式顯示每次執行的記錄：
- **執行時間**
- **執行結果**：✅ 成功 / ❌ 失敗
- **生成文章數**
- **批次編號**（點擊可查看該批次的文章）
- **錯誤訊息**（如果執行失敗）

**範例**：
```
📅 2025-10-20 14:30:00
✅ 執行成功
📝 生成 8 篇文章
🆔 批次編號：1729415400000
[查看文章]

📅 2025-10-19 14:30:00
❌ 執行失敗
❗ 錯誤：無符合條件的股票

📅 2025-10-18 14:30:00
✅ 執行成功
📝 生成 5 篇文章
🆔 批次編號：1729329000000
[查看文章]
```

---

### 4.10 控制背景排程器

**背景排程器是什麼？**
背景排程器是系統的「排程引擎」，負責監控所有排程任務並在指定時間執行。

**什麼時候需要停止背景排程器？**
- 🛠️ 系統維護時
- 🔧 調整重要設定時
- 🚫 暫時不需要任何自動發文時

**操作步驟**：

1. 在排程管理頁面上方，找到「**背景排程器**」開關
2. 點擊開關：
   - 🟢 **啟動** → 🔴 **停止**
   - 🔴 **停止** → 🟢 **啟動**

**注意**：
- ⚠️ 停止背景排程器後，所有排程任務都不會執行
- ⚠️ 重新啟動後，排程會恢復正常運作

---

### 4.11 排程管理最佳實踐

#### 🎯 建議排程配置

**情境一：盤後快速發布**
- **任務名稱**：盤後高量漲停-快速發布
- **執行時間**：每日 14:30
- **觸發器**：盤後高量漲停
- **KOL**：隨機分配（3-5 個技術派 KOL）
- **內容長度**：簡短
- **自動審核**：✅ 啟用（門檻 0.7）
- **自動發布**：✅ 啟用
- **最大生成數**：10 篇

**情境二：每日熱門話題**
- **任務名稱**：每日熱門話題-人工審核
- **執行時間**：每日 10:00
- **觸發器**：熱門話題
- **KOL**：手動指定（選擇互動性高的 KOL）
- **內容長度**：中等
- **自動審核**：❌ 停用
- **自動發布**：❌ 停用
- **最大生成數**：5 篇

**情境三：週報系列文**
- **任務名稱**：週五市場週報
- **執行時間**：每週五 17:00
- **觸發器**：自選股（手動指定重點股票）
- **KOL**：手動指定（綜合型 KOL）
- **內容長度**：詳細
- **自動審核**：❌ 停用
- **自動發布**：❌ 停用

---

#### 📝 排程維護建議

**每週檢查**：
- 查看每個排程的成功率
- 找出經常失敗的排程並分析原因
- 調整觸發器篩選條件（例：成交量門檻是否太高？）

**每月優化**：
- 根據文章互動數據，調整發布時間
- 測試不同的 KOL 組合
- 更新觸發器策略

---

