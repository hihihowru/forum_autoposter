# Serper API çµ±ä¸€æ•´åˆ PRD

## ğŸ“‹ ç”¢å“éœ€æ±‚æ–‡æª” (PRD)

### ğŸ¯ ç”¢å“æ¦‚è¿°

**ç”¢å“åç¨±**: Serper API çµ±ä¸€æ•´åˆç³»çµ± (Unified Serper API Integration System)  
**ç‰ˆæœ¬**: v1.0  
**å‰µå»ºæ—¥æœŸ**: 2025-01-15  
**è² è²¬äºº**: AI Assistant  

### ğŸ” èƒŒæ™¯èˆ‡å•é¡Œ

#### ç¾æœ‰å•é¡Œ
1. **é‡è¤‡å¯¦ç¾**: å¤šå€‹ `SerperNewsClient` é¡åˆ¥åˆ†æ•£åœ¨ä¸åŒæª”æ¡ˆä¸­
2. **åŠŸèƒ½é‡è¤‡**: ç›¸åŒçš„æœå°‹åŠŸèƒ½åœ¨å¤šå€‹åœ°æ–¹é‡è¤‡å¯¦ç¾
3. **ç¼ºä¹çµ±ä¸€ç®¡ç†**: æ²’æœ‰çµ±ä¸€çš„ API èª¿ç”¨ã€éŒ¯èª¤è™•ç†å’Œç›£æ§
4. **é—œéµå­—ç­–ç•¥å–®ä¸€**: æ‰€æœ‰æœå°‹éƒ½ä½¿ç”¨å›ºå®šçš„é—œéµå­—ç­–ç•¥
5. **çµæœè™•ç†ä¸ä¸€è‡´**: ä¸åŒå¯¦ç¾å°æœå°‹çµæœçš„è™•ç†æ–¹å¼ä¸åŒ

#### å—å½±éŸ¿çš„æª”æ¡ˆ
- `generate_kangpei_posts_v2.py`
- `generate_kangpei_posts_v3.py` 
- `generate_kangpei_posts_v4.py`
- `generate_kangpei_posts_v6.py`
- `smart_limit_up_generator.py`
- `src/agents/multi_level_search_strategy.py`

#### æ¥­å‹™å½±éŸ¿
- ç¶­è­·æˆæœ¬é«˜ï¼Œéœ€è¦åŒæ™‚ç¶­è­·å¤šå€‹é‡è¤‡çš„å¯¦ç¾
- åŠŸèƒ½ä¸ä¸€è‡´ï¼Œå¯èƒ½å°è‡´æœå°‹çµæœå“è³ªå·®ç•°
- ç¼ºä¹çµ±ä¸€ç›£æ§ï¼Œé›£ä»¥è¿½è¹¤ API ä½¿ç”¨æƒ…æ³
- æ“´å±•å›°é›£ï¼Œæ–°å¢åŠŸèƒ½éœ€è¦åœ¨å¤šå€‹åœ°æ–¹ä¿®æ”¹

### ğŸ¯ ç”¢å“ç›®æ¨™

#### ä¸»è¦ç›®æ¨™
1. **çµ±ä¸€ API èª¿ç”¨**: å»ºç«‹çµ±ä¸€çš„ Serper API èª¿ç”¨ä»‹é¢
2. **æ™ºèƒ½é—œéµå­—å„ªåŒ–**: å¯¦ç¾å‹•æ…‹é—œéµå­—ç”Ÿæˆå’Œå„ªåŒ–
3. **çµæœè™•ç†æ¨™æº–åŒ–**: çµ±ä¸€æœå°‹çµæœçš„è™•ç†å’Œå¢å¼·é‚è¼¯
4. **ç›£æ§å’Œç®¡ç†**: å¯¦ç¾ API ä½¿ç”¨é‡ç›£æ§å’ŒéŒ¯èª¤è™•ç†

#### æˆåŠŸæŒ‡æ¨™
- ä»£ç¢¼é‡è¤‡ç‡é™ä½ 90%
- API èª¿ç”¨çµ±ä¸€æ€§ 100%
- æœå°‹çµæœè™•ç†ä¸€è‡´æ€§ 100%
- ç¶­è­·æˆæœ¬é™ä½ 70%

### ğŸ—ï¸ ç³»çµ±æ¶æ§‹è¨­è¨ˆ

#### æ ¸å¿ƒçµ„ä»¶

##### 1. çµ±ä¸€ Serper å®¢æˆ¶ç«¯
```
UnifiedSerperClient
â”œâ”€â”€ API èª¿ç”¨ç®¡ç†
â”œâ”€â”€ éŒ¯èª¤è™•ç†å’Œé‡è©¦
â”œâ”€â”€ ä½¿ç”¨é‡ç›£æ§
â”œâ”€â”€ çµæœå¿«å–
â””â”€â”€ é…ç½®ç®¡ç†
```

##### 2. æ™ºèƒ½æœå°‹å¼•æ“
```
IntelligentSearchEngine
â”œâ”€â”€ é—œéµå­—ç”Ÿæˆå™¨
â”œâ”€â”€ æœå°‹ç­–ç•¥é¸æ“‡å™¨
â”œâ”€â”€ çµæœåˆ†æå™¨
â”œâ”€â”€ ç›¸é—œæ€§è©•åˆ†å™¨
â””â”€â”€ å…§å®¹å¢å¼·å™¨
```

##### 3. æœå°‹ç­–ç•¥ç®¡ç†å™¨
```
SearchStrategyManager
â”œâ”€â”€ TrendingTopicStrategy
â”œâ”€â”€ LimitUpStrategy
â”œâ”€â”€ NewsEventStrategy
â”œâ”€â”€ CustomStockStrategy
â””â”€â”€ EarningsReportStrategy
```

### ğŸ“ åŠŸèƒ½éœ€æ±‚

#### åŠŸèƒ½ 1: çµ±ä¸€ Serper å®¢æˆ¶ç«¯

##### 1.1 API èª¿ç”¨ç®¡ç†
**ç›®æ¨™**: æä¾›çµ±ä¸€çš„ Serper API èª¿ç”¨ä»‹é¢

**åŠŸèƒ½æè¿°**:
- çµ±ä¸€çš„ API ç«¯é»é…ç½®
- æ¨™æº–åŒ–çš„è«‹æ±‚æ ¼å¼
- çµ±ä¸€çš„éŸ¿æ‡‰è™•ç†
- æ”¯æ´å¤šç¨®æœå°‹é¡å‹

**API ä»‹é¢è¨­è¨ˆ**:
```python
class UnifiedSerperClient:
    def __init__(self, api_key: str, config: SerperConfig)
    
    async def search_news(self, query: str, params: SearchParams) -> SearchResult
    async def search_web(self, query: str, params: SearchParams) -> SearchResult
    async def search_images(self, query: str, params: SearchParams) -> SearchResult
    
    def get_usage_stats(self) -> UsageStats
    def get_error_logs(self) -> List[ErrorLog]
```

##### 1.2 éŒ¯èª¤è™•ç†å’Œé‡è©¦
**ç›®æ¨™**: å¯¦ç¾å¥å£¯çš„éŒ¯èª¤è™•ç†å’Œè‡ªå‹•é‡è©¦æ©Ÿåˆ¶

**åŠŸèƒ½æè¿°**:
- è‡ªå‹•é‡è©¦æ©Ÿåˆ¶ (æœ€å¤š3æ¬¡)
- æŒ‡æ•¸é€€é¿ç­–ç•¥
- éŒ¯èª¤åˆ†é¡å’Œè™•ç†
- é™ç´šç­–ç•¥

**éŒ¯èª¤è™•ç†ç­–ç•¥**:
```
API é™åˆ¶éŒ¯èª¤ (429):
- ç­‰å¾… 60 ç§’å¾Œé‡è©¦
- æœ€å¤šé‡è©¦ 3 æ¬¡
- è¨˜éŒ„ä½¿ç”¨é‡çµ±è¨ˆ

ç¶²è·¯éŒ¯èª¤ (5xx):
- ç«‹å³é‡è©¦
- æœ€å¤šé‡è©¦ 3 æ¬¡
- ä½¿ç”¨æŒ‡æ•¸é€€é¿

èªè­‰éŒ¯èª¤ (401):
- ä¸é‡è©¦
- ç«‹å³è¨˜éŒ„éŒ¯èª¤
- é€šçŸ¥ç®¡ç†å“¡
```

##### 1.3 ä½¿ç”¨é‡ç›£æ§
**ç›®æ¨™**: ç›£æ§ API ä½¿ç”¨é‡ä¸¦æä¾›é è­¦

**åŠŸèƒ½æè¿°**:
- å¯¦æ™‚ä½¿ç”¨é‡è¿½è¹¤
- æ¯æ—¥/æ¯æœˆä½¿ç”¨é‡çµ±è¨ˆ
- ä½¿ç”¨é‡é è­¦æ©Ÿåˆ¶
- æˆæœ¬åˆ†æ

#### åŠŸèƒ½ 2: æ™ºèƒ½æœå°‹å¼•æ“

##### 2.1 é—œéµå­—ç”Ÿæˆå™¨
**ç›®æ¨™**: æ ¹æ“šä¸åŒè§¸ç™¼å™¨é¡å‹ç”Ÿæˆæœ€å„ªé—œéµå­—

**åŠŸèƒ½æè¿°**:
- è§¸ç™¼å™¨å°ˆç”¨é—œéµå­—ç­–ç•¥
- LLM è¼”åŠ©é—œéµå­—ç”Ÿæˆ
- é—œéµå­—ç›¸é—œæ€§åˆ†æ
- å‹•æ…‹é—œéµå­—èª¿æ•´

**é—œéµå­—ç”Ÿæˆç­–ç•¥**:
```python
class KeywordGenerator:
    def generate_trending_topic_keywords(self, topic: str) -> List[str]
    def generate_limit_up_keywords(self, stock: StockInfo) -> List[str]
    def generate_news_event_keywords(self, event: NewsEvent) -> List[str]
    def optimize_keywords(self, keywords: List[str], context: Dict) -> List[str]
```

##### 2.2 æœå°‹ç­–ç•¥é¸æ“‡å™¨
**ç›®æ¨™**: æ ¹æ“šä¸åŒå ´æ™¯é¸æ“‡æœ€é©åˆçš„æœå°‹ç­–ç•¥

**åŠŸèƒ½æè¿°**:
- ç­–ç•¥æ¨¡æ¿ç®¡ç†
- å‹•æ…‹ç­–ç•¥é¸æ“‡
- ç­–ç•¥æ•ˆæœè©•ä¼°
- ç­–ç•¥å„ªåŒ–å»ºè­°

**æœå°‹ç­–ç•¥é¡å‹**:
```
æ–°èæœå°‹ç­–ç•¥:
- å³æ™‚æ€§å„ªå…ˆ
- ç›¸é—œæ€§å„ªå…ˆ
- æ¬Šå¨æ€§å„ªå…ˆ

ç¶²é æœå°‹ç­–ç•¥:
- ç¶œåˆæ€§æœå°‹
- å°ˆæ¥­æ€§æœå°‹
- ç¤¾ç¾¤æ€§æœå°‹

åœ–ç‰‡æœå°‹ç­–ç•¥:
- åœ–è¡¨å„ªå…ˆ
- æ–°èåœ–ç‰‡å„ªå…ˆ
- ç¤¾ç¾¤åœ–ç‰‡å„ªå…ˆ
```

##### 2.3 çµæœåˆ†æå™¨
**ç›®æ¨™**: åˆ†æå’Œè™•ç†æœå°‹çµæœ

**åŠŸèƒ½æè¿°**:
- çµæœç›¸é—œæ€§è©•åˆ†
- å…§å®¹å“è³ªè©•ä¼°
- é‡è¤‡å…§å®¹éæ¿¾
- çµæœæ’åºå’Œç¯©é¸

**åˆ†æç¶­åº¦**:
```
ç›¸é—œæ€§è©•åˆ†:
- é—œéµå­—åŒ¹é…åº¦ (40%)
- å…§å®¹ç›¸é—œæ€§ (30%)
- æ™‚é–“æ–°é®®åº¦ (20%)
- ä¾†æºæ¬Šå¨æ€§ (10%)

å“è³ªè©•ä¼°:
- å…§å®¹å®Œæ•´æ€§
- è³‡è¨Šæº–ç¢ºæ€§
- èªè¨€å“è³ª
- çµæ§‹æ¸…æ™°åº¦
```

#### åŠŸèƒ½ 3: æœå°‹ç­–ç•¥ç®¡ç†å™¨

##### 3.1 ç†±é–€è©±é¡Œæœå°‹ç­–ç•¥
**ç›®æ¨™**: ç‚ºç†±é–€è©±é¡Œè§¸ç™¼å™¨è¨­è¨ˆå°ˆç”¨æœå°‹ç­–ç•¥

**ç­–ç•¥ç‰¹é»**:
- æœå°‹è©±é¡Œç›¸é—œæ–°èå’Œè¨è«–
- é—œæ³¨ç¤¾ç¾¤åæ‡‰å’Œå½±éŸ¿åŠ›
- åŒ…å«ç›¸é—œç”¢æ¥­å’Œå…¬å¸è³‡è¨Š
- å¼·èª¿ç¤¾æœƒå½±éŸ¿å’ŒæŠ•è³‡æ©Ÿæœƒ

**é—œéµå­—çµ„åˆ**:
```
ä¸»è¦é—œéµå­—: è©±é¡Œåç¨± + ç›¸é—œç”¢æ¥­
æ¬¡è¦é—œéµå­—: ç¤¾æœƒå½±éŸ¿ + æŠ•è³‡æ©Ÿæœƒ  
é•·å°¾é—œéµå­—: å…·é«”äº‹ä»¶ + å¸‚å ´åæ‡‰
```

##### 3.2 æ¼²åœè‚¡æœå°‹ç­–ç•¥
**ç›®æ¨™**: ç‚ºæ¼²åœè‚¡è§¸ç™¼å™¨è¨­è¨ˆå°ˆç”¨æœå°‹ç­–ç•¥

**ç­–ç•¥ç‰¹é»**:
- æœå°‹æ¼²åœåŸå› å’ŒæŠ€è¡“åˆ†æ
- é—œæ³¨ç±Œç¢¼é¢å’Œè³‡é‡‘æµå‘
- åŒ…å«ç”¢æ¥­å‹•æ…‹å’Œå…¬å¸æ¶ˆæ¯
- å¼·èª¿æŠ€è¡“æŒ‡æ¨™å’Œèµ°å‹¢é æ¸¬

**é—œéµå­—çµ„åˆ**:
```
ä¸»è¦é—œéµå­—: è‚¡ç¥¨åç¨± + æ¼²åœåŸå› 
æ¬¡è¦é—œéµå­—: æŠ€è¡“åˆ†æ + ç±Œç¢¼é¢
é•·å°¾é—œéµå­—: å…·é«”æŒ‡æ¨™ + èµ°å‹¢é æ¸¬
```

##### 3.3 æ–°èäº‹ä»¶æœå°‹ç­–ç•¥
**ç›®æ¨™**: ç‚ºæ–°èäº‹ä»¶è§¸ç™¼å™¨è¨­è¨ˆå°ˆç”¨æœå°‹ç­–ç•¥

**ç­–ç•¥ç‰¹é»**:
- æœå°‹äº‹ä»¶ç›¸é—œçš„å³æ™‚æ–°è
- é—œæ³¨å¸‚å ´åæ‡‰å’Œå½±éŸ¿åˆ†æ
- åŒ…å«å°ˆå®¶è©•è«–å’Œé æ¸¬
- å¼·èª¿æŠ•è³‡æ©Ÿæœƒå’Œé¢¨éšªæé†’

### ğŸ”§ æŠ€è¡“è¦æ ¼

#### æŠ€è¡“æ¶æ§‹
- **èªè¨€**: Python 3.9+
- **æ¡†æ¶**: FastAPI, asyncio
- **å¤–éƒ¨æœå‹™**: Serper API
- **æ•¸æ“šå­˜å„²**: PostgreSQL
- **å¿«å–**: Redis
- **ç›£æ§**: Prometheus + Grafana (å¯é¸)

#### API è¨­è¨ˆ
```python
# çµ±ä¸€ Serper å®¢æˆ¶ç«¯
class UnifiedSerperClient:
    def __init__(self, api_key: str, config: SerperConfig)
    async def search(self, strategy: SearchStrategy) -> SearchResult
    def get_usage_stats(self) -> UsageStats
    def get_error_logs(self) -> List[ErrorLog]

# æ™ºèƒ½æœå°‹å¼•æ“
class IntelligentSearchEngine:
    def __init__(self, serper_client: UnifiedSerperClient)
    async def search_with_strategy(self, trigger_type: TriggerType, context: Dict) -> EnhancedSearchResult
    def generate_keywords(self, trigger_type: TriggerType, context: Dict) -> List[str]
    def analyze_results(self, results: List[Dict]) -> AnalysisResult

# æœå°‹ç­–ç•¥ç®¡ç†å™¨
class SearchStrategyManager:
    def get_strategy(self, trigger_type: TriggerType) -> SearchStrategy
    def optimize_strategy(self, strategy: SearchStrategy, feedback: Feedback) -> SearchStrategy
    def evaluate_strategy(self, strategy: SearchStrategy, results: List[Dict]) -> EvaluationResult
```

#### æ•¸æ“šæ¨¡å‹
```python
@dataclass
class SerperConfig:
    api_key: str
    base_url: str = "https://google.serper.dev/search"
    timeout: int = 30
    max_retries: int = 3
    rate_limit: int = 100  # requests per minute

@dataclass
class SearchParams:
    query: str
    num_results: int = 10
    search_type: str = "search"
    language: str = "zh-TW"
    country: str = "TW"
    custom_params: Dict[str, Any] = field(default_factory=dict)

@dataclass
class SearchResult:
    success: bool
    results: List[Dict[str, Any]]
    total_results: int
    search_time: float
    error_message: Optional[str] = None

@dataclass
class SearchStrategy:
    trigger_type: TriggerType
    keyword_generation_prompt: str
    search_params_template: Dict[str, Any]
    result_filtering_rules: List[FilterRule]
    enhancement_prompt: str

@dataclass
class EnhancedSearchResult:
    original_results: List[Dict[str, Any]]
    enhanced_results: List[Dict[str, Any]]
    analysis: AnalysisResult
    keywords_used: List[str]
    strategy_applied: SearchStrategy
```

### ğŸ“Š å¯¦æ–½è¨ˆåŠƒ

#### éšæ®µ 1: çµ±ä¸€ Serper å®¢æˆ¶ç«¯ (1é€±)
- è¨­è¨ˆçµ±ä¸€çš„ API èª¿ç”¨ä»‹é¢
- å¯¦ç¾éŒ¯èª¤è™•ç†å’Œé‡è©¦æ©Ÿåˆ¶
- å»ºç«‹ä½¿ç”¨é‡ç›£æ§ç³»çµ±
- å–®å…ƒæ¸¬è©¦å’Œæ•´åˆæ¸¬è©¦

#### éšæ®µ 2: æ™ºèƒ½æœå°‹å¼•æ“ (2é€±)
- å¯¦ç¾é—œéµå­—ç”Ÿæˆå™¨
- å»ºç«‹æœå°‹ç­–ç•¥é¸æ“‡å™¨
- é–‹ç™¼çµæœåˆ†æå™¨
- æ•´åˆ LLM è¼”åŠ©åŠŸèƒ½

#### éšæ®µ 3: æœå°‹ç­–ç•¥ç®¡ç†å™¨ (1é€±)
- å¯¦ç¾å„è§¸ç™¼å™¨å°ˆç”¨ç­–ç•¥
- å»ºç«‹ç­–ç•¥è©•ä¼°å’Œå„ªåŒ–æ©Ÿåˆ¶
- æ•´åˆåˆ°ç¾æœ‰ç³»çµ±
- å®Œæ•´æ¸¬è©¦å’Œéƒ¨ç½²

#### éšæ®µ 4: é·ç§»å’Œå„ªåŒ– (1é€±)
- é·ç§»ç¾æœ‰é‡è¤‡å¯¦ç¾
- æ€§èƒ½å„ªåŒ–å’Œç›£æ§
- æ–‡æª”æ›´æ–°å’ŒåŸ¹è¨“
- ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²

### ğŸ§ª æ¸¬è©¦ç­–ç•¥

#### å–®å…ƒæ¸¬è©¦
- API èª¿ç”¨åŠŸèƒ½æ¸¬è©¦
- éŒ¯èª¤è™•ç†æ©Ÿåˆ¶æ¸¬è©¦
- é—œéµå­—ç”Ÿæˆæ¼”ç®—æ³•æ¸¬è©¦
- æœå°‹ç­–ç•¥é‚è¼¯æ¸¬è©¦

#### æ•´åˆæ¸¬è©¦
- ç«¯åˆ°ç«¯æœå°‹æµç¨‹æ¸¬è©¦
- ä¸åŒè§¸ç™¼å™¨ç­–ç•¥æ¯”è¼ƒæ¸¬è©¦
- æ€§èƒ½åŸºæº–æ¸¬è©¦
- éŒ¯èª¤æ¢å¾©æ¸¬è©¦

#### è² è¼‰æ¸¬è©¦
- API èª¿ç”¨é »ç‡æ¸¬è©¦
- ä¸¦ç™¼æœå°‹æ¸¬è©¦
- è¨˜æ†¶é«”ä½¿ç”¨æ¸¬è©¦
- éŸ¿æ‡‰æ™‚é–“æ¸¬è©¦

### ğŸ“ˆ æˆåŠŸæŒ‡æ¨™

#### æŠ€è¡“æŒ‡æ¨™
- API èª¿ç”¨çµ±ä¸€æ€§: 100%
- æœå°‹çµæœä¸€è‡´æ€§: 100%
- éŒ¯èª¤è™•ç†è¦†è“‹ç‡: 100%
- éŸ¿æ‡‰æ™‚é–“: < 2ç§’

#### æ¥­å‹™æŒ‡æ¨™
- ä»£ç¢¼é‡è¤‡ç‡: < 10%
- ç¶­è­·æˆæœ¬é™ä½: 70%
- æœå°‹çµæœç›¸é—œæ€§: > 85%
- ç³»çµ±å¯ç”¨æ€§: > 99%

### ğŸ”’ é¢¨éšªè©•ä¼°

#### æŠ€è¡“é¢¨éšª
- **API é™åˆ¶**: Serper API ä½¿ç”¨é‡é™åˆ¶
- **æ€§èƒ½å½±éŸ¿**: é¡å¤–çš„è™•ç†é‚è¼¯å¯èƒ½å½±éŸ¿éŸ¿æ‡‰æ™‚é–“
- **è¤‡é›œåº¦å¢åŠ **: çµ±ä¸€ç³»çµ±å¯èƒ½å¢åŠ ç³»çµ±è¤‡é›œåº¦

#### ç·©è§£æªæ–½
- å¯¦ç¾æ™ºèƒ½å¿«å–å’Œé è¼‰å…¥
- å„ªåŒ–æœå°‹ç­–ç•¥å’Œé—œéµå­—ç”Ÿæˆ
- æä¾›é™ç´šå’Œå›é€€æ©Ÿåˆ¶
- å»ºç«‹å®Œå–„çš„ç›£æ§å’Œå‘Šè­¦

### ğŸ“š ç›¸é—œæ–‡æª”

- [æ™ºèƒ½å„ªåŒ–é—œéµå­—ç³»çµ± PRD](./intelligent-keyword-optimization-prd.md)
- [Serper API ä½¿ç”¨æŒ‡å—](./serper-api-usage-guide.md)
- [æœå°‹ç­–ç•¥è¨­è¨ˆè¦ç¯„](./search-strategy-design.md)
- [API æ•´åˆæœ€ä½³å¯¦è¸](./api-integration-best-practices.md)

---

**æ–‡æª”ç‰ˆæœ¬**: v1.0  
**æœ€å¾Œæ›´æ–°**: 2025-01-15  
**å¯©æ ¸ç‹€æ…‹**: å¾…å¯©æ ¸
